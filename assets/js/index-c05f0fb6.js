var e,t,i,a,s,l,n,r,o,d,c,u,h,m,p,g,f,v,y,T,w,b,k,C,M,x,A,I,S,R,L,E,P,_,D,F,N,U,O,V,B,W,z,G,Z,H,j,Y,X,J,Q,K,$,q,ee,te,ie,ae,se,le,ne,re,oe,de,ce,ue,he,me,pe,ge,fe,ve,ye,Te,we,be,ke,Ce,Me,xe,Ae,Ie,Se,Re,Le,Ee,Pe,_e,De,Fe,Ne,Ue,Oe,Ve,Be,We,ze,Ge,Ze,He,je,Ye,Xe,Je,Qe,Ke,$e,qe,et,tt,it,at,st,lt,nt,rt,ot=Object.defineProperty,dt=(e,t,i)=>(((e,t,i)=>{t in e?ot(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i})(e,"symbol"!=typeof t?t+"":t,i),i),ct=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},ut=(e,t,i)=>(ct(e,t,"read from private field"),i?i.call(e):t.get(e)),ht=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},mt=(e,t,i,a)=>(ct(e,t,"write to private field"),a?a.call(e,i):t.set(e,i),i),pt=(e,t,i)=>(ct(e,t,"access private method"),i);import{n as gt,b as ft,p as vt,j as yt,r as Tt,d as wt,u as bt,o as kt,a as Ct,w as Mt,c as xt,e as At,f as It,g as St,h as Rt,i as Lt,k as Et,m as Pt,l as _t,q as Dt,s as Ft,t as Nt,v as Ut,F as Ot,x as Vt,y as Bt,z as Wt,A as zt,B as Gt,C as Zt,D as Ht,E as jt,G as Yt,H as Xt,I as Jt,J as Qt,K as Kt,L as $t,M as qt,N as ei,O as ti,P as ii,Q as ai,R as si,S as li,T as ni,U as ri,V as oi,W as di,X as ci}from"./.store-b66c1173.js";import{T as ui,I as hi,M as mi,E as pi,_ as gi,a as fi}from"./_plugin-vue_export-helper-aebdfa9d.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var vi=(e=>(e.Undo_Empty="Undo_Empty",e.Undo_AddClipToNewTrack="Undo_AddClipToNewTrack",e.Undo_RemoveClipToTrack="Undo_RemoveClipToTrack",e.Undo_SplitClip="Undo_SplitClip",e.Undo_MoveClip="Undo_MoveClip",e.Undo_MoveClipList="Undo_MoveClipList",e.Undo_CutClip="Undo_CutClip",e.Undo_SwitchClip="Undo_SwitchClip",e.Undo_SwitchTrack="Undo_SwitchTrack",e.Undo_MainTrackMagnet="Undo_MainTrackMagnet",e))(vi||{});class yi{static createUUID(e){let t=e?e.toLocaleLowerCase():"",i=null,a=window.crypto;if(a&&null!=a.randomUUID)i=a.randomUUID();else{null==this.uuidDict[e]&&(this.uuidDict[e]=0);let t=parseInt(this.uuidDict[e]+"");t+=1,this.uuidDict[e]=t,i=t+""}return t+"-"+i}}dt(yi,"uuidDict",{});let Ti=class{constructor(){dt(this,"uuid",null),dt(this,"name"),dt(this,"cmd"),dt(this,"data"),dt(this,"isExecute",!1),this.name="UndoRedo",this.uuid=yi.createUUID(this.name)}get doname(){return this.name}isDifferentData(e){return!0}setExecuteData(e){this.data=e,this.isExecute=!0}async Execute(){1!=this.isExecute&&(this.isExecute=!0,await this.onExecute())}async UnExecute(){1==this.isExecute&&(this.isExecute=!1,await this.onUnExecute())}async nextTick(){await gt()}async onExecute(){}async onUnExecute(){}Clear(){this.cmd=null,this.data=null,this.isExecute=!1}};class wi extends Ti{constructor(){super(),this.name="添加剪辑到轨道"}async onExecute(){let e=this.data,t=e.tracks,i=e.selectClip,a=e.editTrack,s=t.indexOf(a);-1==s&&t.push(a),s=a.clips.indexOf(i),-1==s&&(a.pushClip(i),await this.nextTick(),i.changeWatchVer())}async onUnExecute(){let e=this.data,t=e.tracks,i=e.selectClip,a=e.editTrack,s=a.clips.indexOf(i);-1!=s&&a.clips.splice(s,1),a.isMain||0!=a.clips.length||(s=t.indexOf(a),-1!=s&&t.splice(s,1))}Clear(){this.data=null}}class bi extends Ti{constructor(){super(),this.name="剪辑裁剪"}async onExecute(){let e=this.data;e.selectClip.time.start=e.newStart,e.selectClip.time.end=e.newEnd,e.selectClip.time.startCut=e.newStartCut,e.selectClip.time.endCut=e.newEndCut,await this.nextTick(),e.selectClip.changeWatchVer()}async onUnExecute(){let e=this.data;e.selectClip.time.start=e.oldStart,e.selectClip.time.end=e.oldEnd,e.selectClip.time.startCut=e.oldStartCut,e.selectClip.time.endCut=e.oldEndCut,await this.nextTick(),e.selectClip.changeWatchVer()}Clear(){this.data=null}}class ki{}dt(ki,"mousemove","mousemove"),dt(ki,"mouseup","mouseup"),dt(ki,"keydown","keydown"),dt(ki,"keyup","keyup"),dt(ki,"Logger","Logger"),dt(ki,"SlotFrameResize","SlotFrameResize"),dt(ki,"RenderRateSetting","RenderRateUpdate"),dt(ki,"media_selected_peview","media_selected_peview"),dt(ki,"PeviewPlayTimeupdate","PeviewPlayerTimeupdate"),dt(ki,"PeviewPlayComplete","PeviewPlayComplete"),dt(ki,"PeviewPlayerDurationchange","PeviewPlayerDurationchange"),dt(ki,"PeviewPlayerSetProcess","PeviewPlayerSetProcess"),dt(ki,"PeviewPlayerPlaying","PeviewPlayerPlaying"),dt(ki,"PeviewPlayerStateUpdate","PeviewPlayerStateUpdate"),dt(ki,"PreviewFullScreen","PreviewFullScreen"),dt(ki,"PreviewFullScreenExit","PreviewFullScreenExit"),dt(ki,"PeviewPlayerChangeFile","PeviewPlayerChangeFile"),dt(ki,"ZoomScroll","ZoomScroll"),dt(ki,"btnChangeRecorder","btnChangeRecorder"),dt(ki,"RecorderStateChange","AppChangeRecorder"),dt(ki,"RecorderComplete","RecorderComplete"),dt(ki,"GotoTimeline","GotoTimeline"),dt(ki,"SetRenderFrameFPS","SetRenderFrameFPS"),dt(ki,"CancelSelectClip","CancelSelectClip");class Ci{static selectClipData(e){this._selectPickClipDatas.forEach((e=>{e.clip.event.selected=!1})),this._selectPickClipDatas.length=0,null!=e&&(e instanceof Array?this._selectPickClipDatas.push(...e):this._selectPickClipDatas.push(e),this._selectPickClipDatas.forEach((e=>{e.clip.event.selected=!0})))}static getSelectClipData(){return this._selectPickClipDatas}}dt(Ci,"mc"),dt(Ci,"selectTimeValue",0),dt(Ci,"_selectPickClipDatas",[]);class Mi{}dt(Mi,"playbackRate",1);class xi{constructor(){dt(this,"key",0),dt(this,"caller"),dt(this,"method"),dt(this,"args")}clear(){this.caller=null,this.method=null,this.args=null}run(){var e=this.caller;if(this.caller&&this.caller.destroyed)return this.clear();var t=this.method,i=this.args;null!=t&&(i?t.apply(e,i):t.call(e))}}class Ai{constructor(){dt(this,"key",0),dt(this,"repeat",!1),dt(this,"delay",0),dt(this,"userFrame",!1),dt(this,"exeTime",0),dt(this,"caller"),dt(this,"method"),dt(this,"args"),dt(this,"jumpFrame",!1)}clear(){this.caller=null,this.method=null,this.args=null}run(e){var t=this.caller;if(this.caller&&this.caller.destroyed)return this.clear();var i=this.method,a=this.args;e&&this.clear(),null!=i&&(a?i.apply(t,a):i.call(t))}}const Ii=class{static getGID(){return this._gid++}static getCallerGID(e){return"string"==typeof e?e:e?e.$_GID||(e.$_GID=Ii.getGID()):0}static randRange(e=0,t=100){return e==t?e:Math.floor(Math.random()*(t-e+1))+e}static randRangeNumber(e=0,t=100){return e==t?e:Math.random()*(t-e)+e}static randArray(e){for(var t=e.length-1;t>0;t--){var i=Math.floor(Math.random()*(t+1)),a=e[t];e[t]=e[i],e[i]=a}return e}static GetRandArrayItem(e){return null==e||0==e.length?null:e[Math.floor(Math.random()*e.length)]}static packJsonData(e,t){try{return JSON.stringify({command:e,data:t})}catch(i){}return null}static packJsonServiceData(e,t,i){try{return JSON.stringify({service:e,data:t,funid:i})}catch(a){}return null}};let Si=Ii;dt(Si,"_gid",1);const Ri=class{constructor(){dt(this,"scale",1),dt(this,"currTimer",Ri.now()),dt(this,"currFrame",0),dt(this,"_delta",0),dt(this,"_lastTimer",Ri.now()),dt(this,"_map",[]),dt(this,"_handlers",[]),dt(this,"_temp",[]),dt(this,"_count",0),dt(this,"intervalIndex",null),dt(this,"frameTimestamp",0),dt(this,"frameRuning",!1),dt(this,"renderFrameList",[])}static now(){return(new Date).getTime()}getTime(){return(new Date).getTime()}startTimer(){null==this.intervalIndex&&(this.intervalIndex=setInterval(this._update.bind(this),1))}stopTimer(){null!=this.intervalIndex&&(clearInterval(this.intervalIndex),this.intervalIndex=null)}addRenderFrame(e,t,i,a=null){if(null==window.requestAnimationFrame)return;if(null==i)return;for(let l=0;l<this.renderFrameList.length;l++){const e=this.renderFrameList[l];if(e.method==i&&e.caller==t){this.renderFrameList.splice(l--,1);break}}let s=Ri.now();this.renderFrameList.push({startime:s,delay:e,caller:t,method:i,args:a}),0==this.frameRuning&&requestAnimationFrame(this.renderFrame.bind(this))}removeRenderFrame(e,t){for(let i=0;i<this.renderFrameList.length;i++){const a=this.renderFrameList[i];if(a.method==t&&a.caller==e){this.renderFrameList.splice(i--,1);break}}0==this.renderFrameList.length&&(this.frameRuning=!1)}renderFrame(e){if(1==this.frameRuning)return;this.frameRuning=!0,this.frameTimestamp=e;let t=Ri.now();for(let i=0;i<this.renderFrameList.length;i++){const e=this.renderFrameList[i];let a=e.method;a&&(e.delay<=0||t-e.startime>=e.delay)&&(e.startime=t,a.apply(e.caller,e.args))}this.frameRuning=!1,this.renderFrameList.length>0&&requestAnimationFrame(this.renderFrame.bind(this))}get isRuning(){return null!=this.intervalIndex}get delta(){return this._delta}_update(){if(this.scale<=0)this._lastTimer=Ri.now();else{var e=this.currFrame=this.currFrame+this.scale,t=Ri.now();this._delta=(t-this._lastTimer)*this.scale;var i=this.currTimer=this.currTimer+this._delta;this._lastTimer=t;var a=this._handlers;this._count=0;for(var s=0,l=a.length;s<l;s++){var n=a[s];if(null!==n.method){var r=n.userFrame?e:i;if(r>=n.exeTime)if(n.repeat)if(n.jumpFrame)for(;r>=n.exeTime;)n.exeTime+=n.delay,n.run(!1);else n.exeTime+=n.delay,n.run(!1),r>n.exeTime&&(n.exeTime+=Math.ceil((r-n.exeTime)/n.delay)*n.delay);else n.run(!0)}else this._count++}(this._count>30||e%200==0)&&this._clearHandlers(),this._handlers.length<=0&&this.stopTimer()}}_clearHandlers(){for(var e=this._handlers,t=0,i=e.length;t<i;t++){var a=e[t];null!==a.method?this._temp.push(a):this._recoverHandler(a)}this._handlers=this._temp,e.length=0,this._temp=e}_recoverHandler(e){this._map[e.key]==e&&(this._map[e.key]=null),e.clear(),Ri._pool.push(e)}_create(e,t,i,a,s,l,n){if(!i)return s.apply(a,l),null;if(n){var r=this._getHandler(a,s);if(r)return r.repeat=t,r.userFrame=e,r.delay=i,r.caller=a,r.method=s,r.args=l,r.exeTime=i+(e?this.currFrame:this.currTimer+Ri.now()-this._lastTimer),r}return(r=Ri._pool.length>0?Ri._pool.pop():new Ai).repeat=t,r.userFrame=e,r.delay=i,r.caller=a,r.method=s,r.args=l,r.exeTime=i+(e?this.currFrame:this.currTimer+Ri.now()-this._lastTimer),this._indexHandler(r),this._handlers.push(r),this._handlers.length>0&&this.startTimer(),r}_indexHandler(e){var t=e.caller,i=e.method,a=Si.getCallerGID(t),s=i.$_TID||(i.$_TID=1e5*Ri._mid++);e.key=a+s,this._map[e.key]=e}once(e,t,i,a=null,s=!0){this._create(!1,!1,e,t,i,a,s)}loop(e,t,i,a=null,s=!0,l=!1){var n=this._create(!1,!0,e,t,i,a,s);n&&(n.jumpFrame=l)}frameOnce(e,t,i,a=null,s=!0){this._create(!0,!1,e,t,i,a,s)}frameLoop(e,t,i,a=null,s=!0){this._create(!0,!0,e,t,i,a,s)}toString(){return" handlers:"+this._handlers.length+" pool:"+Ri._pool.length}clear(e,t){var i=this._getHandler(e,t);i&&(this._map[i.key]=null,i.key=0,i.clear())}clearAll(e){if(e)for(var t=0,i=this._handlers.length;t<i;t++){var a=this._handlers[t];a.caller===e&&(this._map[a.key]=null,a.key=0,a.clear())}}_getHandler(e,t){var i=Si.getCallerGID(e),a=t.$_TID||(t.$_TID=1e5*Ri._mid++);return this._map[i+a]}callLater(e,t,i=null){Pi.I.callLater(e,t,i)}runCallLater(e,t){Pi.I.runCallLater(e,t)}runTimer(e,t){var i=this._getHandler(e,t);i&&null!=i.method&&(this._map[i.key]=null,i.run(!0))}pause(){this.scale=0}resume(){this.scale=1}};let Li=Ri;dt(Li,"timer"),dt(Li,"_pool",[]),dt(Li,"_mid",1);const Ei=class{constructor(){dt(this,"_pool",[]),dt(this,"_map",[]),dt(this,"_laters",[])}_update(){var e=this._laters,t=e.length;if(t>0){for(var i=0,a=t-1;i<=a;i++){var s=e[i];this._map[s.key]=null,null!==s.method&&(s.run(),s.clear()),this._pool.push(s),i===a&&(a=e.length-1)}e.length=0}}_getHandler(e,t){var i=Si.getCallerGID(e),a=t.$_TID||(t.$_TID=1e5*Li._mid++);return this._map[i+a]}callLater(e,t,i=null){if(null==this._getHandler(e,t)){if(this._pool.length)var a=this._pool.pop();else a=new xi;a.caller=e,a.method=t,a.args=i;var s=Si.getCallerGID(e),l=t.$_TID;a.key=s+l,this._map[a.key]=a,this._laters.push(a)}}runCallLater(e,t){var i=this._getHandler(e,t);i&&null!=i.method&&(this._map[i.key]=null,i.run(),i.clear())}};let Pi=Ei;dt(Pi,"I",new Ei);const _i=class{static __init__(){return _i._baseClass||(_i._baseClass=Ni,Ni.init()),_i.items=_i._baseClass.items,_i.support=_i._baseClass.support,_i.support}static setItem(e,t){_i._baseClass.setItem(e,t)}static getItem(e){return _i._baseClass.getItem(e)}static setJSON(e,t){_i._baseClass.setJSON(e,t)}static getJSON(e){return _i._baseClass.getJSON(e)}static removeItem(e){_i._baseClass.removeItem(e)}static clear(){_i._baseClass.clear()}};let Di=_i;dt(Di,"_baseClass"),dt(Di,"items"),dt(Di,"support",!1);const Fi=class{static init(){try{Fi.support=!0,Fi.items=window.localStorage,Fi.setItem("laya","1"),Fi.removeItem("laya")}catch(e){Fi.support=!1}Fi.support}static setItem(e,t){try{Fi.support&&Fi.items.setItem(e,t)}catch(i){}}static getItem(e){return Fi.support?Fi.items.getItem(e):null}static setJSON(e,t){try{Fi.support&&Fi.items.setItem(e,JSON.stringify(t))}catch(i){}}static getJSON(e){try{return JSON.parse(Fi.support?Fi.items.getItem(e):null)}catch(t){return Fi.items.getItem(e)}}static removeItem(e){Fi.support&&Fi.items.removeItem(e)}static clear(){Fi.support&&Fi.items.clear()}};let Ni=Fi;dt(Ni,"items"),dt(Ni,"support",!1);class Ui{static initial(){1!=this._initial_&&(this._initial_=!0,this.supportLocalStorage=Di.__init__(),Li.timer=this.timer,this.timer.loop(1,this,this._onLoop))}static _onLoop(){Pi.I._update()}}dt(Ui,"timer",new Li),dt(Ui,"LocalStorage",Di),dt(Ui,"supportLocalStorage",!1),dt(Ui,"_initial_",!1);class Oi{constructor(){dt(this,"passTime",0),dt(this,"passCount",0),dt(this,"fpsNum",0),dt(this,"lastTimestamp",null)}updateFrame(e){const t=e-this.lastTimestamp;this.lastTimestamp=e,this.passTime+=t,this.passTime>1e3?(this.fpsNum=this.passCount,this.passCount=0,this.passTime=0):this.passCount+=1}updateRealtime(){let e=Ui.timer.getTime();this.updateFrame(e)}get count(){return this.fpsNum}}class Vi{static async setTimeout(e,t){return new Promise(((i,a)=>{try{setTimeout((()=>{null!=t&&t(),i(null)}),e)}catch(s){a(s)}}))}static formatSecondTime(e,t=!1){e=Math.max(0,e);let i=Math.floor(e/3600),a=Math.floor(e/60%60),s=Math.floor(e%60);i=i<10?"0"+i:i,a=a<10?"0"+a:a,s=s<10?"0"+s:s,s=s>59?59:s;let l=`${i}:${a}:${s}`;return 0==t&&(l=`${i>0?`${i}:`:""}${a}:${s}`),l}static formatMillisTime(e,t=!1,i=!1,a=30){e=Math.max(0,e);let s=Math.max(0,Math.floor(e/1e3/3600)),l=Math.max(0,Math.floor(e/1e3/60%60)),n=Math.max(0,Math.floor(e/1e3%60)),r=Math.max(0,Math.floor(e%1e3)),o=a;r=Math.floor(r/1e3*o),s=s<10?"0"+s:s,l=l<10?"0"+l:l,n=n<10?"0"+n:n,n=n>59?59:n,r=r<10?"0"+r:r;let d=`${s}:${l}:${n}`;return 0==t&&(d=`${s>0?`${s}:`:""}${l}:${n}`),1==i&&(d+=`.${r}`),d}static millisToMinutesAndSeconds(e,t,i){e=Math.round(e);const a=parseInt(e%1e3);let s=0,l=0,n=0,r=0,o="";const d=parseInt(e/1e3);d>59?(s=parseInt(d%60),l=parseInt(d/60)):s=d,l>59?(n=parseInt(l%60),r=parseInt(l/60)):n=l,t&&(o+=r<10?"0"+r+":":r+":"),o+=n<10?"0"+n+":":n+":",o+=s<10?"0"+s:""+s;let c="";if(1==i){let e=100*parseFloat((a/1e3).toFixed(2));e|=0,e<10&&(e="0"+e),c="."+e}return o+c}}class Bi{static createEventID(){return yi.createUUID("eventid")}static on(e,t,i){var a=this.typelists[e];null==a&&(a=[]);for(var s=0;s<a.length;s++){var l=a[s];if(l.caller==t&&l.listener==i)return}if(a.push({caller:t,listener:i}),this.typelists[e]=a,this.isWindowEvent(e)&&1==a.length){if(0==(1==this.winEvents[e])){null==this.onWindowEvent&&(this.onWindowEvent=this.onWindowEventHandler.bind(this)),(window||document).addEventListener(e,this.onWindowEvent),this.winEvents[e]=!0}}}static isWindowEvent(e){return e==ki.keydown||e==ki.keyup||e==ki.mousemove||e==ki.mouseup}static off(e,t,i){var a=this.typelists[e];if(null!=a){for(var s=0;s<a.length;s++){var l=a[s];null==i?t==l.caller&&a.splice(s--,1):i==l.listener&&t==l.caller&&a.splice(s--,1)}if(a.length>0)this.typelists[e]=a;else if(delete this.typelists[e],this.isWindowEvent(e)){null==this.onWindowEvent&&(this.onWindowEvent=this.onWindowEventHandler.bind(this)),(window||document).removeEventListener(e,this.onWindowEvent),delete this.winEvents[e]}}}static clearAll(e){for(var t in this.typelists)this.off(t,e,null)}static release(){this.typelists=null}static cheackMounted(e){this._isSend=e}static send(e,...t){let i=this._isSend;if(this._isSend=!0,1==i){var a=this.typelists[e];if(null!=a&&a.length>0)for(var s=a.length,l=0;l<s;l++){var n=a[l],r=n.caller,o=n.listener;null!=o&&("string"==typeof r?o.apply(null,t):o.apply(r,t))}}}static onWindowEventHandler(e){if(e&&2==e.button)return;let t=e.type;var i=this.typelists[t];i&&i.length>0&&this.send(t,e)}}dt(Bi,"typelists",{}),dt(Bi,"winEvents",{}),dt(Bi,"onWindowEvent",null),dt(Bi,"_isSend",!0);class Wi{static createEventID(){return yi.createUUID("eventid")}static on(e,t,i){var a=this.typelists[e];null==a&&(a=[]);for(var s=0;s<a.length;s++){var l=a[s];if(l.caller==t&&l.listener==i)return}a.push({caller:t,listener:i}),this.typelists[e]=a}static off(e,t,i){var a=this.typelists[e];if(null!=a){for(var s=0;s<a.length;s++){var l=a[s];null==i?t==l.caller&&a.splice(s--,1):i==l.listener&&t==l.caller&&a.splice(s--,1)}a.length>0?this.typelists[e]=a:delete this.typelists[e]}}static clearAll(e){for(var t in this.typelists)this.off(t,e,null)}static release(){this.typelists=null}static cheackMounted(e){this._isSend=e}static send(e,...t){let i=this._isSend;if(this._isSend=!0,1==i){var a=this.typelists[e];if(null!=a&&a.length>0)for(var s=a.length,l=0;l<s;l++){var n=a[l],r=n.caller,o=n.listener;null!=o&&("string"==typeof r?o.apply(null,t):o.apply(r,t))}}}}dt(Wi,"typelists",{}),dt(Wi,"_isSend",!0);const zi=class{static get isDEV(){return!1}static toAssetsURL(e){if(null==e||""==e)return e;let t=null;if(1==(-1!=(e=e.replaceAll("@/","./")).indexOf("~public/")))return e;let i=e.substring(e.lastIndexOf(".")+1),a=e.lastIndexOf("/"),s=e.lastIndexOf("."),l=e.substring(a+1,s),n=zi.isDEV;switch(i){case"mp4":case"webm":case"jpg":case"png":t=1!=n?`./assets/${i}/${l}.${i}`:e;break;case"css":t=1!=n?`./assets/css/${l}.css`:null;break;case"js":case"ts":t=1!=n?`./assets/js/${l}.js`:e}return t}static isTypeSupportedIpc(){return"undefined"!=typeof electronAPI&&null!=electronAPI}static initial(){if("undefined"!=typeof electronAPI&&null!=electronAPI){let e={};e["electron-log"]=this.log.bind(this),e["electron-error"]=this.error.bind(this),e["electron-warn"]=this.warn.bind(this),electronAPI.ipcRenderer.on("to-ipc-render",((t,i,...a)=>{let s=e[i];null!=s?s(...a):Wi.send(i,...a)}))}}static toIpcMain(e,...t){"undefined"!=typeof electronAPI&&null!=electronAPI&&electronAPI.ipcRenderer.send(e,...t)}static sendIPC(e,...t){this.toIpcMain("to-ipc-main",e,...t)}static sendIPCLog(...e){this.sendIPC("vue-log",...e)}static log(...e){this.debug}static error(...e){this.debug}static warn(...e){this.debug}};let Gi=zi;dt(Gi,"debug",!0);const Zi=class{static initlibmessage(){window.onlibmessage=(e,...t)=>{this.dispatch.send(e,...t)}}static sendmainmessage(e,...t){let i=null==window?void 0:window.onmainmessage;i&&i(e,...t)}static onlib(e,t,i){this.dispatch.on(e,t,i)}static offlib(e,t,i){this.dispatch.off(e,t,i)}static clearAll(e){this.dispatch.clearAll(e)}static release(){this.dispatch.release()}static reloadMainIframe(){this.reloadIframe(this.MainIframeKey)}static reloadIframe(e){let t=this.iframeKeys[e];null!=t&&null!=t.refIframe&&this.initIframe(t.key,t.refIframe,t.refData,t.backgroundImage)}static initIframe(e,t,i,a){t!=this.refIframe&&(null!=e&&null!=t&&null==this.iframeKeys[e]&&(this.iframeKeys[e]={key:e,refIframe:t,refData:i,backgroundImage:a}),null!=this.refIframe&&(this.refIframe.value.src=""),null!=this.refData&&(this.refData.value.isLoading=!1),this.refIframe=t,this.refData=i,this.backgroundImage=a,Zi.initlibmessage(),Zi.onlib(hi.initengine,this,this.oninitengine),Zi.onlib(hi.reload,this,this.reloadiframe),this.loadlibs())}};let Hi=Zi;dt(Hi,"dispatch",new ui),dt(Hi,"isEngine",!1),dt(Hi,"mainCanvas"),dt(Hi,"refData"),dt(Hi,"refIframe"),dt(Hi,"backgroundImage"),dt(Hi,"MainIframeKey","MainIframe"),dt(Hi,"iframeKeys",{}),dt(Hi,"loadlibs",(()=>{Zi.isEngine=!1,Zi.mainCanvas=null,null!=Zi.refData&&(window.onlibprogress=e=>{Zi.refData.value.isLoading=!0,Zi.refData.value.loadingText=Math.round(100*e)+"%"}),window.onlib=()=>{window.onlib=null,window.onlibprogress=null,setTimeout((()=>{Zi.loadIframeVue()}),100)};let e="";e+=`<script defer type="module" src="${Gi.toAssetsURL("./offscreen/offlib-06a34fdf.js")}"><\/script>`,Zi.iframeWrite(e)})),dt(Hi,"loadIframeVue",(()=>{let e="";e+="<head>";let t=Gi.toAssetsURL("./assets/css/offapp-1991cae7.css");null!=t&&(e+=`<link rel="stylesheet" href="${t}">`),e+="</head>",e+="<body>",e+='<div id="app"></div>',e+=`<script defer type="module" src="${Gi.toAssetsURL("./offscreen/offapp-bb67c9f8.js")}"><\/script>`,e+="</body>",Zi.iframeWrite(e)})),dt(Hi,"iframeWrite",(e=>{e=(e=e.replaceAll("/","/")).replaceAll("/","/");var t=Zi.refIframe.value,i=t.contentDocument||t.contentWindow.document;i.open(),i.write(e),i.close()})),dt(Hi,"reloadiframe",(async e=>{var t=Zi.refIframe.value;t.style.opacity="0.0",await Vi.setTimeout(100),e.reload(),await Vi.setTimeout(100),Zi.loadlibs(),await Vi.setTimeout(100),t.style.opacity="1.0"})),dt(Hi,"oninitengine",(e=>{let{loading:t,text:i,complete:a,mainCanvas:s}=e;null!=Zi.refData&&(Zi.refData.value.loadingText=i,Zi.refData.value.isLoading=t),1==a&&(Zi.isEngine=!0,Zi.mainCanvas=s,null!=Zi.backgroundImage&&Zi.sendmainmessage(hi.TF_SetBackgroundImage,Zi.backgroundImage),Ci.mc.sendClipEnterAll())}));var ji=(e=>(e.initial="initial",e.ready="ready",e.recording="recording",e.stop="stop",e.complete="complete",e))(ji||{});class Yi{constructor(){dt(this,"name","TRecorder"),dt(this,"canvas"),dt(this,"videoURL",null),dt(this,"state"),dt(this,"debug",!0),dt(this,"onStartCallback"),this.state=ji.initial}isTypeSupported(){return!1}initRecorder(){}setCanvas(e){this.canvas=e}get isRecording(){return this.state==ji.recording}onRenderFrameCanvas(e,t){}attachMedia(e,t){}async beforeReadying(){this.state=ji.ready}afterClear(){this.state=ji.initial}async start(){this.log("==========收到录屏指令:开始============")}pause(){this.log("==========收到录屏指令:暂停============")}resume(){this.log("==========收到录屏指令:恢复============")}async stop(){this.log("==========收到录屏指令:停止============")}clear(){}getEnableAudioSound(){return!1}getEncodeQueueSize(){return-1}getVideoDataURL(){return this.videoURL}log(...e){this.debug}error(...e){this.debug}warn(...e){this.debug}}class Xi extends Yi{constructor(){super(...arguments),dt(this,"isSupported",!1),dt(this,"frame",0)}initRecorder(){this.isSupported=Gi.isTypeSupportedIpc()}async start(){if(null==this.canvas)return;if(1==this.isRecording)return;if(1!=this.isSupported)return void this.error("环境不支持IPC ！");this.log("==========收到录屏指令:开始============");let e={filePath:"C:/Users/sunnyboxs/Desktop/out.mp4"};Gi.sendIPC("start-recording",e),Bi.send(ki.RecorderStateChange,this.isRecording),this.state=ji.recording,Bi.send(ki.RecorderStateChange,this.state)}onRenderFrameCanvas(e,t){null!=this.canvas&&1==this.isRecording&&this.state==ji.recording&&this.canvas.toBlob((e=>{let t=URL.createObjectURL(e);Gi.sendIPC("frame-data",t)}),"image/jpeg",.9)}get isRecording(){return this.state==ji.recording}pause(){1==this.isSupported&&(this.log("==========收到录屏指令:暂停============"),Gi.sendIPC("pause-recording"))}resume(){1==this.isSupported&&(this.log("==========收到录屏指令:恢复============"),Gi.sendIPC("resume-recording"))}async stop(){1==this.isSupported&&this.state!=ji.stop&&(this.state=ji.stop,this.log("==========收到录屏指令:停止============"),Gi.sendIPC("stop-recording"),Bi.send(ki.RecorderStateChange,this.state))}}class Ji{static convertPixelToTime(e,t=NaN){return isNaN(t)&&(t=this.timelineZoom),e/(100*t)*60}static convertTimeToPixel(e,t=NaN){return isNaN(t)&&(t=this.timelineZoom),e/60*(100*t)}static toTargetLocal(e,t){let i=e.getBoundingClientRect(),a=t.getBoundingClientRect();return{left:i.left-a.left,top:i.top-a.top}}}dt(Ji,"timelineZoom",1),dt(Ji,"timelineZoomMax",1),dt(Ji,"zoomIndex",0);var Qi=(e=>(e.NULL="null",e.Video="Video",e.Audio="Audio",e.Image="Image",e.ImageGIF="ImageGIF",e.Lrc="Lrc",e.Jrc="Jrc",e.Krc="Krc",e.Vtt="Vtt",e))(Qi||{});class Ki{constructor(e=5,t=!1){dt(this,"queue",[]),dt(this,"activeTaskNum",0),dt(this,"setTimeoutIndex",null),this.limit=e,this.debug=t,e<1&&(e=1)}addTask(e,t){if(e.name?e.name:e.fn.name||this.queue.length,null!=t)for(let i=0;i<this.queue.length;i++){if(1==t(...this.queue[i].args))return this.queue[i]=e,void this.log("[添加任务] 已经在任务中,更新覆盖任务")}this.queue.push(e),this.runTask()}clear(){this.clearTimeoutIndex(),this.queue.length=0}async execute(e){this.log(`[运行任务] ${e.name}`);try{try{const t=await e.fn.apply(e.caller,e.args);return this.log(`[任务完成] ${e.name}`),t}catch(t){throw this.log(`[任务失败] ${e.name}`),t}}finally{this.clearTimeoutIndex(),this.setTimeoutIndex=setTimeout((()=>{this.activeTaskNum--,this.runTask()}),1)}}clearTimeoutIndex(){if(null!=this.setTimeoutIndex){let e=this.setTimeoutIndex;this.setTimeoutIndex=null,clearTimeout(e)}}runTask(){for(;this.activeTaskNum<this.limit&&this.queue.length>0;){const e=this.queue.shift();this.activeTaskNum++,this.execute(e)}}log(e){this.debug}}window.Buffer=ft.Buffer;class $i{constructor(){dt(this,"drawComplete"),dt(this,"mediaFile",null),dt(this,"resolve",null),dt(this,"reject",null),dt(this,"taskRunner",new Ki(1,!1))}loadAudio(e,t){null!=e&&(e.progress=0,this.taskRunner.addTask({name:"解析视频封面:"+e.label,caller:this,fn:this.runTask,args:arguments}))}async runTask(e,t){this.resolve=null,this.reject=null;let i=new Promise(((e,t)=>{this.resolve=e,this.reject=t}));this.mediaFile=e;let a=e.path;if(this.drawComplete=t,null!=this.mediaFile.response)this.parseID3Tag(this.mediaFile.response);else{var s=new XMLHttpRequest;s.open("GET",a,!0),s.responseType="arraybuffer",s.onreadystatechange=this.onreadystatechange.bind(this),s.send()}return i}onreadystatechange(e){let t=e.target;4==t.readyState&&(200==t.status?(t.onreadystatechange=null,this.parseID3Tag(t.response)):alert("error during the load.Wrong url or cross origin issue"))}onDecodeError(){alert("error while decoding your file.")}async parseID3Tag(e){if(e){let i=new Uint8Array(e);try{const e=await vt(i);if(null!=e&&(e.format&&e.format.duration>0&&(this.mediaFile.duration=e.format.duration,this.mediaFile.durationStr=Vi.millisToMinutesAndSeconds(1e3*e.format.duration)),e.common.picture&&e.common.picture.length>0)){let t=e.common.picture[0];this.mediaFile.thumbnail=`data:${t.format};base64,${t.data.toString("base64")}`}}catch(t){}this.mediaFile.response=e}this.resolveTask(),this.callComplete()}resolveTask(){let e=this.resolve;this.reject,this.resolve=null,this.reject=null,null!=e&&e(this.mediaFile)}callComplete(){if(this.mediaFile.progress=NaN,null!=this.drawComplete){let e=this.drawComplete;this.drawComplete=null,e(this.mediaFile)}}static getClipWidthByDuration(e){return 100/60*e}}class qi{constructor(){dt(this,"drawComplete"),dt(this,"domCanvas"),dt(this,"ctx",null),dt(this,"mediaFile",null),dt(this,"timeoutIndex",NaN),dt(this,"resolve",null),dt(this,"reject",null),dt(this,"taskRunner",new Ki(1,!1));let e="tempCaptureCanvas";this.domCanvas=document.getElementById(e),null==this.domCanvas&&(this.domCanvas=this.createCanvas(1224,30),this.domCanvas.width=1224,this.domCanvas.height=30,this.domCanvas.id=e,this.ctx=this.domCanvas.getContext("2d"))}createCanvas(e,t){var i=document.createElement("canvas");return i.width=e,i.height=t,i}drawAudioWave(e,t){null!=e&&this.taskRunner.addTask({name:"解析视频封面:"+e.label,caller:this,fn:this.runTask,args:arguments})}async runTask(e,t){this.resolve=null,this.reject=null;let i=new Promise(((e,t)=>{this.resolve=e,this.reject=t}));if(this.drawComplete=t,null==e||null==e.response)return void this.callComplete();if(null!=e.captureImage&&""!=e.captureImage)return void this.callComplete();this.mediaFile=e;let a=new AudioContext;return a.decodeAudioData(e.response,(e=>{a.close(),this.drawTest(e),this.mediaFile.audioBuffer=e,this.mediaFile.audioSampleRate=a.sampleRate}),this.onDecodeError),i}onDecodeError(){alert("error while decoding your file.")}drawTest(e){let t=[],i=e.getChannelData(0),a=e.duration;this.mediaFile.duration=a,this.mediaFile.durationStr=Vi.millisToMinutesAndSeconds(1e3*a);let s=[],l=i.length,n=0;for(let m=0;m<l;m+=100)t.push(i[m]),t.length>=10&&(n%3==0&&s.push(Math.max.apply(null,t)),n++,t.length=0);t.length>=0&&(s.push(Math.max.apply(null,t)),t.length=0);let r=s.length/100*60;Vi.millisToMinutesAndSeconds(1e3*r);let o=3,d=s.length/o*2;if(d>4e3){o=Math.ceil(s.length/2e3),d=s.length/o*2}this.domCanvas.width=d,this.domCanvas.height=50;var c=this.ctx;c.fillStyle="#0e3058",c.fillRect(0,0,d,50),c.strokeStyle="#00ff00",c.lineWidth=2;var u=c.createLinearGradient(0,0,0,50);u.addColorStop(.1,"#ff0000"),u.addColorStop(.15,"#f08a34"),u.addColorStop(.3,"#f08a34"),u.addColorStop(.35,"#1fb4f4"),c.fillStyle=u;{let e=50;const t=1/e;let i=1,a=0;for(let l=0;l<s.length;l+=o){let n=Math.abs(s[l]);if(l<s.length-2){n=(n+Math.abs(s[l+1]))/2}n=Math.round(n/t);let r=.8*e;n<r&&(n*=1.35),n*=1.5,n>r&&(n*=.5),n*=i;let o=e-n,d=e;c.fillRect(a,o,2,d),a+=2}}c.stroke();let h=null;h=this.domCanvas.toDataURL("image/png",1),this.mediaFile.captureImage=h,this.callComplete()}resolveTask(){let e=this.resolve;this.reject,this.resolve=null,this.reject=null,null!=e&&e(this.mediaFile)}callComplete(){if(this.resolveTask(),null!=this.drawComplete){let e=this.drawComplete;this.drawComplete=null,e(this.mediaFile)}}static getClipWidthByDuration(e){return 100/60*e}}class ea{constructor(){dt(this,"domVideo"),dt(this,"capturePos",0),dt(this,"runCount",0),dt(this,"captureCount",0),dt(this,"captureTimeStart",0),dt(this,"domCanvas"),dt(this,"ctx",null),dt(this,"mediaFile",null),dt(this,"drawComplete"),dt(this,"option"),dt(this,"resolve",null),dt(this,"reject",null),dt(this,"taskRunner",new Ki(1,!1));let e="tempCaptureCanvas";this.domCanvas=document.getElementById(e),null==this.domCanvas&&(this.domCanvas=this.createCanvas(1224,30),this.domCanvas.width=1224,this.domCanvas.height=30,this.domCanvas.id=e,this.ctx=this.domCanvas.getContext("2d"))}createCanvas(e,t){var i=document.createElement("canvas");return i.width=e,i.height=t,i}loadVideo(e,t,i){if(null!=e){t.loading&&(e.progress=0);let i={name:"解析视频封面:"+e.label,caller:this,fn:this.runTask,args:arguments};this.taskRunner.addTask(i,(t=>e.path==t.path))}}async runTask(e,t,i){this.mediaFile=e,this.option=t;let a=e.path;this.drawComplete=i;let s="tempCaptureVideo";return this.domVideo=this.domVideo||document.getElementById(s),null==this.domVideo&&(this.domVideo=document.createElement("video"),this.domVideo.id=s,this.domVideo.addEventListener("canplay",this.canplayHandle.bind(this)),this.domVideo.addEventListener("loadeddata",this.loadeddataHandle.bind(this)),this.domVideo.addEventListener("seeked",this.seekedHandle.bind(this))),this.domVideo.src=a,this.captureCount=0,this.runCount=0,this.resolve=null,this.reject=null,new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}canplayHandle(){}loadeddataHandle(){let e=this.domVideo.videoWidth||this.domVideo.width,t=this.domVideo.videoHeight||this.domVideo.height,i=this.domVideo.duration;this.mediaFile.duration=i,this.mediaFile.durationStr=Vi.millisToMinutesAndSeconds(1e3*i),this.mediaFile.sourceWidth=e,this.mediaFile.sourceHeight=t,this.option.loading&&(this.mediaFile.progress=1),Vi.millisToMinutesAndSeconds(1e3*this.domVideo.duration),this.captureTimeStart=Ui.timer.getTime(),this.domVideo.currentTime=0}seekedHandle(){Ui.timer.getTime(),this.captureTimeStart,this.drawVideoSequencePicture()}drawVideoSequencePicture(){let e=this.domVideo.currentTime,t=this.domVideo.duration,i=this.domVideo.videoWidth||this.domVideo.width,a=this.domVideo.videoHeight||this.domVideo.height;(i<=0||a<=0)&&(i=1280,a=720);let s=a/i;isNaN(s)&&(s=6/19);let l=Ji.convertTimeToPixel(t),n=Math.min(4e3,l),r=45/s,o=r+0,d=Math.ceil(n/o);n=o*d;let c=t/d;if(this.option.loading){let i=Math.floor((e+c)/t*100);this.mediaFile.progress=i}var u=this.ctx;0==e&&(this.domCanvas.width=n,this.domCanvas.height=45,u.fillStyle="#004e52",u.fillRect(0,0,this.domCanvas.width,this.domCanvas.height),this.capturePos=0);let h=1,m=d-5;m>0&&(h=Math.ceil(m/5)),h<=1&&(h=1);let p=e;for(let g=0;g<h&&(u.drawImage(this.domVideo,this.capturePos,0,r,45),this.capturePos+=o,p+=c,!(p>=t));g++);if(this.runCount+=1,p<t)this.captureTimeStart=Ui.timer.getTime(),this.domVideo.currentTime=p,this.runCount%3==0&&(this.mediaFile.captureImage=this.domCanvas.toDataURL("image/png",1));else{let e=this.domCanvas.toDataURL("image/png",1);this.mediaFile.captureImage=e,this.resolveTask(),this.callComplete()}}clearanvas(){null!=this.ctx&&(this.ctx.clearRect(0,0,this.domCanvas.width,this.domCanvas.height),this.domCanvas.width=1,this.domCanvas.height=1)}resolveTask(){let e=this.resolve;this.reject,this.resolve=null,this.reject=null,null!=e&&e(this.mediaFile)}callComplete(){if(this.option.loading&&(this.mediaFile.progress=NaN),this.clearanvas(),this.domVideo&&(this.domVideo.pause(),this.domVideo.removeAttribute("src"),this.domVideo.load()),null!=this.drawComplete){let e=this.drawComplete;this.drawComplete=null,e(this.mediaFile)}}}const ta=class{static showMessageRB(e){Bi.send(ta.AppMessageRb,e)}};let ia=ta;dt(ia,"AppMessageRb","app-message-rb");class aa{constructor(){dt(this,"domVideo"),dt(this,"domCanvas"),dt(this,"ctx",null),dt(this,"mediaFile",null),dt(this,"drawComplete"),dt(this,"resolve",null),dt(this,"reject",null),dt(this,"taskRunner",new Ki(1,!1)),dt(this,"worker");let e="tempCaptureCanvas";this.domCanvas=document.getElementById(e),null==this.domCanvas&&(this.domCanvas=this.createCanvas(1224,30),this.domCanvas.width=1224,this.domCanvas.height=30,this.domCanvas.id=e,this.ctx=this.domCanvas.getContext("2d"))}createCanvas(e,t){var i=document.createElement("canvas");return i.width=e,i.height=t,i}loadVideo(e,t){null!=e&&(e.progress=0,this.taskRunner.addTask({name:"解析视频封面:"+e.label,caller:this,fn:this.runTask,args:arguments}))}async runTask(e,t){this.mediaFile=e;let i=e.path;this.drawComplete=t,this.worker,isNaN(this.mediaFile.duration)&&ia.showMessageRB({message:`导入视频：${this.mediaFile.label}`,options:{duration:2}});let a="tempCaptureVideo";return this.domVideo=this.domVideo||document.getElementById(a),null==this.domVideo&&(this.domVideo=document.createElement("video"),this.domVideo.id=a,this.domVideo.addEventListener("canplay",this.canplayHandle.bind(this)),this.domVideo.addEventListener("loadeddata",this.loadeddataHandle.bind(this)),this.domVideo.addEventListener("seeked",this.seekedHandle.bind(this))),this.domVideo.src=i,this.resolve=null,this.reject=null,new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}async canplayHandle(){if(null==this.mediaFile.audioBuffer){let t=this.domVideo;t.duration;if(isNaN(t.duration)||t.duration==1/0)return;try{let e=await fetch(this.mediaFile.path).then((e=>e.arrayBuffer()));const t=new AudioContext;t.sampleRate;let i=await t.decodeAudioData(e);t.close();this.domVideo;this.mediaFile.audioBuffer=i}catch(e){}}}loadeddataHandle(){let e=this.domVideo.videoWidth||this.domVideo.width,t=this.domVideo.videoHeight||this.domVideo.height,i=this.domVideo.duration;this.mediaFile.duration=i,this.mediaFile.durationStr=Vi.millisToMinutesAndSeconds(1e3*i),this.mediaFile.sourceWidth=e,this.mediaFile.sourceHeight=t;Vi.millisToMinutesAndSeconds(1e3*this.domVideo.duration);this.domVideo.currentTime=i>=30?30:Math.floor(i/2)}seekedHandle(){this.drawVideoThumbnail()}drawVideoThumbnail(){var e=this.ctx;this.domCanvas.width=126,this.domCanvas.height=90,e.fillStyle="#004e52",e.clearRect(0,0,this.domCanvas.width,this.domCanvas.height),e.drawImage(this.domVideo,0,0,this.domCanvas.width,this.domCanvas.height);let t=this.domCanvas.toDataURL("image/png",1);this.mediaFile.thumbnail=t,this.resolveTask(),this.callComplete()}clearanvas(){null!=this.ctx&&(this.ctx.clearRect(0,0,this.domCanvas.width,this.domCanvas.height),this.domCanvas.width=1,this.domCanvas.height=1)}resolveTask(){let e=this.resolve;this.reject,this.resolve=null,this.reject=null,null!=e&&e(this.mediaFile)}callComplete(){if(this.mediaFile.progress=NaN,this.domVideo&&(this.domVideo.pause(),this.domVideo.removeAttribute("src"),this.domVideo.load()),this.clearanvas(),null!=this.drawComplete){let e=this.drawComplete;this.drawComplete=null,e(this.mediaFile)}}static getClipWidthByDuration(e){return 100/60*e}}class sa{static get videoThumbCapture(){return null==this._videoCapture&&(this._videoThumbCapture=new aa),this._videoThumbCapture}static get videoCapture(){return null==this._videoCapture&&(this._videoCapture=new ea),this._videoCapture}static get audioCapture(){return null==this._audioCapture&&(this._audioCapture=new $i),this._audioCapture}static get audioWaveCapture(){return null==this._audioWaveCapture&&(this._audioWaveCapture=new qi),this._audioWaveCapture}static getFileType(e){let t=e.name.toLocaleLowerCase();null==this.fileType&&(this.fileType={},this.fileType[".lrc"]=Qi.Lrc,this.fileType[".krc"]=Qi.Krc,this.fileType[".jrc"]=Qi.Jrc,this.fileType[".vtt"]=Qi.Vtt,this.fileType[".gif"]=Qi.ImageGIF);for(const a in this.fileType){const e=this.fileType[a];if(-1!=t.indexOf(a))return e}let i=e.type.toLocaleLowerCase();return 0==i.indexOf("audio/")?Qi.Audio:0==i.indexOf("video/")?Qi.Video:0==i.indexOf("image/")?Qi.Image:null}}dt(sa,"_videoThumbCapture"),dt(sa,"_videoCapture"),dt(sa,"_audioCapture"),dt(sa,"_audioWaveCapture"),dt(sa,"fileType",null);class la{constructor(){dt(this,"isJrc",!1),dt(this,"list",[]),dt(this,"krckey",[64,71,97,119,94,50,116,71,81,54,49,45,206,210,110,105]),dt(this,"playIndex",0),dt(this,"playTime",0)}get isValid(){return this.list&&this.list.length>0}get isKaraoke(){if(null!=this.list){let e=this.list.length,t=Math.ceil(e/2);if(null!=this.list[t]){let e=this.list[t].words;if(null!=e&&e.length>0)return!0}}return!1}async getContentByURL(e){let t=await fetch(e).then((e=>e.arrayBuffer())),i="gb2312";try{i=yt.detect(Buffer.from(t)).encoding}catch(a){}return new TextDecoder(i).decode(t)}async loadLRC(e){const t=await this.getContentByURL(e);this.parseLRC(t)}async loadKRC(e){let t=await fetch(e).then((e=>e.arrayBuffer())),i=new Uint8Array(t);i=i.slice(4);for(var a=0;a<i.length;a++)i[a]^=this.krckey[a%16];try{i=new Zlib.Inflate(i).decompress()}catch(m){return}var s=new TextDecoder("utf8").decode(i).split("\r\n");let l=/\[(\-*\d+),(\-*\d+)\]/,n=/<(\-*\d+),(\-*\d+),0>/g,r=/<(\-*\d+),(\-*\d+),0>/g,o=[];for(let p=0;p<s.length;p++){const e=s[p];if(null!=e.match(/\[\w+:/))continue;let t=e.replace(l,"");t=t.replace(n,"");var d=e.match(l);if(d){var c=Number(d[1]),u=c+Number(d[2]);let i=null,a=e.replace(l,""),s=[];for(;i=r.exec(a);){let e=Number(i[1]),t=Number(i[2]);s.push([e,t])}if(s.length>1){let e=s[s.length-2],t=s[s.length-1],i=t[1];(i>5e3||i<=0)&&(i=Math.max(t[0]-e[0],e[1]),t[1]=i+1e3,u=c+t[0]+i)}let n={lyric:t,lineStart:c,lineEnd:u,words:s};o.push(n)}}if(null!=o&&o.length>0){o[o.length-1].lineEnd+=3e3}let h="";try{h=JSON.stringify(o),h="[JRC=V1]"+h}catch(m){}""!=h&&null!=h&&this.parseLRC(h)}parseLRC(e){e=e.replaceAll("[LRC=2023]","[JRC=V1]"),this.isJrc=!1;let t=/\[JRC=(V\d+)\]/,i=e.match(t);if(null!=i){let s=i[1];if(e=e.replace(t,""),"V1"==s)try{if(this.list=JSON.parse(e),this.isJrc=!0,null!=this.list&&this.list.length>0){let e=this.list[0];if(1==e.v&&null!=e.s)for(let t=0;t<this.list.length;t++){const e=this.list[t];let i={lyric:e.c,lineStart:Math.round(e.s),lineEnd:Math.round(e.e),words:e.w};this.list[t]=i}}}catch(a){}else if("V2"==s){let t=JSON.parse(e);this.isJrc=!0,this.list=[];for(let e=0;e<t.length;e++){const i=t[e];let a=i[0],s=a.split("$"),l=i[2],n=Math.round(i[1][0]),r=Math.round(i[1][1]);if(-1!=a.indexOf("^")&&(a=a.replaceAll("^",""),e%2!=0)){let e=r;r=n+100;let t={lyric:"",lineStart:n,lineEnd:r,words:[]};this.list.push(t),n=r,r=e}if(s.length>1&&l.length>0){let e=0;for(let t=0;t<s.length;t++){let i=s[t].replaceAll("^",""),a=l.slice(e,e+i.length),o=0;for(let e=0;e<a.length;e++){a[e][0];const t=a[e][1];a[e][0]=o,o+=t}e+=i.length,r=n+o;let d={lyric:i,lineStart:n,lineEnd:r,words:a};this.list.push(d),n=r}}else{let e={lyric:a,lineStart:n,lineEnd:r,words:l};this.list.push(e)}}}}else this.parseLRCNormal(e)}parseLRCNormal(e){if(this.list.length=0,null==e||""==e)return!1;for(var t=(e=e.replaceAll("\\n","\n")).split("\n"),i=/\[[0-5][0-9]:[0-5][0-9].[0-9][0-9]\]/g,a=0;a<t.length;a++){var s=t[a];let e=s.match(i);if(null!=e&&0!=e.length)for(var l=e.length,n=s.substring(10*l),r=0;r<l;r++){var o={},d=e[r];let t=d.substring(1,3),i=d.substring(4,6),a=Number(d.substring(7,9));isNaN(a)&&(a=0);var c=60*Number(t)+Number(i);o.lineStart=1e3*c+10*a,o.lyric=n,this.list.push(o)}}return this.list.sort(this.compare),!0}async loadVTT(e){let t=await fetch(e).then((e=>e.arrayBuffer()));const i=yt.detect(Buffer.from(t)),a=new TextDecoder(i.encoding).decode(t);this.parseVTT(a)}parseVTT(e){const t=(e=e.replace(/\r/g,"").replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(t)}))).split(/\n\n/).map((e=>e.trim()));this.list=[];for(let i=0;i<t.length;i++){const e=t[i].split("\n");if(/^\d*:\d*:\d*\./.test(e[0])){const t=/^(\d\d):(\d\d):(\d\d)\.(\d+)\s-->\s(\d\d):(\d\d):(\d\d)\.(\d+)/.exec(e[0]);if(!t)continue;const i=36e5*+t[1]+6e4*+t[2]+1e3*+t[3]+ +t[4],a=36e5*+t[5]+6e4*+t[6]+1e3*+t[7]+ +t[8];let s="";for(let n=1;n<e.length;n++)s+=e[n]+"\n";const l={lineStart:i,lineEnd:a,lyric:s};this.list.push(l)}}this.list.sort(((e,t)=>e.lineStart-t.lineStart))}compare(e,t){return e.timer>t.timer?1:e.timer<t.timer?-1:0}clear(){this.list.length=0}getPlayTimeLyric(e){if(null==this.list||0==this.list.length||isNaN(e)||e<=0)return null;let t=1e3*e;this.playTime>t&&(this.playIndex=0,this.playTime=0);let i=0,a={update:!1},s="",l=3e3;for(let n=this.playIndex;n<this.list.length;n++){const e=this.list[n];let r=6500,o=null;n>0&&(o=this.list[n-1],o.lyric);let d=null;n<this.list.length-1&&(d=this.list[n+1],s=d.lyric,t<d.lineStart-l&&Math.abs(e.lineEnd+l-d.lineStart)>5e3&&(s="")),t>e.lineEnd+r&&n++;let c=!0;if(t>=e.lineStart-r&&t<=e.lineEnd&&(null==d||t<=d.lineStart)){if(c=!0,i=0,t>=e.lineStart-r&&(c=!1),t>=e.lineStart&&1==this.isJrc&&null!=e.words)if(t<=e.lineEnd)for(let a=0;a<e.words.length;a++){const s=e.words[a];let l=s[0]+e.lineStart,n=s[1];if(!(t>=l))break;{let s=(t-l)/n;s=Math.min(s,1);let r=(a+0)/e.words.length;i=((a+1)/e.words.length-r)*s+r,i=Math.min(i+.05,1)}}else i=1;else i=(t-e.lineStart)/(d.lineStart-e.lineStart);i=Math.round(100*i);let o=e.lyric;t>e.lineEnd+l&&(o=""),1==c&&(s=""),a={line:n,lyric:o,processNum:i,processStr:i+"%",lyricNext:s,update:!0},this.playIndex=n,this.playTime=t;break}if(t<e.lineStart)break}return a}encodeKaraokeAss(e=0){if(0==this.list.length)return null;let t="";t+="[Script Info]\n",t+="; // 此字幕生成\n",t+="Title:歌曲名称\n",t+="ScriptType:v4.00+\n",t+="Collisions:Normal\n",t+="PlayResY: 720\n",t+="\n",t+="[V4+ Styles]\n",t+="Format: Name, Fontname, Fontsize, PrimaryColour, SecondaryColour, OutlineColour, BackColour, Bold, Italic, Underline, StrikeOut, ScaleX, ScaleY, Spacing, Angle, BorderStyle, Outline, Shadow, Alignment, MarginL, MarginR, MarginV, Encoding\n",t+="Style: Default,微软雅黑,50,&H00ff00,&Hffffff,&H00000000,&HF0000000,-1,0,0,0,100,100,0,0.00,1,2,1,2,5,5,5,134\n",t+="\n",t+="[Events]\n",t+="Format: Layer, Start, End, Style, Name, MarginL, MarginR, MarginV, Effect, Text\n";for(let i=0;i<this.list.length;i++){const a=this.list[i];let s=a.lineStart+e,l=a.lineEnd+e;if(!(s<0||l<0)&&(t+=`Dialogue: 0,${this.toTime(s)},${this.toTime(l)},Default,,0,0,0,,`,null!=a.words&&null!=a.lyric&&a.words.length==a.lyric.length))for(let e=0;e<a.words.length;e++){const i=a.lyric.charAt(e);a.words[e][0];const s=a.words[e][1];t+=`{\\k${Math.round(s/10)}}${i}`,e==a.words.length-1&&(t+="{\\k0}\n")}}return t}encodeKaraokeJrc(e=0){if(0==this.list.length)return null;let t=[];for(let s=0;s<this.list.length;s++){const i=this.list[s];let a=i.lineStart+e,l=i.lineEnd+e;a<0||l<0||(i.lyric,Math.round(a),Math.round(l),i.words,t.push([i.lyric,[a,l],i.words]))}let i="";try{i=JSON.stringify(t),i="[JRC=V2]"+i,i=i.replaceAll("},{","},\n{"),i=i.replaceAll("[{","[\n{"),i=i.replaceAll("}]","}\n]"),i=i.replaceAll("]],[","]],\n["),i=i.replaceAll("][[","][\n["),i=i.replaceAll("]]]]","]]]\n]")}catch(a){}return i}toTime(e){var t=String(e/10%100<<0),i=String(e/1e3%60<<0),a=String(e/6e4<<0);t.length<2&&(t="0"+t),i.length<2&&(i="0"+i),a.length<2&&(a="0"+a);return"0:"+a+":"+i+"."+t}}const na=class{constructor(){dt(this,"label"),dt(this,"fileBaseName"),dt(this,"path"),dt(this,"type"),dt(this,"duration"),dt(this,"durationStr"),dt(this,"thumbnail"),dt(this,"importTime"),dt(this,"creatTime"),dt(this,"isShow"),dt(this,"captureImage"),dt(this,"sourceWidth"),dt(this,"sourceHeight"),dt(this,"progress"),dt(this,"selected"),dt(this,"lrcParse"),dt(this,"isCutLimit",!1),dt(this,"isOverEnable",!1),dt(this,"iscapture",!1),dt(this,"response",null),dt(this,"audioBuffer"),dt(this,"audioSampleRate"),dt(this,"capturedZoom",{}),dt(this,"capturedZoomIndex",0),dt(this,"_sourceFile"),dt(this,"_resuuid"),dt(this,"_loadingThumb"),this._resuuid=yi.createUUID("MediaFile"),this.isShow=!0,this.progress=NaN,this.durationStr=""}get mediaId(){return this._resuuid}getLoadingThumb(){return this._loadingThumb}setSourceUrl(e){this.path=e}set sourceFile(e){if(this._sourceFile!=e){if(this._sourceFile=e,null==e)return;switch(this.label=e.name,this.fileBaseName=e.name.split(".")[0],this.type=sa.getFileType(e),this.creatTime=e.lastModified,this.path=window.webkitURL.createObjectURL(e),this.isCutLimit=!1,this.isOverEnable=!1,this.type==Qi.Image&&(this._loadingThumb=na.thumbImage,this.thumbnail=this.path,this.duration=60,this.isOverEnable=!0),this.type==Qi.ImageGIF?(this._loadingThumb=na.thumbImage,this.thumbnail=this.path,this.duration=60,this.isCutLimit=!0):this.type==Qi.Audio?(this._loadingThumb=na.thumbAudio,this.isCutLimit=!0):this.type==Qi.Video&&(this._loadingThumb=na.thumbVideo,this.isCutLimit=!0,this.isOverEnable=!0),this.type){case Qi.Lrc:case Qi.Krc:case Qi.Jrc:case Qi.Vtt:this._loadingThumb=na.thumbLrc}null==this.thumbnail&&(this.thumbnail=this._loadingThumb)}}get sourceFile(){return this._sourceFile}async parseSource(e,t){this.type==Qi.Video?sa.videoThumbCapture.loadVideo(this,(i=>{null!=e&&e.call(t,this)})):this.type==Qi.Audio?null!=this.thumbnail&&this.thumbnail!=na.thumbAudio?null!=e&&e.call(t,this):sa.audioCapture.loadAudio(this,(i=>{null==this.thumbnail&&(this.thumbnail=na.thumbAudio),null!=e&&e.call(t,this)})):this.type==Qi.Lrc||this.type==Qi.Jrc?(null==this.lrcParse&&(this.lrcParse=new la),this.lrcParse.loadLRC(this.path)):this.type==Qi.Krc?(null==this.lrcParse&&(this.lrcParse=new la),this.lrcParse.loadKRC(this.path)):this.type==Qi.Vtt?(null==this.lrcParse&&(this.lrcParse=new la),this.lrcParse.loadVTT(this.path)):null!=e&&e.call(t,this),this.progress=NaN}parseLrc(e){null!=e&&""!=e&&(null==this.lrcParse&&(this.lrcParse=new la),this.type==Qi.Vtt?this.lrcParse.parseVTT(e):this.lrcParse.parseLRC(e))}captureUpdate(){1!=this.iscapture&&(this.iscapture=!0,this.type==Qi.Video?this.captureVideoFrame(Ji.zoomIndex,!1):this.type==Qi.Audio&&this.captureAudioWave())}captureAudioWave(){null==this.captureImage&&(this.captureImage="",sa.audioWaveCapture.drawAudioWave(this))}captureVideoFrame(e,t){if("loading"!=this.capturedZoom[e])if(null==this.capturedZoom[e])this.capturedZoom[e]="loading",this.capturedZoomIndex=e,this.type==Qi.Video&&sa.videoCapture.loadVideo(this,{loading:t},(e=>{this.capturedZoom[this.capturedZoomIndex]=e.captureImage}));else{let t=this.capturedZoom[e];this.captureImage=t}}captureVideoFrameClear(){this.capturedZoom=null,this.capturedZoomIndex=0}captureSource(e,t){this.type==Qi.Audio&&sa.audioWaveCapture.drawAudioWave(this,(()=>{null!=e&&e.call(t,this)}))}clear(){this.label=null,this.path=null,this.type=null,this.duration=null,this.durationStr=null,this.thumbnail=null,this.importTime=null,this.creatTime=null,this.isShow=null,this.captureImage=null,this.sourceWidth=null,this.sourceHeight=null,this.progress=null,this.response=null,this._sourceFile=null,this._loadingThumb=null,this.selected=null,this.capturedZoom=null,null!=this.lrcParse&&(this.lrcParse.clear(),this.lrcParse=null),this.audioBuffer=null,this._sourceFile=null,this._loadingThumb=null}release(){this.clear()}};let ra=na;dt(ra,"thumbAudio",new URL(""+new URL("../jpg/type_audio-7347d8fc.jpg",import.meta.url).href,self.location).href),dt(ra,"thumbImage",new URL(""+new URL("../jpg/type_image-feca63cb.jpg",import.meta.url).href,self.location).href),dt(ra,"thumbVideo",new URL(""+new URL("../jpg/type_video-092ee7e4.jpg",import.meta.url).href,self.location).href),dt(ra,"thumbLrc",new URL(""+new URL("../jpg/type_lrc-1ca49274.jpg",import.meta.url).href,self.location).href);class oa{static getFileByMediaId(e){return this._maps[e]}static getFileByMediaUrlPath(e){return this._paths[e]}static addFile(e){if(e&&e.path){if(null!=e.sourceFile){for(let t=0;t<this._medialist.length;t++){if(this._medialist[t].path==e.path)return}this._medialist.push(e)}this._maps[e.mediaId]=e,null!=e.path&&""!=e.path&&(this._paths[e.path]=e)}return e}static removeFile(e){if(e&&e.path&&(delete this._maps[e.mediaId],delete this._paths[e.path],null!=e.sourceFile))for(let t=0;t<this._medialist.length;t++){if(this._medialist[t].path==e.path)return void this._medialist.splice(t--,1)}}static removeByIndex(e){if(e>=0&&e<this._medialist.length){let t=this._medialist[e];if(t)return delete this._maps[t.mediaId],delete this._paths[t.path],this._medialist.splice(e,1),!0}return!1}static clear(){this._maps={},this._medialist.length=0}static getFileList(){return this._medialist}}dt(oa,"_maps",{}),dt(oa,"_paths",{}),dt(oa,"_medialist",Tt([]));class da extends Yi{constructor(){super(),dt(this,"recorder"),dt(this,"captureStream",null),dt(this,"audioCtx",null),dt(this,"audioDest",null)}isTypeSupported(){return null!=typeof MediaRecorder&&null!=MediaRecorder&&MediaRecorder.isTypeSupported("audio/webm")}initRecorder(){MediaRecorder.isTypeSupported("audio/webm")}clear(){this.canvas=null,this.videoURL=null,Bi.clearAll(this)}async start(){if(null!=this.canvas&&1!=this.isRecording){this.captureStream=this.canvas.captureStream(30),null!=this.recorder&&(this.recorder.ondataavailable=null,this.recorder.onstart=null,this.recorder.onpause=null,this.recorder.onresume=null,this.recorder.onstop=null,this.recorder.onerror=null),this.initAudioContext(),this.captureStream.addTrack(this.audioDest.stream.getAudioTracks()[0]);var e=new MediaRecorder(this.captureStream,{mimeType:"video/webm"});this.recorder=e;var t=[];this.videoURL=null,e.ondataavailable=e=>{e.data&&e.data.size&&t.push(e.data)},e.onstart=()=>{this.state=ji.recording,Bi.send(ki.RecorderStateChange,this.state)},e.onpause=()=>{},e.onresume=()=>{},e.onerror=e=>{},e.onstop=async()=>{if(this.state=ji.stop,Bi.send(ki.RecorderStateChange,this.state),0==t.length);else{let e=new Blob(t,{type:"video/webm"});this.videoURL=URL.createObjectURL(e);let i=new ra;i.label="视频生成"+mi.randRangeInt(100,200),i.type=Qi.Video,i.thumbnail="./renderer/assets/images/media/type_recorder.jpg",i.path=this.videoURL,oa.addFile(i)}this.state=ji.complete,Bi.send(ki.RecorderComplete,this.state)},this.recorder=e,this.recorder.start(),Bi.send(ki.RecorderStateChange,this.isRecording,e.state)}}getVideoDataURL(){return this.videoURL}getEnableAudioSound(){return!0}initAudioContext(){null==this.audioCtx&&(this.audioCtx=new AudioContext,this.audioDest=this.audioCtx.createMediaStreamDestination())}attachMedia(e,t){if(null==this.canvas||null==e)return;let i=e.getMediaElement();if(null!=i&&null==e.sourceNode){this.initAudioContext();var a=this.audioCtx.createMediaElementSource(i);a.connect(this.audioDest),a.connect(this.audioCtx.destination),e.sourceNode=a}}pause(){this.recorder&&this.recorder.pause()}resume(){this.recorder&&this.recorder.resume()}async stop(){this.recorder&&"recording"==this.recorder.state&&this.recorder.stop()}}class ca{static copyAudioBuffer(e,t){const i=e.createBuffer(t.numberOfChannels,t.length,t.sampleRate);for(let a=0;a<t.numberOfChannels;a++){const e=t.getChannelData(a);i.getChannelData(a).set(e)}return i}static cutAudioBuffer(e,t,i,a){const s=t.numberOfChannels,l=e.createBuffer(s,Math.ceil((a-i)*e.sampleRate),t.sampleRate);for(let n=0;n<s;n++){const s=t.getChannelData(n),r=l.getChannelData(n);let o=Math.ceil(i*e.sampleRate),d=Math.ceil(a*e.sampleRate);o<0&&(o=0),d>s.length&&(d=s.length),r.set(s.slice(o,d),0)}return l}static mergeAudioBuffers(e,t){if(null==t||0==t.length)return null;if(1==t.length)return this.copyAudioBuffer(e,t[0]);let i=0,a=0,s=0;for(let r=0;r<t.length;r++){const e=t[r];a=e.sampleRate,s=e.numberOfChannels,i+=e.length}const l=e.createBuffer(s,i,a);let n=0;for(let r=0;r<t.length;r++){const e=t[r];for(let t=0;t<e.numberOfChannels;t++){const i=e.getChannelData(t);l.copyToChannel(i,t,n)}n+=e.length}return l}static mixAudioBuffers(e,t){if(null==t||0==t.length)return null;if(1==t.length)return this.copyAudioBuffer(e,t[0]);const i=Math.max(...t.map((e=>e.numberOfChannels))),a=Math.max(...t.map((e=>e.length))),s=t[0].sampleRate,l=e.createBuffer(i,a,s);for(let n=0;n<t.length;n++){const e=t[n];let a=null;for(let t=0;t<i;t++){const i=l.getChannelData(t);if(t<e.numberOfChannels&&(a=e.getChannelData(t)),null!=a)for(let t=0;t<e.length;t++)i[t]+=a[t]}}return l}static mergeOffsetAudioBuffers(e,t){if(null==t||0==t.length)return null;if(1==t.length&&t[0].offset<=0)return this.copyAudioBuffer(e,t[0].buffer);let i=0,a=0,s=0;for(let n=0;n<t.length;n++){const{buffer:l,offset:r}=t[n];a=l.sampleRate,s=l.numberOfChannels;let o=l.length+Math.ceil(r*e.sampleRate);i=Math.max(i,o)}const l=e.createBuffer(s,i,a);for(let n=0;n<t.length;n++){const{buffer:i,offset:a}=t[n];for(let t=0;t<i.numberOfChannels;t++){const s=i.getChannelData(t);l.copyToChannel(s,t,Math.ceil(a*e.sampleRate))}}return l}static splitAudioBuffer(e,t,i){if(null==e||null==t)return null;if(i<=0)return[t];let a=[],s=Math.ceil(t.length/Math.ceil(i*t.sampleRate));for(let l=0;l<s;l++){let n=i*t.sampleRate,r=n*l;if(r+n>t.length&&(n=t.length-r),l==s-2){(t.length-(r+n))/t.sampleRate<i/2&&(n=t.length-r,l=s)}const o=e.createBuffer(t.numberOfChannels,n,t.sampleRate);for(let e=0;e<t.numberOfChannels;e++){const i=t.getChannelData(e);let a=r,s=r+n;o.getChannelData(e).set(i.slice(a,s),0)}a.push(o)}return a}static playAudioBuffer(e,t,i){if(null!=this.audioSource&&(this.audioSource.disconnect(),this.audioSource=null),null!=e&&null!=t){this.audioSource=e.createBufferSource(),this.audioSource.buffer=t,this.audioSource.connect(e.destination),this.audioSource.playbackRate.value=i,this.audioSource.loop=!0,this.audioSource.start(0);let a=t.length/e.sampleRate;Vi.formatMillisTime(1e3*a,!0,!0)}}static stopAudioBuffer(){null!=this.audioSource&&(this.audioSource.disconnect(),this.audioSource=null)}static setVolumnFadeInOut(e,t,i,a){if(t<=0||isNaN(t))return e;if(t>=1&&(isNaN(i)||i<=0)&&(isNaN(a)||a<=0))return e;let s=i*e.sampleRate,l=1/s,n=a*e.sampleRate,r=1/s;Ui.timer.getTime();const o=e.numberOfChannels;for(let d=0;d<o;d++){const i=e.getChannelData(d),a=i.length;for(let e=0;e<i.length;e++)i[e]=i[e]*t,!isNaN(s)&&e<=s&&(i[e]=i[e]*(l*e)),!isNaN(n)&&e>=a-n&&(i[e]=i[e]*(r*(a-e)))}return e}static async resampleAudioBuffer(e,t,i){const a=Math.floor(t*i),s=new OfflineAudioContext(e.numberOfChannels,a,t),l=s.createBufferSource();l.buffer=e;const n=e.duration*e.sampleRate/(i*s.sampleRate);l.playbackRate.value=n,l.connect(s.destination),l.start();let r=await s.startRendering();return l.disconnect(),r}static downloadData(e){let t=null;if("string"==typeof e?t=e:e instanceof Blob&&(t=URL.createObjectURL(e)),null!=t){let e="a-down-load";var i=document.getElementById(e);null==i&&((i=document.createElement("a")).id=e,i.setAttribute("href",t),i.setAttribute("download",""),i.style.display="none"),document.body.appendChild(i),i.click(),document.body.removeChild(i)}}}dt(ca,"audioSource",null);class ua{static getAudioContext(){return null!=this.audioCtx||(this.audioCtx=new AudioContext,this.audioNode=this.audioCtx.createMediaStreamDestination()),this.audioCtx}static async executeTrackAudio(e,t){this.getAudioContext(),null==e&&(e=qs.datas);Ui.timer.getTime();let i=[];for(let s=0;s<e.length;s++){const t=e[s];if(1==t.isMute)continue;let a=[];for(let e=0;e<t.clips.length;e++){const i=t.clips[e];if(i.type==pi.Audio||i.type==pi.Video){if(i.media.volume<=0)continue;let e=i.getMediaFile();if(null==e||null==e.audioBuffer)continue;let t=e.audioBuffer,s=i.getCutTimeFragmentStart(),l=i.getCutTimeFragmentEnd(),n=i.time.start/1e3,r=ca.cutAudioBuffer(this.audioCtx,t,s,l);r=ca.setVolumnFadeInOut(r,i.media.volume/100,i.media.fadeIn,i.media.fadeOut),a.push({buffer:r,offset:n})}}if(a.length>0){let e=ca.mergeOffsetAudioBuffers(this.audioCtx,a);i.push(e)}}let a=null;return i.length>0&&(a=ca.mixAudioBuffers(this.audioCtx,i)),null!=this.source&&(this.source.disconnect(),this.source=null),null!=a&&1==t&&(this.source=this.audioCtx.createBufferSource(),this.source.buffer=a,this.source.connect(this.audioCtx.destination),this.source.start(0)),a}}dt(ua,"audioCtx",null),dt(ua,"audioNode",null),dt(ua,"source",null);class ha{constructor(e){dt(this,"value"),this.value=e}}class ma{constructor(e){dt(this,"value"),this.value=e}}var pa=(e=>(e[e.EBML=440786851]="EBML",e[e.EBMLVersion=17030]="EBMLVersion",e[e.EBMLReadVersion=17143]="EBMLReadVersion",e[e.EBMLMaxIDLength=17138]="EBMLMaxIDLength",e[e.EBMLMaxSizeLength=17139]="EBMLMaxSizeLength",e[e.DocType=17026]="DocType",e[e.DocTypeVersion=17031]="DocTypeVersion",e[e.DocTypeReadVersion=17029]="DocTypeReadVersion",e[e.SeekHead=290298740]="SeekHead",e[e.Seek=19899]="Seek",e[e.SeekID=21419]="SeekID",e[e.SeekPosition=21420]="SeekPosition",e[e.Duration=17545]="Duration",e[e.Info=357149030]="Info",e[e.TimestampScale=2807729]="TimestampScale",e[e.MuxingApp=19840]="MuxingApp",e[e.WritingApp=22337]="WritingApp",e[e.Tracks=374648427]="Tracks",e[e.TrackEntry=174]="TrackEntry",e[e.TrackNumber=215]="TrackNumber",e[e.TrackUID=29637]="TrackUID",e[e.TrackType=131]="TrackType",e[e.CodecID=134]="CodecID",e[e.CodecPrivate=25506]="CodecPrivate",e[e.DefaultDuration=2352003]="DefaultDuration",e[e.Video=224]="Video",e[e.PixelWidth=176]="PixelWidth",e[e.PixelHeight=186]="PixelHeight",e[e.Void=236]="Void",e[e.Audio=225]="Audio",e[e.SamplingFrequency=181]="SamplingFrequency",e[e.Channels=159]="Channels",e[e.BitDepth=25188]="BitDepth",e[e.Segment=408125543]="Segment",e[e.SimpleBlock=163]="SimpleBlock",e[e.Cluster=524531317]="Cluster",e[e.Timestamp=231]="Timestamp",e[e.Cues=475249515]="Cues",e[e.CuePoint=187]="CuePoint",e[e.CueTime=179]="CueTime",e[e.CueTrackPositions=183]="CueTrackPositions",e[e.CueTrack=247]="CueTrack",e[e.CueClusterPosition=241]="CueClusterPosition",e[e.Colour=21936]="Colour",e[e.MatrixCoefficients=21937]="MatrixCoefficients",e[e.TransferCharacteristics=21946]="TransferCharacteristics",e[e.Primaries=21947]="Primaries",e[e.Range=21945]="Range",e))(pa||{});const ga=e=>e<256?1:e<65536?2:e<1<<24?3:e<2**32?4:e<2**40?5:6;class fa{constructor(){ht(this,i),ht(this,s),ht(this,n),ht(this,o),dt(this,"pos",0),ht(this,e,new Uint8Array(8)),ht(this,t,new DataView(ut(this,e).buffer)),dt(this,"offsets",new WeakMap),dt(this,"dataOffsets",new WeakMap)}writeEBMLVarInt(i,a=(e=>{if(e<127)return 1;if(e<16383)return 2;if(e<2097151)return 3;if(e<268435455)return 4;if(e<2**35-1)return 5;if(e<2**42-1)return 6;throw new Error("EBML VINT size not supported "+e)})(i)){let s=0;switch(a){case 1:ut(this,t).setUint8(s++,128|i);break;case 2:ut(this,t).setUint8(s++,64|i>>8),ut(this,t).setUint8(s++,i);break;case 3:ut(this,t).setUint8(s++,32|i>>16),ut(this,t).setUint8(s++,i>>8),ut(this,t).setUint8(s++,i);break;case 4:ut(this,t).setUint8(s++,16|i>>24),ut(this,t).setUint8(s++,i>>16),ut(this,t).setUint8(s++,i>>8),ut(this,t).setUint8(s++,i);break;case 5:ut(this,t).setUint8(s++,8|i/2**32&7),ut(this,t).setUint8(s++,i>>24),ut(this,t).setUint8(s++,i>>16),ut(this,t).setUint8(s++,i>>8),ut(this,t).setUint8(s++,i);break;case 6:ut(this,t).setUint8(s++,4|i/2**40&3),ut(this,t).setUint8(s++,i/2**32|0),ut(this,t).setUint8(s++,i>>24),ut(this,t).setUint8(s++,i>>16),ut(this,t).setUint8(s++,i>>8),ut(this,t).setUint8(s++,i);break;default:throw new Error("Bad EBML VINT size "+a)}this.write(ut(this,e).subarray(0,s))}writeEBML(e){if(e instanceof Uint8Array)this.write(e);else if(Array.isArray(e))for(let t of e)this.writeEBML(t);else if(this.offsets.set(e,this.pos),pt(this,n,r).call(this,e.id),Array.isArray(e.data)){let t=this.pos,i=e.size??4;this.seek(this.pos+i);let a=this.pos;this.dataOffsets.set(e,a),this.writeEBML(e.data);let s=this.pos-a,l=this.pos;this.seek(t),this.writeEBMLVarInt(s,i),this.seek(l)}else if("number"==typeof e.data){let t=e.size??ga(e.data);this.writeEBMLVarInt(t),pt(this,n,r).call(this,e.data,t)}else"string"==typeof e.data?(this.writeEBMLVarInt(e.data.length),pt(this,o,d).call(this,e.data)):e.data instanceof Uint8Array?(this.writeEBMLVarInt(e.data.byteLength,e.size),this.write(e.data)):e.data instanceof ha?(this.writeEBMLVarInt(4),pt(this,i,a).call(this,e.data.value)):e.data instanceof ma&&(this.writeEBMLVarInt(8),pt(this,s,l).call(this,e.data.value))}}e=new WeakMap,t=new WeakMap,i=new WeakSet,a=function(i){ut(this,t).setFloat32(0,i,!1),this.write(ut(this,e).subarray(0,4))},s=new WeakSet,l=function(i){ut(this,t).setFloat64(0,i,!1),this.write(ut(this,e))},n=new WeakSet,r=function(i,a=ga(i)){let s=0;switch(a){case 6:ut(this,t).setUint8(s++,i/2**40|0);case 5:ut(this,t).setUint8(s++,i/2**32|0);case 4:ut(this,t).setUint8(s++,i>>24);case 3:ut(this,t).setUint8(s++,i>>16);case 2:ut(this,t).setUint8(s++,i>>8);case 1:ut(this,t).setUint8(s++,i);break;default:throw new Error("Bad UINT size "+a)}this.write(ut(this,e).subarray(0,s))},o=new WeakSet,d=function(e){this.write(new Uint8Array(e.split("").map((e=>e.charCodeAt(0)))))};class va extends fa{constructor(){super(),ht(this,c,new ArrayBuffer(65536)),ht(this,u,new Uint8Array(ut(this,c)))}ensureSize(e){let t=ut(this,c).byteLength;for(;t<e;)t*=2;if(t===ut(this,c).byteLength)return;let i=new ArrayBuffer(t),a=new Uint8Array(i);a.set(ut(this,u),0),mt(this,c,i),mt(this,u,a)}write(e){this.ensureSize(this.pos+e.byteLength),ut(this,u).set(e,this.pos),this.pos+=e.byteLength}seek(e){this.pos=e}finalize(){return this.ensureSize(this.pos),ut(this,c).slice(0,this.pos)}}c=new WeakMap,u=new WeakMap;const ya=2**24;class Ta extends fa{constructor(e){super(),ht(this,h,void 0),ht(this,m,[]),mt(this,h,e)}write(e){this.writeDataIntoChunks(e,this.pos),this.flushChunks(),this.pos+=e.byteLength}writeDataIntoChunks(e,t){let i=ut(this,m).findIndex((e=>e.start<=t&&t<e.start+ya));-1===i&&(i=this.createChunk(t));let a=ut(this,m)[i],s=t-a.start,l=e.subarray(0,Math.min(ya-s,e.byteLength));a.data.set(l,s);let n={start:s,end:s+l.byteLength};if(wa(a,n),0===a.written[0].start&&a.written[0].end===ya&&(a.shouldFlush=!0),ut(this,m).length>2){for(let e=0;e<ut(this,m).length-1;e++)ut(this,m)[e].shouldFlush=!0;this.flushChunks()}l.byteLength<e.byteLength&&this.writeDataIntoChunks(e.subarray(l.byteLength),t+l.byteLength)}createChunk(e){let t={start:Math.floor(e/ya)*ya,data:new Uint8Array(ya),written:[],shouldFlush:!1};return ut(this,m).push(t),ut(this,m).sort(((e,t)=>e.start-t.start)),ut(this,m).indexOf(t)}flushChunks(e=!1){for(let t=0;t<ut(this,m).length;t++){let i=ut(this,m)[t];if(i.shouldFlush||e){for(let e of i.written)ut(this,h).write({type:"write",data:i.data.subarray(e.start,e.end),position:i.start+e.start});ut(this,m).splice(t--,1)}}}seek(e){this.pos=e}finalize(){this.flushChunks(!0)}}h=new WeakMap,m=new WeakMap;const wa=(e,t)=>{let i=0,a=e.written.length-1,s=-1;for(;i<=a;){let l=Math.floor(i+(a-i+1)/2);e.written[l].start<=t.start?(i=l+1,s=l):a=l-1}for(e.written.splice(s+1,0,t),(-1===s||e.written[s].end<t.start)&&s++;s<e.written.length-1&&e.written[s].end>=e.written[s+1].start;)e.written[s].end=Math.max(e.written[s].end,e.written[s+1].end),e.written.splice(s+1,1)};class ba extends fa{constructor(e){super(),ht(this,p,[]),ht(this,g,void 0),mt(this,g,e)}write(e){ut(this,p).push({data:e.slice(),start:this.pos}),this.pos+=e.byteLength}seek(e){this.pos=e}flush(e){if(0===ut(this,p).length)return;let t=[],i=[...ut(this,p)].sort(((e,t)=>e.start-t.start));t.push({start:i[0].start,size:i[0].data.byteLength});for(let a=1;a<i.length;a++){let e=t[t.length-1],s=i[a];s.start<=e.start+e.size?e.size=Math.max(e.size,s.start+s.data.byteLength-e.start):t.push({start:s.start,size:s.data.byteLength})}for(let a of t){a.data=new Uint8Array(a.size);for(let e of ut(this,p))a.start<=e.start&&e.start<a.start+a.size&&a.data.set(e.data,e.start-a.start);let i=e&&a===t[t.length-1];ut(this,g).call(this,a.data,a.start,i)}ut(this,p).length=0}}p=new WeakMap,g=new WeakMap;const ka=1,Ca=1,Ma=32768,xa=4096;class Aa{constructor(e){if(ht(this,N),ht(this,O),ht(this,B),ht(this,z),ht(this,Z),ht(this,j),ht(this,X),ht(this,Q),ht(this,$),ht(this,ee),ht(this,ie),ht(this,se),ht(this,ne),ht(this,oe),ht(this,ce),ht(this,he),ht(this,pe),ht(this,fe),ht(this,f,void 0),ht(this,v,void 0),ht(this,y,void 0),ht(this,T,void 0),ht(this,w,void 0),ht(this,b,void 0),ht(this,k,void 0),ht(this,C,void 0),ht(this,M,void 0),ht(this,x,void 0),ht(this,A,void 0),ht(this,I,void 0),ht(this,S,void 0),ht(this,R,0),ht(this,L,[]),ht(this,E,[]),ht(this,P,0),ht(this,_,0),ht(this,D,void 0),ht(this,F,!1),pt(this,N,U).call(this,e),mt(this,v,e),"buffer"===e.target)mt(this,f,new va);else if(e.target instanceof FileSystemWritableFileStream)mt(this,f,new Ta(e.target));else{if("function"!=typeof e.target)throw new Error(`Invalid target: ${e.target}`);mt(this,f,new ba(e.target))}pt(this,O,V).call(this)}setVideoSize(e,t){ut(this,v)&&(ut(this,v).video.width=e,ut(this,v).video.height=t)}getVideoChunkCount(){return ut(this,L).length}getAudioChunkCount(){return ut(this,E).length}resetFileStream(){mt(this,b,null),mt(this,k,null),mt(this,C,null),mt(this,M,null),mt(this,x,null),mt(this,A,null),mt(this,I,null),mt(this,S,null),mt(this,R,0),ut(this,L).length=0,ut(this,E).length=0,mt(this,P,0),mt(this,_,0),mt(this,D,null),mt(this,F,!1),(ut(this,f)instanceof va||ut(this,f)instanceof Ta||ut(this,f)instanceof ba)&&ut(this,f).seek(0),pt(this,O,V).call(this)}addVideoChunk(e,t,i){let a=new Uint8Array(e.byteLength);e.copyTo(a),this.addVideoChunkRaw(a,e.type,i??e.timestamp,t)}addVideoChunkRaw(e,t,i,a){if(pt(this,fe,ve).call(this),!ut(this,v).video)throw new Error("No video track declared.");a&&pt(this,ie,ae).call(this,a);let s=pt(this,ne,re).call(this,e,t,i,ka);for("V_VP9"===ut(this,v).video.codec&&pt(this,se,le).call(this,s),mt(this,P,s.timestamp);ut(this,E).length>0&&ut(this,E)[0].timestamp<=s.timestamp;){let e=ut(this,E).shift();pt(this,oe,de).call(this,e)}!ut(this,v).audio||s.timestamp<=ut(this,_)||0==ut(this,E).length?pt(this,oe,de).call(this,s):ut(this,L).push(s),pt(this,$,q).call(this)}addAudioChunk(e,t,i){let a=new Uint8Array(e.byteLength);e.copyTo(a),this.addAudioChunkRaw(a,e.type,i??e.timestamp,t)}addAudioChunkRaw(e,t,i,a){if(pt(this,fe,ve).call(this),!ut(this,v).audio)throw new Error("No audio track declared.");let s=pt(this,ne,re).call(this,e,t,i,2);for(mt(this,_,s.timestamp);ut(this,L).length>0&&ut(this,L)[0].timestamp<=s.timestamp;){let e=ut(this,L).shift();pt(this,oe,de).call(this,e)}!ut(this,v).video||s.timestamp<=ut(this,P)?pt(this,oe,de).call(this,s):ut(this,E).push(s),(null==a?void 0:a.decoderConfig)&&pt(this,ce,ue).call(this,ut(this,x),a.decoderConfig.description),pt(this,$,q).call(this)}finalize(){for(;ut(this,L).length>0;)pt(this,oe,de).call(this,ut(this,L).shift());for(;ut(this,E).length>0;)pt(this,oe,de).call(this,ut(this,E).shift());pt(this,pe,ge).call(this),ut(this,f).writeEBML(ut(this,A));let e=ut(this,f).pos,t=ut(this,f).pos-ut(this,ee,te);return ut(this,f).seek(ut(this,f).offsets.get(ut(this,y))+4),ut(this,f).writeEBMLVarInt(t,6),ut(this,k).data=new ma(ut(this,R)),ut(this,f).seek(ut(this,f).offsets.get(ut(this,k))),ut(this,f).writeEBML(ut(this,k)),ut(this,w).data[0].data[1].data=ut(this,f).offsets.get(ut(this,A))-ut(this,ee,te),ut(this,w).data[1].data[1].data=ut(this,f).offsets.get(ut(this,T))-ut(this,ee,te),ut(this,w).data[2].data[1].data=ut(this,f).offsets.get(ut(this,b))-ut(this,ee,te),ut(this,f).seek(ut(this,f).offsets.get(ut(this,w))),ut(this,f).writeEBML(ut(this,w)),ut(this,f).seek(e),mt(this,F,!0),ut(this,f)instanceof va?ut(this,f).finalize():(ut(this,f)instanceof Ta?ut(this,f).finalize():ut(this,f)instanceof ba&&ut(this,f).flush(!0),null)}}f=new WeakMap,v=new WeakMap,y=new WeakMap,T=new WeakMap,w=new WeakMap,b=new WeakMap,k=new WeakMap,C=new WeakMap,M=new WeakMap,x=new WeakMap,A=new WeakMap,I=new WeakMap,S=new WeakMap,R=new WeakMap,L=new WeakMap,E=new WeakMap,P=new WeakMap,_=new WeakMap,D=new WeakMap,F=new WeakMap,N=new WeakSet,U=function(e){if(e.type&&"webm"!==e.type&&"matroska"!==e.type)throw new Error(`Invalid type: ${e.type}`)},O=new WeakSet,V=function(){pt(this,B,W).call(this),pt(this,z,G).call(this),pt(this,Z,H).call(this),pt(this,j,Y).call(this),pt(this,X,J).call(this),pt(this,Q,K).call(this),pt(this,$,q).call(this)},B=new WeakSet,W=function(){let e={id:pa.EBML,data:[{id:pa.EBMLVersion,data:1},{id:pa.EBMLReadVersion,data:1},{id:pa.EBMLMaxIDLength,data:4},{id:pa.EBMLMaxSizeLength,data:8},{id:pa.DocType,data:ut(this,v).type??"webm"},{id:pa.DocTypeVersion,data:2},{id:pa.DocTypeReadVersion,data:2}]};ut(this,f).writeEBML(e)},z=new WeakSet,G=function(){const e=new Uint8Array([28,83,187,107]),t=new Uint8Array([21,73,169,102]),i=new Uint8Array([22,84,174,107]);let a={id:pa.SeekHead,data:[{id:pa.Seek,data:[{id:pa.SeekID,data:e},{id:pa.SeekPosition,size:5,data:0}]},{id:pa.Seek,data:[{id:pa.SeekID,data:t},{id:pa.SeekPosition,size:5,data:0}]},{id:pa.Seek,data:[{id:pa.SeekID,data:i},{id:pa.SeekPosition,size:5,data:0}]}]};mt(this,w,a)},Z=new WeakSet,H=function(){let e={id:pa.Duration,data:new ma(0)};mt(this,k,e);let t={id:pa.Info,data:[{id:pa.TimestampScale,data:1e6},{id:pa.MuxingApp,data:""},{id:pa.WritingApp,data:""},e]};mt(this,T,t)},j=new WeakSet,Y=function(){let e={id:pa.Tracks,data:[]};if(mt(this,b,e),ut(this,v).video){mt(this,M,{id:pa.Void,size:4,data:new Uint8Array(xa)});let t={id:pa.Colour,data:[{id:pa.MatrixCoefficients,data:2},{id:pa.TransferCharacteristics,data:2},{id:pa.Primaries,data:2},{id:pa.Range,data:0}]};mt(this,C,t),e.data.push({id:pa.TrackEntry,data:[{id:pa.TrackNumber,data:ka},{id:pa.TrackUID,data:ka},{id:pa.TrackType,data:Ca},{id:pa.CodecID,data:ut(this,v).video.codec},ut(this,M),ut(this,v).video.frameRate?{id:pa.DefaultDuration,data:1e9/ut(this,v).video.frameRate}:null,{id:pa.Video,data:[{id:pa.PixelWidth,data:ut(this,v).video.width},{id:pa.PixelHeight,data:ut(this,v).video.height},t]}].filter(Boolean)})}ut(this,v).audio&&(mt(this,x,{id:pa.Void,size:4,data:new Uint8Array(xa)}),e.data.push({id:pa.TrackEntry,data:[{id:pa.TrackNumber,data:2},{id:pa.TrackUID,data:2},{id:pa.TrackType,data:2},{id:pa.CodecID,data:ut(this,v).audio.codec},ut(this,x),{id:pa.Audio,data:[{id:pa.SamplingFrequency,data:new ha(ut(this,v).audio.sampleRate)},{id:pa.Channels,data:ut(this,v).audio.numberOfChannels},ut(this,v).audio.bitDepth?{id:pa.BitDepth,data:ut(this,v).audio.bitDepth}:null].filter(Boolean)}]}))},X=new WeakSet,J=function(){let e={id:pa.Segment,size:6,data:[ut(this,w),ut(this,T),ut(this,b)]};mt(this,y,e),ut(this,f).writeEBML(e)},Q=new WeakSet,K=function(){mt(this,A,{id:pa.Cues,data:[]})},$=new WeakSet,q=function(){ut(this,f)instanceof ba&&ut(this,f).flush(!1)},ee=new WeakSet,te=function(){return ut(this,f).dataOffsets.get(ut(this,y))},ie=new WeakSet,ae=function(e){if(e.decoderConfig){if(e.decoderConfig.colorSpace){let t=e.decoderConfig.colorSpace;mt(this,D,t),ut(this,C).data=[{id:pa.MatrixCoefficients,data:{rgb:1,bt709:1,bt470bg:5,smpte170m:6}[t.matrix]},{id:pa.TransferCharacteristics,data:{bt709:1,smpte170m:6,"iec61966-2-1":13}[t.transfer]},{id:pa.Primaries,data:{bt709:1,bt470bg:5,smpte170m:6}[t.primaries]},{id:pa.Range,data:[1,2][Number(t.fullRange)]}];let i=ut(this,f).pos;ut(this,f).seek(ut(this,f).offsets.get(ut(this,C))),ut(this,f).writeEBML(ut(this,C)),ut(this,f).seek(i)}e.decoderConfig.description&&pt(this,ce,ue).call(this,ut(this,M),e.decoderConfig.description)}},se=new WeakSet,le=function(e){if("key"!==e.type)return;if(!ut(this,D))return;let t=0;if(2!==Ia(e.data,0,2))return;t+=2;let i=(Ia(e.data,t+1,t+2)<<1)+Ia(e.data,t+0,t+1);t+=2,3===i&&t++;let a=Ia(e.data,t+0,t+1);if(t++,a)return;let s=Ia(e.data,t+0,t+1);if(t++,0!==s)return;t+=2;let l=Ia(e.data,t+0,t+24);if(t+=24,4817730!==l)return;i>=2&&t++;let n={rgb:7,bt709:2,bt470bg:1,smpte170m:3}[ut(this,D).matrix];Sa(e.data,t+0,t+3,n)},ne=new WeakSet,re=function(e,t,i,a){return{data:e,type:t,timestamp:i,trackNumber:a}},oe=new WeakSet,de=function(e){let t=Math.floor(e.timestamp/1e3);if("key"!==e.type&&t-ut(this,S)>=Ma)throw new Error("Current Matroska cluster exceeded its maximum allowed length of 32768 milliseconds. In order to produce a correct WebM file, you must pass in a video key frame at least every 32768 milliseconds.");let i=(e.trackNumber===ka||!ut(this,v).video)&&"key"===e.type&&t-ut(this,S)>=1e3;ut(this,I)&&!i||pt(this,he,me).call(this,t);let a=new Uint8Array(4),s=new DataView(a.buffer);s.setUint8(0,128|e.trackNumber),s.setUint16(1,t-ut(this,S),!1),s.setUint8(3,Number("key"===e.type)<<7);let l={id:pa.SimpleBlock,data:[a,e.data]};ut(this,f).writeEBML(l),mt(this,R,Math.max(ut(this,R),t))},ce=new WeakSet,ue=function(e,t){let i=ut(this,f).pos;ut(this,f).seek(ut(this,f).offsets.get(e)),e=[{id:pa.CodecPrivate,size:4,data:new Uint8Array(t)},{id:pa.Void,size:4,data:new Uint8Array(4090-t.byteLength)}],ut(this,f).writeEBML(e),ut(this,f).seek(i)},he=new WeakSet,me=function(e){ut(this,I)&&pt(this,pe,ge).call(this),mt(this,I,{id:pa.Cluster,size:5,data:[{id:pa.Timestamp,data:e}]}),ut(this,f).writeEBML(ut(this,I)),mt(this,S,e);let t=ut(this,f).offsets.get(ut(this,I))-ut(this,ee,te);ut(this,A).data.push({id:pa.CuePoint,data:[{id:pa.CueTime,data:e},{id:pa.CueTrackPositions,data:[{id:pa.CueTrack,data:ka},{id:pa.CueClusterPosition,data:t}]}]})},pe=new WeakSet,ge=function(){let e=ut(this,f).pos-ut(this,f).dataOffsets.get(ut(this,I)),t=ut(this,f).pos;ut(this,f).seek(ut(this,f).offsets.get(ut(this,I))+4),ut(this,f).writeEBMLVarInt(e,5),ut(this,f).seek(t)},fe=new WeakSet,ve=function(){if(ut(this,F))throw new Error("Cannot add new video or audio chunks after the file has been finalized.")};const Ia=(e,t,i)=>{let a=0;for(let s=t;s<i;s++){let t=7-(7&s);a<<=1,a|=(e[Math.floor(s/8)]&1<<t)>>t}return a},Sa=(e,t,i,a)=>{for(let s=t;s<i;s++){let t=Math.floor(s/8),l=e[t],n=7-(7&s);l&=~(1<<n),l|=(a&1<<i-s-1)>>i-s-1<<n,e[t]=l}};class Ra extends Yi{constructor(){super(...arguments),dt(this,"videoEncoder"),dt(this,"audioEncoder"),dt(this,"_muxer"),dt(this,"startTime",null),dt(this,"lastKeyFrame",null),dt(this,"recordRate",1),dt(this,"firstVideoTimestamp",null),dt(this,"firstAudioTimestamp",null),dt(this,"mixAudioBuffer",null)}isTypeSupported(){return null!=typeof VideoEncoder&&null!=VideoEncoder}getWebMMuxer(e,t,i,a){return null==this._muxer&&(this._muxer=new Aa({target:"buffer",video:{codec:"V_VP9",width:e.width,height:e.height,frameRate:t},audio:{codec:"A_OPUS",sampleRate:i,numberOfChannels:a}})),this._muxer}async start(){if(null==this.canvas)return;if(1==this.isRecording)return;let e=ua.getAudioContext().sampleRate,t=this.getWebMMuxer(this.canvas,30,e,2);t.resetFileStream(),t.setVideoSize(this.canvas.width,this.canvas.height),this.recordRate=Mi.playbackRate;RTCRtpSender.getCapabilities("video").codecs,RTCRtpReceiver.getCapabilities("video").codecs;const i={codec:"vp09.00.10.08",hardwareAcceleration:"no-preference",width:this.canvas.width,height:this.canvas.height,bitrate:5e6,framerate:30,alpha:"discard"};let a=await VideoEncoder.isConfigSupported(i);if(null==i||null==a)return void this.stop();this.firstVideoTimestamp=null,this.videoEncoder=new VideoEncoder({output:(e,i)=>{if(1==this.isRecording){null===this.firstVideoTimestamp&&(this.firstVideoTimestamp=e.timestamp);let a=e.timestamp-this.firstVideoTimestamp;t.addVideoChunk(e,i,a)}},error:e=>this.onVideoEncoderError(e)}),this.videoEncoder.configure(i),this.firstAudioTimestamp=null,this.audioEncoder=new AudioEncoder({output:(e,i)=>{if(1==this.isRecording){null===this.firstAudioTimestamp&&(this.firstAudioTimestamp=e.timestamp);let a=e.timestamp-this.firstAudioTimestamp;t.addAudioChunk(e,i,a)}},error:e=>this.onAudioEncoderError(e)});let s={codec:"opus",sampleRate:e,numberOfChannels:2,bitrate:48e4};await AudioEncoder.isConfigSupported(s);this.audioEncoder.configure(s),this.encodePlayTrackAudio(),this.state=ji.recording,Bi.send(ki.RecorderStateChange,this.state),null!=this.onStartCallback&&this.onStartCallback()}getEncodeQueueSize(){return 1==this.isRecording&&null!=this.videoEncoder?this.videoEncoder.encodeQueueSize:-1}getEnableAudioSound(){return!1}async beforeReadying(){super.beforeReadying(),this.firstAudioTimestamp=null,this.firstVideoTimestamp=null,this.mixAudioBuffer=await ua.executeTrackAudio()}encodePlayTrackAudio(){if(null!=this.mixAudioBuffer){const e=new Float32Array(this.mixAudioBuffer.length*this.mixAudioBuffer.numberOfChannels);for(let a=0;a<this.mixAudioBuffer.numberOfChannels;a++)e.set(this.mixAudioBuffer.getChannelData(a),a*this.mixAudioBuffer.length);let t=new AudioData({format:"f32-planar",sampleRate:this.mixAudioBuffer.sampleRate,numberOfFrames:this.mixAudioBuffer.length,numberOfChannels:this.mixAudioBuffer.numberOfChannels,timestamp:Date.now(),data:e});this.audioEncoder.encode(t),t.close();let i=ua.getAudioContext();ca.playAudioBuffer(i,this.mixAudioBuffer,Mi.playbackRate)}}onVideoEncoderError(e){this.stop()}onAudioEncoderError(e){this.stop()}onRenderFrameCanvas(e,t){if(null==this.canvas)return;if(1!=this.isRecording)return;if(this.state!=ji.recording)return;if("closed"==this.videoEncoder.state)return void this.stop();let i=0;if(isNaN(e)){let e=document.timeline.currentTime;null==this.startTime&&(this.startTime=e),i=(e-this.startTime)*this.recordRate}else i=1e3*e;let a=Math.ceil(1e3*i),s=new VideoFrame(this.canvas,{timestamp:a});null==this.lastKeyFrame&&(this.lastKeyFrame=i);let l=i-this.lastKeyFrame>=1e4;l&&(this.lastKeyFrame=i),this.videoEncoder.encode(s,{keyFrame:l}),s.close()}async onComplete(){if(null==this._muxer)return!1;let e=this._muxer.finalize();if(this._muxer.resetFileStream(),null==e||0==e.byteLength)return!1;{let t=new Blob([e],{type:"video/webm"});this.videoURL=URL.createObjectURL(t);let i=new ra;return i.label="视频生成"+mi.randRangeInt(100,200),i.type=Qi.Video,i.thumbnail="./renderer/assets/images/media/type_recorder.jpg",i.path=this.videoURL,i.parseSource(),oa.addFile(i),!0}}getVideoDataURL(){return this.videoURL}async stop(){if(1!=this.isRecording)return;this.state=ji.stop,ca.stopAudioBuffer(),this.mixAudioBuffer=null,this.videoEncoder&&(this.videoEncoder.encodeQueueSize>0&&await this.videoEncoder.flush(),"closed"!=this.videoEncoder.state&&this.videoEncoder.close(),this.videoEncoder=null),this.audioEncoder&&(this.audioEncoder.encodeQueueSize>0&&await this.audioEncoder.flush(),"closed"!=this.audioEncoder.state&&this.audioEncoder.close(),this.audioEncoder=null);let e=await this.onComplete();this.startTime=null,this.lastKeyFrame=null,Bi.send(ki.RecorderStateChange,this.state),1==e&&(this.state=ji.complete,Bi.send(ki.RecorderComplete,this.state))}clear(){this.canvas=null,this.videoURL=null,this.state=ji.initial,Bi.clearAll(this)}}let La=new Uint8Array(8),Ea=new DataView(La.buffer);const Pa=e=>[(e%256+256)%256],_a=e=>(Ea.setUint16(0,e,!1),[La[0],La[1]]),Da=e=>(Ea.setUint32(0,e,!1),[La[1],La[2],La[3]]),Fa=e=>(Ea.setUint32(0,e,!1),[La[0],La[1],La[2],La[3]]),Na=e=>(Ea.setUint8(0,e),Ea.setUint8(1,e<<8),[La[0],La[1]]),Ua=e=>(Ea.setUint16(0,e,!1),Ea.setUint16(2,e<<16,!1),[La[0],La[1],La[2],La[3]]),Oa=(e,t=!1)=>{let i=Array(e.length).fill(null).map(((t,i)=>e.charCodeAt(i)));return t&&i.push(0),i},Va=e=>e&&e[e.length-1],Ba=(e,t,i=!0)=>{let a=e*t;return i?Math.round(a):a},Wa=[65536,0,0,0,65536,0,0,0,1073741824].map(Fa),za=(e,t,i)=>({type:e,contents:t&&new Uint8Array(t.flat(10)),children:i}),Ga=(e,t,i,a,s)=>za(e,[Pa(t),Da(i),a??[]],s),Za=(e,t)=>{let i=Ba(Math.max(0,...t.filter((e=>e.samples.length>0)).map((e=>Va(e.samples).timestamp+Va(e.samples).duration))),Cs),a=Math.max(...t.map((e=>e.id)))+1;return Ga("mvhd",0,0,[Fa(e),Fa(e),Fa(Cs),Fa(i),Ua(1),Na(1),Array(10).fill(0),Wa,Array(24).fill(0),Fa(a)])},Ha=(e,t)=>za("trak",null,[ja(e,t),Ya(e,t)]),ja=(e,t)=>{let i=Va(e.samples),a=Ba(i?i.timestamp+i.duration:0,Cs);return Ga("tkhd",0,3,[Fa(t),Fa(t),Fa(e.id),Fa(0),Fa(a),Array(8).fill(0),_a(0),_a(0),Na("audio"===e.info.type?1:0),_a(0),Wa,Ua("video"===e.info.type?e.info.width:0),Ua("video"===e.info.type?e.info.height:0)])},Ya=(e,t)=>za("mdia",null,[Xa(e,t),Ja("video"===e.info.type?"vide":"soun"),Qa(e)]),Xa=(e,t)=>{let i=Va(e.samples),a=Ba(i?i.timestamp+i.duration:0,e.timescale);return Ga("mdhd",0,0,[Fa(t),Fa(t),Fa(e.timescale),Fa(a),_a(21956),_a(0)])},Ja=e=>Ga("hdlr",0,0,[Oa("mhlr"),Oa(e),Fa(0),Fa(0),Fa(0),Oa("mp4-muxer-hdlr")]),Qa=e=>za("minf",null,["video"===e.info.type?Ka():$a(),qa(),is(e)]),Ka=()=>Ga("vmhd",0,1,[_a(0),_a(0),_a(0),_a(0)]),$a=()=>Ga("smhd",0,0,[_a(0),_a(0)]),qa=()=>za("dinf",null,[es()]),es=()=>Ga("dref",0,0,[Fa(1)],[ts()]),ts=()=>Ga("url ",0,1),is=e=>za("stbl",null,[as(e),ds(e),cs(e),us(e),hs(e),ms(e)]),as=e=>Ga("stsd",0,0,[Fa(1)],["video"===e.info.type?ss("avc"===e.info.codec?"avc1":"hvc1",e,"avc"===e.info.codec?ls(e):ns(e)):rs("mp4a",e,os(e))]),ss=(e,t,i)=>{return za(e,[Array(6).fill(0),_a(1),_a(0),_a(0),Array(12).fill(0),_a(t.info.width),_a(t.info.height),Fa(4718592),Fa(4718592),Fa(0),_a(1),Array(32).fill(0),_a(24),(a=65535,Ea.setInt16(0,a,!1),[La[0],La[1]])],[i]);var a},ls=e=>e.codecPrivate&&za("avcC",[...e.codecPrivate]),ns=e=>e.codecPrivate&&za("hvcC",[...e.codecPrivate]),rs=(e,t,i)=>za(e,[Array(6).fill(0),_a(1),_a(0),_a(0),Fa(0),_a(t.info.numberOfChannels),_a(16),_a(0),_a(0),Ua(t.info.sampleRate)],[i]),os=e=>Ga("esds",0,0,[Fa(58753152),Pa(32+e.codecPrivate.byteLength),_a(1),Pa(0),Fa(75530368),Pa(18+e.codecPrivate.byteLength),Pa(64),Pa(21),Da(0),Fa(130071),Fa(130071),Fa(92307584),Pa(e.codecPrivate.byteLength),...e.codecPrivate,Fa(109084800),Pa(1),Pa(2)]),ds=e=>Ga("stts",0,0,[Fa(e.timeToSampleTable.length),e.timeToSampleTable.map((e=>[Fa(e.sampleCount),Fa(e.sampleDelta)]))]),cs=e=>{if(e.samples.every((e=>"key"===e.type)))return null;let t=[...e.samples.entries()].filter((([,e])=>"key"===e.type));return Ga("stss",0,0,[Fa(t.length),t.map((([e])=>Fa(e+1)))])},us=e=>Ga("stsc",0,0,[Fa(e.compactlyCodedChunkTable.length),e.compactlyCodedChunkTable.map((e=>[Fa(e.firstChunk),Fa(e.samplesPerChunk),Fa(1)]))]),hs=e=>Ga("stsz",0,0,[Fa(0),Fa(e.samples.length),e.samples.map((e=>Fa(e.size)))]),ms=e=>e.writtenChunks.length>0&&Va(e.writtenChunks).offset>=2**32?Ga("co64",0,0,[Fa(e.writtenChunks.length),e.writtenChunks.map((e=>{return t=e.offset,Ea.setUint32(0,Math.floor(t/2**32),!1),Ea.setUint32(4,t,!1),[La[0],La[1],La[2],La[3],La[4],La[5],La[6],La[7]];var t}))]):Ga("stco",0,0,[Fa(e.writtenChunks.length),e.writtenChunks.map((e=>Fa(e.offset)))]);class ps{constructor(){dt(this,"buffer",null)}}class gs{constructor(e,t,i){this.onData=e,this.onDone=t,this.options=i}}class fs{constructor(e){this.stream=e}}class vs{constructor(){dt(this,"pos",0),ht(this,ye,new Uint8Array(8)),ht(this,Te,new DataView(ut(this,ye).buffer)),dt(this,"offsets",new WeakMap)}seek(e){this.pos=e}writeU32(e){ut(this,Te).setUint32(0,e,!1),this.write(ut(this,ye).subarray(0,4))}writeU64(e){ut(this,Te).setUint32(0,Math.floor(e/2**32),!1),ut(this,Te).setUint32(4,e,!1),this.write(ut(this,ye).subarray(0,8))}writeAscii(e){for(let t=0;t<e.length;t++)ut(this,Te).setUint8(t%8,e.charCodeAt(t)),t%8==7&&this.write(ut(this,ye));e.length%8!=0&&this.write(ut(this,ye).subarray(0,e.length%8))}writeBox(e){if(this.offsets.set(e,this.pos),e.contents&&!e.children)this.writeBoxHeader(e,e.size??e.contents.byteLength+8),this.write(e.contents);else{let t=this.pos;if(this.writeBoxHeader(e,0),e.contents&&this.write(e.contents),e.children)for(let s of e.children)s&&this.writeBox(s);let i=this.pos,a=e.size??i-t;this.pos=t,this.writeBoxHeader(e,a),this.pos=i}}writeBoxHeader(e,t){this.writeU32(e.largeSize?1:t),this.writeAscii(e.type),e.largeSize&&this.writeU64(t)}patchBox(e){let t=this.pos;this.pos=this.offsets.get(e),this.writeBox(e),this.pos=t}}ye=new WeakMap,Te=new WeakMap;class ys extends vs{constructor(e){super(),ht(this,Ce),ht(this,we,void 0),ht(this,be,new ArrayBuffer(65536)),ht(this,ke,new Uint8Array(ut(this,be))),mt(this,we,e)}write(e){pt(this,Ce,Me).call(this,this.pos+e.byteLength),ut(this,ke).set(e,this.pos),this.pos+=e.byteLength}finalize(){pt(this,Ce,Me).call(this,this.pos),ut(this,we).buffer=ut(this,be).slice(0,this.pos)}}we=new WeakMap,be=new WeakMap,ke=new WeakMap,Ce=new WeakSet,Me=function(e){let t=ut(this,be).byteLength;for(;t<e;)t*=2;if(t===ut(this,be).byteLength)return;let i=new ArrayBuffer(t),a=new Uint8Array(i);a.set(ut(this,ke),0),mt(this,be,i),mt(this,ke,a)};class Ts extends vs{constructor(e){super(),ht(this,xe,void 0),ht(this,Ae,[]),mt(this,xe,e)}write(e){ut(this,Ae).push({data:e.slice(),start:this.pos}),this.pos+=e.byteLength}flush(){if(0===ut(this,Ae).length)return;let e=[],t=[...ut(this,Ae)].sort(((e,t)=>e.start-t.start));e.push({start:t[0].start,size:t[0].data.byteLength});for(let i=1;i<t.length;i++){let a=e[e.length-1],s=t[i];s.start<=a.start+a.size?a.size=Math.max(a.size,s.start+s.data.byteLength-a.start):e.push({start:s.start,size:s.data.byteLength})}for(let i of e){i.data=new Uint8Array(i.size);for(let e of ut(this,Ae))i.start<=e.start&&e.start<i.start+i.size&&i.data.set(e.data,e.start-i.start);ut(this,xe).onData(i.data,i.start)}ut(this,Ae).length=0}finalize(){var e,t;null==(t=(e=ut(this,xe)).onDone)||t.call(e)}}xe=new WeakMap,Ae=new WeakMap;const ws=2**24;class bs extends vs{constructor(e){super(),ht(this,Re),ht(this,Ee),ht(this,_e),ht(this,Fe),ht(this,Ie,void 0),ht(this,Se,[]),mt(this,Ie,e)}write(e){pt(this,Re,Le).call(this,e,this.pos),pt(this,Fe,Ne).call(this),this.pos+=e.byteLength}finalize(){var e,t;pt(this,Fe,Ne).call(this,!0),null==(t=(e=ut(this,Ie)).onDone)||t.call(e)}}Ie=new WeakMap,Se=new WeakMap,Re=new WeakSet,Le=function(e,t){let i=ut(this,Se).findIndex((e=>e.start<=t&&t<e.start+ws));-1===i&&(i=pt(this,_e,De).call(this,t));let a=ut(this,Se)[i],s=t-a.start,l=e.subarray(0,Math.min(ws-s,e.byteLength));a.data.set(l,s);let n={start:s,end:s+l.byteLength};if(pt(this,Ee,Pe).call(this,a,n),0===a.written[0].start&&a.written[0].end===ws&&(a.shouldFlush=!0),ut(this,Se).length>2){for(let e=0;e<ut(this,Se).length-1;e++)ut(this,Se)[e].shouldFlush=!0;pt(this,Fe,Ne).call(this)}l.byteLength<e.byteLength&&pt(this,Re,Le).call(this,e.subarray(l.byteLength),t+l.byteLength)},Ee=new WeakSet,Pe=function(e,t){let i=0,a=e.written.length-1,s=-1;for(;i<=a;){let l=Math.floor(i+(a-i+1)/2);e.written[l].start<=t.start?(i=l+1,s=l):a=l-1}for(e.written.splice(s+1,0,t),(-1===s||e.written[s].end<t.start)&&s++;s<e.written.length-1&&e.written[s].end>=e.written[s+1].start;)e.written[s].end=Math.max(e.written[s].end,e.written[s+1].end),e.written.splice(s+1,1)},_e=new WeakSet,De=function(e){let t={start:Math.floor(e/ws)*ws,data:new Uint8Array(ws),written:[],shouldFlush:!1};return ut(this,Se).push(t),ut(this,Se).sort(((e,t)=>e.start-t.start)),ut(this,Se).indexOf(t)},Fe=new WeakSet,Ne=function(e=!1){for(let t=0;t<ut(this,Se).length;t++){let i=ut(this,Se)[t];if(i.shouldFlush||e){for(let e of i.written)ut(this,Ie).onData(i.data.subarray(e.start,e.end),i.start+e.start);ut(this,Se).splice(t--,1)}}};class ks extends bs{constructor(e){super(new gs(((t,i)=>e.stream.write({type:"write",data:t,position:i}))))}}const Cs=1e3,Ms=["avc","hevc"],xs=["aac"],As=["strict","offset"];class Is{constructor(e){var t;if(ht(this,Ze),ht(this,je),ht(this,Xe),ht(this,Qe),ht(this,$e),ht(this,et),ht(this,it),ht(this,st),ht(this,nt),dt(this,"target"),ht(this,Ue,void 0),ht(this,Oe,void 0),ht(this,Ve,void 0),ht(this,Be,null),ht(this,We,null),ht(this,ze,Math.floor(Date.now()/1e3)+2082844800),ht(this,Ge,!1),pt(this,Ze,He).call(this,e),this.target=e.target,mt(this,Ue,{firstTimestampBehavior:"strict",...e}),e.target instanceof ps)mt(this,Oe,new ys(e.target));else if(e.target instanceof gs)mt(this,Oe,(null==(t=e.target.options)?void 0:t.chunked)?new bs(e.target):new Ts(e.target));else{if(!(e.target instanceof fs))throw new Error(`Invalid target: ${e.target}`);mt(this,Oe,new ks(e.target))}pt(this,je,Ye).call(this),pt(this,Xe,Je).call(this)}resetFileStream(){mt(this,Ge,!1),(ut(this,Oe)instanceof ys||ut(this,Oe)instanceof gs||ut(this,Oe)instanceof fs)&&ut(this,Oe).seek(0),pt(this,je,Ye).call(this),pt(this,Xe,Je).call(this)}setVideoSize(e,t){ut(this,Ue)&&(ut(this,Ue).video.width=e,ut(this,Ue).video.height=t,pt(this,Xe,Je).call(this))}addVideoChunk(e,t,i){let a=new Uint8Array(e.byteLength);e.copyTo(a),this.addVideoChunkRaw(a,e.type,i??e.timestamp,e.duration,t)}addVideoChunkRaw(e,t,i,a,s){if(pt(this,nt,rt).call(this),!ut(this,Ue).video)throw new Error("No video track declared.");pt(this,$e,qe).call(this,ut(this,Be),e,t,i,a,s)}addAudioChunk(e,t,i){let a=new Uint8Array(e.byteLength);e.copyTo(a),this.addAudioChunkRaw(a,e.type,i??e.timestamp,e.duration,t)}addAudioChunkRaw(e,t,i,a,s){if(pt(this,nt,rt).call(this),!ut(this,Ue).audio)throw new Error("No audio track declared.");pt(this,$e,qe).call(this,ut(this,We),e,t,i,a,s)}finalize(){ut(this,Be)&&pt(this,it,at).call(this,ut(this,Be)),ut(this,We)&&pt(this,it,at).call(this,ut(this,We));let e=ut(this,Oe).offsets.get(ut(this,Ve)),t=ut(this,Oe).pos-e;ut(this,Ve).size=t,ut(this,Oe).patchBox(ut(this,Ve));let i=(a=[ut(this,Be),ut(this,We)].filter(Boolean),s=ut(this,ze),za("moov",null,[Za(s,a),...a.map((e=>Ha(e,s)))]));var a,s;ut(this,Oe).writeBox(i),pt(this,st,lt).call(this),ut(this,Oe).finalize(),mt(this,Ge,!0)}}Ue=new WeakMap,Oe=new WeakMap,Ve=new WeakMap,Be=new WeakMap,We=new WeakMap,ze=new WeakMap,Ge=new WeakMap,Ze=new WeakSet,He=function(e){if(e.video&&!Ms.includes(e.video.codec))throw new Error(`Unsupported video codec: ${e.video.codec}`);if(e.audio&&!xs.includes(e.audio.codec))throw new Error(`Unsupported audio codec: ${e.audio.codec}`);if(e.firstTimestampBehavior&&!As.includes(e.firstTimestampBehavior))throw new Error(`Invalid first timestamp behavior: ${e.firstTimestampBehavior}`)},je=new WeakSet,Ye=function(){var e;let t="hevc"===(null==(e=ut(this,Ue).video)?void 0:e.codec);ut(this,Oe).writeBox((e=>za("ftyp",e?[Oa("isom"),Fa(0),Oa("iso4"),Oa("hvc1")]:[Oa("isom"),Fa(0),Oa("isom"),Oa("avc1"),Oa("mp41")]))(t)),mt(this,Ve,{type:"mdat",largeSize:!0}),ut(this,Oe).writeBox(ut(this,Ve)),pt(this,st,lt).call(this)},Xe=new WeakSet,Je=function(){if(ut(this,Ue).video&&mt(this,Be,{id:1,info:{type:"video",codec:ut(this,Ue).video.codec,width:ut(this,Ue).video.width,height:ut(this,Ue).video.height},timescale:720,codecPrivate:new Uint8Array(0),samples:[],writtenChunks:[],currentChunk:null,firstTimestamp:void 0,lastTimestamp:-1,timeToSampleTable:[],lastTimescaleUnits:null,compactlyCodedChunkTable:[]}),ut(this,Ue).audio){let e=pt(this,Qe,Ke).call(this,2,ut(this,Ue).audio.sampleRate,ut(this,Ue).audio.numberOfChannels);mt(this,We,{id:ut(this,Ue).video?2:1,info:{type:"audio",codec:ut(this,Ue).audio.codec,numberOfChannels:ut(this,Ue).audio.numberOfChannels,sampleRate:ut(this,Ue).audio.sampleRate},timescale:ut(this,Ue).audio.sampleRate,codecPrivate:e,samples:[],writtenChunks:[],currentChunk:null,firstTimestamp:void 0,lastTimestamp:-1,timeToSampleTable:[],lastTimescaleUnits:null,compactlyCodedChunkTable:[]})}},Qe=new WeakSet,Ke=function(e,t,i){let a=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350].indexOf(t),s=i,l="";l+=e.toString(2).padStart(5,"0"),l+=a.toString(2).padStart(4,"0"),15===a&&(l+=t.toString(2).padStart(24,"0")),l+=s.toString(2).padStart(4,"0");let n=8*Math.ceil(l.length/8);l=l.padEnd(n,"0");let r=new Uint8Array(l.length/8);for(let o=0;o<l.length;o+=8)r[o/8]=parseInt(l.slice(o,o+8),2);return r},$e=new WeakSet,qe=function(e,t,i,a,s,l){var n;let r=a/1e6,o=s/1e6;if(void 0===e.firstTimestamp&&(e.firstTimestamp=r),r=pt(this,et,tt).call(this,r,e),(!e.currentChunk||r-e.currentChunk.startTimestamp>=.5)&&(e.currentChunk&&pt(this,it,at).call(this,e),e.currentChunk={startTimestamp:r,sampleData:[],sampleCount:0}),e.currentChunk.sampleData.push(t),e.currentChunk.sampleCount++,(null==(n=null==l?void 0:l.decoderConfig)?void 0:n.description)&&(e.codecPrivate=new Uint8Array(l.decoderConfig.description)),e.samples.push({timestamp:r,duration:o,size:t.byteLength,type:i}),null!==e.lastTimescaleUnits){let t=Ba(r,e.timescale,!1),i=Math.round(t-e.lastTimescaleUnits);e.lastTimescaleUnits+=i;let a=Va(e.timeToSampleTable);1===a.sampleCount?(a.sampleDelta=i,a.sampleCount++):a.sampleDelta===i?a.sampleCount++:(a.sampleCount--,e.timeToSampleTable.push({sampleCount:2,sampleDelta:i}))}else e.lastTimescaleUnits=0,e.timeToSampleTable.push({sampleCount:1,sampleDelta:Ba(o,e.timescale)})},et=new WeakSet,tt=function(e,t){if("strict"===ut(this,Ue).firstTimestampBehavior&&-1===t.lastTimestamp&&0!==e)throw new Error(`The first chunk for your media track must have a timestamp of 0 (received ${e}). Non-zero first timestamps are often caused by directly piping frames or audio data from a MediaStreamTrack into the encoder. Their timestamps are typically relative to the age of the document, which is probably what you want.\n\nIf you want to offset all timestamps of a track such that the first one is zero, set firstTimestampBehavior: 'offset' in the options.\n`);if("offset"===ut(this,Ue).firstTimestampBehavior&&(e-=t.firstTimestamp),e<t.lastTimestamp)throw new Error(`Timestamps must be monotonically increasing (went from ${1e6*t.lastTimestamp} to ${1e6*e}).`);return e},it=new WeakSet,at=function(e){if(e.currentChunk){e.currentChunk.offset=ut(this,Oe).pos;for(let t of e.currentChunk.sampleData)ut(this,Oe).write(t);e.currentChunk.sampleData=null,0!==e.compactlyCodedChunkTable.length&&Va(e.compactlyCodedChunkTable).samplesPerChunk===e.currentChunk.sampleCount||e.compactlyCodedChunkTable.push({firstChunk:e.writtenChunks.length+1,samplesPerChunk:e.currentChunk.sampleCount}),e.writtenChunks.push(e.currentChunk),pt(this,st,lt).call(this)}},st=new WeakSet,lt=function(){ut(this,Oe)instanceof Ts&&ut(this,Oe).flush()},nt=new WeakSet,rt=function(){if(ut(this,Ge))throw new Error("Cannot add new video or audio chunks after the file has been finalized.")};class Ss extends Yi{constructor(){super(...arguments),dt(this,"videoEncoder"),dt(this,"audioEncoder"),dt(this,"_muxer"),dt(this,"startTime",null),dt(this,"lastKeyFrame",null),dt(this,"recordRate",1),dt(this,"firstTimestamp",null),dt(this,"encodeCount",0),dt(this,"audioBuffers",[])}isTypeSupported(){return null!=typeof VideoEncoder&&null!=VideoEncoder}getWebMMuxer(e,t,i,a){return null==this._muxer&&(this._muxer=new Is({target:new ps,video:{codec:"avc",width:e.width,height:e.height},audio:{codec:"aac",sampleRate:i,numberOfChannels:a},firstTimestampBehavior:"offset"})),this._muxer}async start(){if(null==this.canvas)return;if(1==this.isRecording)return;let e=ua.getAudioContext().sampleRate,t=this.getWebMMuxer(this.canvas,30,e,2);t.resetFileStream(),t.setVideoSize(this.canvas.width,this.canvas.height),this.recordRate=Mi.playbackRate,this.encodeCount=0;RTCRtpSender.getCapabilities("video").codecs,RTCRtpReceiver.getCapabilities("video").codecs;this.recordRate;const i={codec:"avc1.640028",hardwareAcceleration:"no-preference",width:this.canvas.width,height:this.canvas.height,bitrate:5e6,framerate:30};let a=await VideoEncoder.isConfigSupported(i);if(null==i||null==a)return void this.stop();this.firstTimestamp=null,this.videoEncoder=new VideoEncoder({output:(e,i)=>{if(this.encodeCount-=1,1==this.isRecording){null===this.firstTimestamp&&(this.firstTimestamp=e.timestamp);let a=e.timestamp-this.firstTimestamp;t.addVideoChunk(e,i,a)}},error:e=>this.onVideoEncoderError(e)}),this.videoEncoder.configure(i),this.audioEncoder=new AudioEncoder({output:(e,i)=>{if(1==this.isRecording){null===this.firstTimestamp&&(this.firstTimestamp=e.timestamp);let a=e.timestamp-this.firstTimestamp;t.addAudioChunk(e,i,a)}},error:e=>this.onAudioEncoderError(e)});let s={codec:"mp4a.40.2",sampleRate:e,numberOfChannels:2,bitrate:128e3};await AudioEncoder.isConfigSupported(s);this.audioEncoder.configure(s),this.addEncodeAudio(0),this.state=ji.recording,Bi.send(ki.RecorderStateChange,this.state),null!=this.onStartCallback&&this.onStartCallback()}getEncodeQueueSize(){return 1==this.isRecording&&null!=this.videoEncoder?this.videoEncoder.encodeQueueSize:-1}getEnableAudioSound(){return!1}async beforeReadying(){super.beforeReadying();let e=await ua.executeTrackAudio(),t=ua.getAudioContext();this.audioBuffers=[];let i=ca.splitAudioBuffer(t,e,30);if(null==i)return;let a=0;for(let s=0;s<i.length;s++){const e=i[s];let t=e.length/e.sampleRate;Vi.formatMillisTime(1e3*t,!0,!0);this.audioBuffers.push({buffer:e,startTime:a,duration:t}),a+=t}}encodePlayTrackAudio(e){if(null!=e){const t=new Float32Array(e.length*e.numberOfChannels);for(let s=0;s<e.numberOfChannels;s++)t.set(e.getChannelData(s),s*e.length);let i=new AudioData({format:"f32-planar",sampleRate:e.sampleRate,numberOfFrames:e.length,numberOfChannels:e.numberOfChannels,timestamp:Date.now(),data:t});this.audioEncoder.encode(i),i.close();let a=ua.getAudioContext();ca.playAudioBuffer(a,e,Mi.playbackRate)}}onVideoEncoderError(e){this.stop()}onAudioEncoderError(e){this.stop()}addEncodeAudio(e){for(let t=0;t<this.audioBuffers.length;t++){const i=this.audioBuffers[t];if(e>=i.startTime&&e<=i.startTime+i.duration){this.encodePlayTrackAudio(i.buffer);this.audioBuffers.splice(t--,1);break}}}onRenderFrameCanvas(e,t){if(null==this.canvas)return;if(1!=this.isRecording)return;if(this.state!=ji.recording)return;if("closed"==this.videoEncoder.state)return void this.stop();this.addEncodeAudio(e);let i=0;if(isNaN(e)){let e=document.timeline.currentTime;null==this.startTime&&(this.startTime=e),i=(e-this.startTime)*this.recordRate}else i=1e3*e;let a=Math.ceil(1e3*i),s=new VideoFrame(this.canvas,{timestamp:a});null==this.lastKeyFrame&&(this.lastKeyFrame=i);let l=i-this.lastKeyFrame>=1e4;l&&(this.lastKeyFrame=i),this.encodeCount+=1,this.videoEncoder.encode(s,{keyFrame:l}),s.close()}async onComplete(){if(null==this._muxer)return!1;this._muxer.finalize();let e=this._muxer.target.buffer;if(this._muxer.resetFileStream(),null==e||0==e.byteLength)return!1;{let t=new Blob([e],{type:"video/mp4"});this.videoURL=URL.createObjectURL(t);let i=new ra;return i.label="视频生成"+mi.randRangeInt(100,200),i.type=Qi.Video,i.thumbnail="./renderer/assets/images/media/type_recorder.jpg",i.path=this.videoURL,i.parseSource(),oa.addFile(i),!0}}getVideoDataURL(){return this.videoURL}async stop(){if(1!=this.isRecording)return;this.state=ji.stop,ca.stopAudioBuffer(),this.audioBuffers.length=0,this.videoEncoder&&(this.videoEncoder.encodeQueueSize>0&&await this.videoEncoder.flush(),"closed"!=this.videoEncoder.state&&this.videoEncoder.close(),this.videoEncoder=null),this.audioEncoder&&(this.audioEncoder.encodeQueueSize>0&&await this.audioEncoder.flush(),"closed"!=this.audioEncoder.state&&this.audioEncoder.close(),this.audioEncoder=null);let e=await this.onComplete();this.startTime=null,this.lastKeyFrame=null,Bi.send(ki.RecorderStateChange,this.state),1==e&&(this.state=ji.complete,Bi.send(ki.RecorderComplete,this.state))}clear(){this.canvas=null,this.videoURL=null,this.state=ji.initial,Bi.clearAll(this)}}class Rs{static initRecorder(){null==this.webmRecorder&&(this.webmRecorder=new Ra,this.webmRecorder.initRecorder()),null==this.mp4Recorder&&(this.mp4Recorder=new Ss,this.mp4Recorder.initRecorder()),null==this.mediaRecorder&&(this.mediaRecorder=new da,this.mediaRecorder.initRecorder()),null==this.ipcRecorder&&(this.ipcRecorder=new Xi,this.ipcRecorder.initRecorder()),this.fpsState=new Oi,this.recorder=this.mp4Recorder,Bi.on(ki.btnChangeRecorder,this,this.onBtnChangeRecorder)}static onBtnChangeRecorder(e){e?this.start():this.stop()}static onRenderFrameCanvas(e,t){null!=this.recorder&&this.lastCurrentTime!=e&&(this.lastCurrentTime=e,this.recorder.onRenderFrameCanvas(e,t))}static async beforeReadying(){if(null==this.recorder)return;await this.recorder.beforeReadying();Mi.playbackRate=1,Bi.send(ki.SetRenderFrameFPS,30,!0),Bi.send(ki.GotoTimeline,0,!1,!0),Hi.sendmainmessage(hi.TF_SetfullDesign,!0),Ci.mc.beforeRecordingResetClip()}static async start(){null!=this.recorder&&(this.recorderRunTime="",this.runTime=Ui.timer.getTime(),this.recorder.onStartCallback=this.onStartRecorder,this.recorder.start())}static onStartRecorder(){Bi.send(ki.GotoTimeline,0,!0,!0)}static pause(){null!=this.recorder&&this.recorder.pause()}static resume(){null!=this.recorder&&this.recorder.resume()}static stop(){null!=this.recorder&&(this.runTime>0&&(this.recorderRunTime=Vi.formatMillisTime(Ui.timer.getTime()-this.runTime,!0,!0)),this.recorder.stop(),this.recorder.afterClear(),Hi.sendmainmessage(hi.TF_SetfullDesign,!1),Ci.mc.beforeRecordingResetClip(),Mi.playbackRate=1,Bi.send(ki.SetRenderFrameFPS),Bi.send(ki.GotoTimeline,0,!1,!0))}static get isRecordering(){return null!=this.recorder&&this.recorder.isRecording}static attachMedia(e,t){null!=this.recorder&&this.recorder.attachMedia(e,t)}static clear(){Bi.clearAll(this)}static downloadVideo(e=""){if(null==this.recorder)return;let t=this.recorder.getVideoDataURL();if(null!=t&&"string"==typeof t){let a="a_down_load";var i=this.a_down_load;null==i&&null==(i=document.getElementById(a))&&((i=document.createElement("a")).id=a,this.a_down_load=i),null!=i&&(i.style.display="none",i.href=t,i.download=e,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(t))}}}dt(Rs,"preview",{ctx:null,canvas:null}),dt(Rs,"high",{ctx:null,canvas:null}),dt(Rs,"recorderProgress",0),dt(Rs,"fpsState"),dt(Rs,"recorder"),dt(Rs,"webmRecorder"),dt(Rs,"mp4Recorder"),dt(Rs,"mediaRecorder"),dt(Rs,"ipcRecorder"),dt(Rs,"runTime"),dt(Rs,"recorderRunTime",""),dt(Rs,"lastCurrentTime",-1),dt(Rs,"a_down_load",null);const Ls=class{static getPoolBySign(e){return Ls._poolDic[e]||(Ls._poolDic[e]=[])}static clearBySign(e){Ls._poolDic[e]&&(Ls._poolDic[e].length=0)}static getLength(e){if("string"!=typeof e&&(e=this.getClassSign(e)),null!=e){var t=Ls.getPoolBySign(e);if(null!=t&&t.length>0)return t.length}return 0}static getClassSign(e){var t=null;if(e){if(!e.__className){let t=e.prototype?e.prototype:Object.getPrototypeOf(e);t.constructor&&null!=t.constructor.name?e.__className=t.constructor.name:t&&t.hasOwnProperty("__class__")&&(e.__className=t.__class__)}(t=e.__className||e._$gid)||(e._$gid=t=Si.getGID()+"")}return t}static createByClass(e){if(null==e)return null;let t=Ls.getClassSign(e),i=Ls.getItemByClass(t,e);return i.__className=t,i}static recoverByClass(e){if(e){var t=e.__className||e.constructor._$gid;t&&Ls.recover(t,e)}}static getItemByClass(e,t){var i=Ls.getPoolBySign(e);if(i&&i.length>0){var a=i.pop();a[Ls.POOLSIGN]=!1}else{a=new t;let e=t.__maxCount__||0,i=(t.__newCount__||0)+1;t.__newCount__=i,e<=0&&(e=50)}return a}static setClsMaxCount(e,t){e&&(e.__maxCount__=t)}static recover(e,t){t[Ls.POOLSIGN]||(t[Ls.POOLSIGN]=!0,Ls.getPoolBySign(e).push(t))}static getItemByCreateFun(e,t,i=null){var a=Ls.getPoolBySign(e),s=a.length?a.pop():t.call(i);return s[Ls.POOLSIGN]=!1,s}static getItem(e){var t=Ls.getPoolBySign(e),i=t.length?t.pop():null;return i&&(i[Ls.POOLSIGN]=!1),i}};let Es=Ls;dt(Es,"POOLSIGN","__InPool"),dt(Es,"_poolDic",{});class Ps{constructor(){dt(this,"name","TMedia"),dt(this,"title",""),dt(this,"uuid",null),dt(this,"sourceNode"),dt(this,"audioBuffer"),dt(this,"audioSampleRate"),dt(this,"debug",!1),dt(this,"isPreSeekTime",!1),dt(this,"isRecover",!1),dt(this,"recoverTimeoutIndex1",null),dt(this,"recoverTimeoutIndex2",null)}setSource(e,t){}get duration(){return null}get currentTime(){return null}get isSeeking(){return!1}setCurrentTime(e,t){}setPlay(e){}setMute(e){}setVolume(e){}getMediaElement(){return null}getCurrentTimeRenderTarget(){return null}log(...e){this.debug}error(...e){this.debug}warn(...e){this.debug}recover(e){}recoverTimeoutCall(e,t,i,a){this.recoverTimeoutClear(),1==this.isPreSeekTime&&(this.isPreSeekTime=!1,t=-1,a=-1),null!=e&&(t>0?this.recoverTimeoutIndex1=setTimeout((()=>{1==this.isRecover&&e(!0)}),t):e(!1)),null!=i&&(a>0?this.recoverTimeoutIndex2=setTimeout((()=>{1==this.isRecover&&i(!0)}),a):i(!1))}recoverTimeoutClear(){null!=this.recoverTimeoutIndex1&&(clearTimeout(this.recoverTimeoutIndex1),this.recoverTimeoutIndex1=null),null!=this.recoverTimeoutIndex2&&(clearTimeout(this.recoverTimeoutIndex2),this.recoverTimeoutIndex2=null)}}class _s extends Ps{constructor(){super(),dt(this,"audio"),dt(this,"isListener",!1),dt(this,"_duration",0),dt(this,"endTime",0),dt(this,"isplaying",!1),dt(this,"calcSeekTime",0),dt(this,"tempPlaySeekTime",null),this.name="TAudio",this.uuid=yi.createUUID(this.name),document?this.audio=document.createElement("audio"):this.audio=new Audio,this.audio.controls=!1,this.audio.autoplay=!1,this.setEventListener(!0)}setEventListener(e){this.isListener!=e&&(this.isListener=e,1==e?(this.audio.addEventListener("timeupdate",this.timeupdate.bind(this)),this.audio.addEventListener("durationchange",this.durationchange.bind(this)),this.audio.addEventListener("play",this.onplay.bind(this)),this.audio.addEventListener("pause",this.onpause.bind(this)),this.audio.addEventListener("canplay",this.oncanplay.bind(this)),this.audio.addEventListener("ended",this.onended.bind(this))):(this.audio.removeEventListener("timeupdate",this.timeupdate.bind(this)),this.audio.removeEventListener("durationchange",this.durationchange.bind(this)),this.audio.removeEventListener("play",this.onplay.bind(this)),this.audio.removeEventListener("pause",this.onpause.bind(this)),this.audio.removeEventListener("canplay",this.oncanplay.bind(this)),this.audio.removeEventListener("ended",this.onended.bind(this))))}setSource(e,t){null==e&&(this._duration=0),this.audio.src!=e&&(this.audio.src=e,null!=e&&this.audio.load())}get duration(){return this._duration}get currentTime(){return this.audio.currentTime}timeupdate(e){Vi.formatMillisTime(1e3*this.audio.currentTime,!0,!0),Vi.formatMillisTime(1e3*this.endTime,!0,!0),this.audio.currentTime>this.endTime+10&&this.error("=========播放点已超出裁剪结尾点==========="),null!=this.tempPlaySeekTime&&(this.calcSeekTime=Ui.timer.getTime()-this.tempPlaySeekTime,this.log("触发播放计时 ","seek:"+this.calcSeekTime+"ms"),this.tempPlaySeekTime=null)}durationchange(e){this._duration=this.audio.duration}onplay(e){}onpause(e){}onended(e){this.log("播放结束")}oncanplay(e){this._duration=this.audio.duration,null!=this.tempPlaySeekTime&&(this.calcSeekTime=Ui.timer.getTime()-this.tempPlaySeekTime,this.tempPlaySeekTime=null),this.log("YYY音频长度=>>>：",this.audio.currentTime," / ",this.audio.duration+"秒","seek:"+this.calcSeekTime+"ms")}setCurrentTime(e,t){let i=Math.ceil(Math.abs(1e3*(e-this.audio.currentTime)));i>Math.max(100,this.calcSeekTime)?(this.error("A设置播放点：",this.audio.currentTime," set:"+e,"("+i+"ms)"),this.log("相差：",i+"ms"),this.audio.currentTime=e):this.log("B播放点相同：",this.audio.currentTime," set:"+e,"("+i+"ms)"),this.endTime=t,this.log(this.uuid)}setProcess(e){let t=Math.round(e*this.audio.duration);this.audio.currentTime=t}setPlay(e){if(this.isplaying!=e)if(this.isplaying=e,e){if(1==this.audio.paused){this.calcSeekTime=0,this.tempPlaySeekTime=Ui.timer.getTime(),this.audio.playbackRate=Mi.playbackRate;try{this.audio.play(),this.log("执行==播放")}catch(t){this.error("执行==播放出错"),this.error(t)}}}else 1!=this.audio.paused&&(this.audio.pause(),this.log("执行==暂停"))}setPlayRate(){this.audio.playbackRate=Mi.playbackRate}setMute(e){this.audio.muted!=e&&(this.audio.muted=e)}setVolume(e){e/=100,this.audio.volume!=e&&(this.audio.volume=e)}get isSeeking(){return this.audio.readyState<=2||this.audio.seeking}getMediaElement(){return this.audio}getCurrentTimeRenderTarget(){return null}recover(e){let t=this;0==t.isRecover&&(t.isRecover=!0,this.recoverTimeoutCall((()=>{t.setVolume(0)}),10,(i=>{1==i?(this.error("[POOL回收]","延迟停止播放 XXXXXXXXXXXXX！"),this.log(t.uuid)):(this.log("[POOL回收]","直接停止",e),this.log(t.uuid)),t.setPlay(!1)}),500),this.log("[POOL回收]",t.uuid,e),Es.recover(e,t))}static CreatInstance(e){let t=Es.getItemByClass(e,_s);return t.recoverTimeoutClear(),t.setVolume(100),t.isPreSeekTime=!1,t.isRecover=!1,t}}class Ds extends Ps{constructor(){super(),dt(this,"video"),dt(this,"isListener",!1),dt(this,"_duration",0),dt(this,"endTime",0),dt(this,"isplaying",!1),dt(this,"calcSeekTime",0),dt(this,"tempPlaySeekTime",null),dt(this,"currentTimeSeekTime",null),dt(this,"renderData",null),this.name="TVideo",this.uuid=yi.createUUID(this.name),this.video=document.createElement("video"),this.video.controls=!1,this.video.autoplay=!1,this.setEventListener(!0)}setEventListener(e){this.isListener!=e&&(this.isListener=e,1==e?(this.video.addEventListener("timeupdate",this.timeupdate.bind(this)),this.video.addEventListener("durationchange",this.durationchange.bind(this)),this.video.addEventListener("play",this.onplay.bind(this)),this.video.addEventListener("pause",this.onpause.bind(this)),this.video.addEventListener("canplay",this.oncanplay.bind(this)),this.video.addEventListener("ended",this.onended.bind(this))):(this.video.removeEventListener("timeupdate",this.timeupdate.bind(this)),this.video.removeEventListener("durationchange",this.durationchange.bind(this)),this.video.removeEventListener("play",this.onplay.bind(this)),this.video.removeEventListener("pause",this.onpause.bind(this)),this.video.removeEventListener("canplay",this.oncanplay.bind(this)),this.video.removeEventListener("ended",this.onended.bind(this))),this.log(this.info,"添加事件：",e))}setSource(e,t){null==e&&(this._duration=0),this.video.src!=e&&(this.video.src=e,null!=e&&this.video.load())}get duration(){return this._duration}get currentTime(){return this.video.currentTime}timeupdate(e){Vi.formatMillisTime(1e3*this.video.currentTime,!0,!0),Vi.formatMillisTime(1e3*this.endTime,!0,!0),this.video.currentTime>this.endTime+10&&this.error(this.info,"=========播放点已超出裁剪结尾点==========="),null!=this.tempPlaySeekTime&&(this.calcSeekTime=Ui.timer.getTime()-this.tempPlaySeekTime,this.log(this.info,"触发播放计时","seek:"+this.calcSeekTime+"ms"),this.tempPlaySeekTime=null)}durationchange(e){this._duration=this.video.duration}onplay(e){}onpause(e){}onended(e){this.log(this.info,"播放结束")}oncanplay(e){this._duration=this.video.duration,null!=this.tempPlaySeekTime&&(this.calcSeekTime=Ui.timer.getTime()-this.tempPlaySeekTime,this.tempPlaySeekTime=null),null!=this.currentTimeSeekTime&&(this.calcSeekTime=Ui.timer.getTime()-this.currentTimeSeekTime,this.currentTimeSeekTime=null),this.log(this.info,"YYY音频长度=>>>：",this.video.currentTime," / ",this.video.duration+"秒","seek:"+this.calcSeekTime+"ms")}setCurrentTime(e,t){let i=Math.ceil(Math.abs(1e3*(e-this.video.currentTime))),a=Math.max(100,this.calcSeekTime);if(0==e||i>a){this.isPreSeekTime?this.warn(this.info,"A设置播放点：",this.video.currentTime," set:"+e,"("+i+"ms)"):this.error(this.info,"A设置播放点：",this.video.currentTime," set:"+e,"("+i+"ms)"),this.log(this.info,"相差：",i+"ms"),this.currentTimeSeekTime=Ui.timer.getTime();let t=Math.round(1e3*(e+.001))/1e3;this.video.currentTime=t}else this.log(this.info,"B播放点相同：",this.video.currentTime," set:"+e,"("+i+"ms)");this.endTime=t,this.log(this.uuid)}get info(){return this.isPreSeekTime?"【预载】":""}setProcess(e){let t=Math.round(e*this.video.duration);this.video.currentTime=t}get frameIndex(){return Math.ceil(1e3*this.video.currentTime/(1e3/30))}setPlay(e){if(this.isplaying!=e)if(this.isplaying=e,e){if(1==this.video.paused){this.calcSeekTime=0,this.tempPlaySeekTime=Ui.timer.getTime(),this.video.playbackRate=Mi.playbackRate;try{this.video.play().catch((()=>{this.log(this.info,"执行==播放",this.frameIndex)})),this.log(this.info,"执行==播放",this.frameIndex)}catch(t){this.error(this.info,"执行==播放出错"),this.error(t)}}}else if(1!=this.video.paused)try{this.video.pause(),this.log(this.info,"执行==暂停",this.frameIndex)}catch(t){this.error(this.info,"执行==暂停出错"),this.error(t)}}setPlayRate(){this.video.playbackRate=Mi.playbackRate}setMute(e){this.video.muted!=e&&(this.video.muted=e)}setVolume(e){e/=100,this.video.volume!=e&&(this.video.volume=e)}get isSeeking(){return this.video.readyState<=2||this.video.seeking}getMediaElement(){return this.video}getCurrentTimeRenderTarget(){return null==this.renderData&&(this.renderData={target:this.video}),this.renderData}recover(e){let t=this;0==t.isRecover&&(t.isRecover=!0,this.recoverTimeoutCall((()=>{t.setVolume(0)}),60,(i=>{1==i?(this.error("[POOL回收]","延迟停止播放 XXXXXXXXXXXXX！"),this.log(t.uuid)):(this.log("[POOL回收]：","直接停止",e),this.log(t.uuid)),t.setPlay(!1)}),500),Es.recover(e,t))}static CreatInstance(e){let t=Es.getItemByClass(e,Ds);return t.recoverTimeoutClear(),t.setVolume(100),t.isPreSeekTime=!1,t.isRecover=!1,t}}class Fs{constructor(e){dt(this,"uuid"),dt(this,"name"),dt(this,"mediaId"),dt(this,"type"),dt(this,"watchVer",0),dt(this,"time",{start:0,end:0,startCut:0,endCut:0,overIn:0,overOut:0}),dt(this,"timepx",{left:0,width:0,height:0}),dt(this,"event",{selected:!1,cuthand:!0}),dt(this,"media",{volume:100,fadeIn:0,fadeOut:0}),dt(this,"text",{fontSize:50,color:"#00FF00"}),dt(this,"transform",{x:-1,y:-1,width:-1,height:-1,scaleX:1,scaleY:1,rotation:0}),this.uuid=yi.createUUID("clip"),this.name=e.name,this.time.start=e.start,this.time.end=e.end}changeWatchVer(){this.watchVer+=1,this.watchVer>=Number.MAX_VALUE-1&&(this.watchVer=0)}get totalTime(){return Math.round(this.time.end+this.time.endCut-(this.time.start-this.time.startCut))}}class Ns extends Fs{constructor(){super(...arguments),dt(this,"_media",null)}get isSupportPreSeekTime(){return this.type==pi.Video}enterMedia(){return null==this._media&&(this._media=this.getMediaByClipData()),null!=this._media&&this._media.setVolume(this.media.volume),this._media}get isSeeking(){return null!=this._media&&this._media.isSeeking}preSeekTime(){if(null==this._media)return;let e=this.time.startCut;e=(e+0)/1e3;let t=(this.time.end-this.time.start+this.time.startCut)/1e3;this._media.isPreSeekTime=!0,this._media.setPlay(!1),this._media.setCurrentTime(e,t)}getCutTimeFragmentStart(){let e=this.time.startCut;return e/=1e3,e}getCutTimeFragmentEnd(){return(this.time.end-this.time.start+this.time.startCut)/1e3}exitMedia(){null!=this._media&&(this._media.recover(this.mediaId),this._media=null)}getMediaByClipData(){let e=null;if(this.type==pi.Audio||this.type==pi.Video){let t=this.getMediaFile();if(null!=t&&null!=t.path&&(this.type==pi.Audio?(e=_s.CreatInstance(this.mediaId),e.audioBuffer=t.audioBuffer,e.audioSampleRate=t.audioSampleRate):this.type==pi.Video&&(e=Ds.CreatInstance(this.mediaId))),null!=e){let i=this.getCutTimeFragmentStart();e.title=t.label,e.setSource(t.path,i)}}return e}getMediaFile(){return oa.getFileByMediaId(this.mediaId)}get mediaFileName(){let e=oa.getFileByMediaId(this.mediaId);return e?e.label:"媒体丢失或被删除"}get hasMediaFile(){return null!=oa.getFileByMediaId(this.mediaId)}get mediaFilePath(){let e=oa.getFileByMediaId(this.mediaId);return e?e.path:""}get isOverEnable(){let e=oa.getFileByMediaId(this.mediaId);return!!e&&e.isOverEnable}get isCutLimit(){let e=oa.getFileByMediaId(this.mediaId);return!!e&&e.isCutLimit}setVolume(e){this.media.volume=e,null!=this._media&&this._media.setVolume(e)}}class Us extends Ns{constructor(){super(...arguments),dt(this,"scripts",[])}addScript(e){return-1==this.scripts.indexOf(e)&&this.scripts.push(e),1!=e.isEnter&&(e.isEnter=!0,e.onEnter(this)),e}getScript(e){for(let t=0;t<this.scripts.length;t++){const i=this.scripts[t];if(i.type==e)return i}return null}removeScript(e){let t=this.scripts.indexOf(e);return-1!=t&&(this.scripts.splice(t,1),!0)}removeAllScript(){for(let e=0;e<this.scripts.length;e++){const t=this.scripts[e];1==t.isEnter&&(t.isEnter=!1,t.onExit(this))}this.scripts.length=0}onEnterScript(){for(let e=0;e<this.scripts.length;e++){const t=this.scripts[e];1!=t.isEnter&&(t.isEnter=!0,t.onEnter(this))}}onUpdateScriptTimeline(e){for(let t=0;t<this.scripts.length;t++){const i=this.scripts[t];if(i.endTime-i.startTime<=0||e>i.endTime)1!=i.progress&&(i.progress=1,i.onProgress(i.progress));else if(e<i.startTime)0!=i.progress&&(i.progress=0,i.onProgress(i.progress));else{i.onUpdateTimeline(e);let t=i.endTime-i.startTime,a=1-(i.endTime-e)/t;a=Math.round(1e3*a)/1e3,i.progress!=a&&(i.progress=a,i.onProgress(i.progress))}}}onExitScript(){for(let e=0;e<this.scripts.length;e++){const t=this.scripts[e];1==t.isEnter&&(t.isEnter=!1,t.onExit(this))}}}class Os extends Us{constructor(){super(...arguments),dt(this,"layerIndex",-1),dt(this,"isPlayActivate",!1),dt(this,"enableAudioSound",!0),dt(this,"playMedia",null)}hasEnable(){return this.enableAudioSound=!0,1!=Rs.recorder.getEnableAudioSound()&&(Rs.recorder.state!=ji.ready&&Rs.recorder.state!=ji.recording||(this.enableAudioSound=!1)),1==this.enableAudioSound||this.type!=pi.Audio}activateData(){1==this.hasEnable()&&(this.playMedia=this.enterMedia(),null!=this.playMedia&&this.type==pi.Video&&1!=this.enableAudioSound&&this.setMute(!0),this.type!=pi.Video&&this.type!=pi.Audio||Rs.attachMedia(this.playMedia,this))}setPlay(e){1==this.hasEnable()&&null!=this.playMedia&&this.playMedia.setPlay(e)}setMute(e){1==this.hasEnable()&&null!=this.playMedia&&(this.type==pi.Video&&1!=this.enableAudioSound&&(e=!0),this.playMedia.setMute(e))}setCurrentTime(e){if(1!=this.hasEnable())return;if(null==this.playMedia)return;let t=e-this.time.start,i=this.time.startCut;i=(i+t)/1e3;let a=(this.time.end-this.time.start+this.time.startCut)/1e3;this.playMedia.setCurrentTime(i,a)}clone(){let e=new Os({start:this.time.start,end:this.time.end});return e.name=this.name,e.mediaId=this.mediaId,e.type=this.type,e.watchVer=0,e.event.selected=!1,e.event.cuthand=!0,e.time.startCut=this.time.startCut,e.time.endCut=this.time.endCut,e.timepx.left=this.timepx.left,e.timepx.width=this.timepx.width,e.timepx.height=this.timepx.height,e.isPlayActivate=!1,e}clear(){this.isPlayActivate=!1,null!=this._media&&this.exitMedia()}}class Vs{constructor(e){dt(this,"type"),dt(this,"uuid"),dt(this,"isMain",!1),dt(this,"isLock",!1),dt(this,"isHide",!1),dt(this,"isMute",!1),dt(this,"clips"),dt(this,"indexZ",-1),dt(this,"domdiv",null),dt(this,"oldClipsLen",-1),dt(this,"clipEnterTimelineHandler"),dt(this,"clipExitTimelineHandler"),dt(this,"enterClip",null),dt(this,"enterClipIndex",null),dt(this,"overOutClip",null),dt(this,"nextClip",null),this.uuid=yi.createUUID("track"),this.clips=[],this.type=e.type}unshiftClip(e){e.type=this.type,this.clips.unshift(e)}pushClip(e){e.type=this.type,this.clips.push(e)}removeClip(e,t){let i=this.clips[e];this.clips.splice(e,t),this.executeClipExitSet(i)}setClipEnterAndExitTimeline(e,t){this.clipEnterTimelineHandler=e,this.clipExitTimelineHandler=t}updateTimeline(e,t,i){e*=1e3;let a=0;null!=this.enterClip&&e>this.enterClip.time.start&&(a=this.enterClipIndex);let s=null,l=null,n=null,r=this.clips.length;for(let o=a;o<r;o++){const t=this.clips[o];if(null==n)if(e<t.time.start)n=t;else{let i=o+1;e>=t.time.start&&e<=t.time.end&&i<r-1&&(n=this.clips[i])}if(e>=t.time.start&&e<=t.time.end-t.time.overOut){s=t,l=o;let e=o+1;null==n&&e<r&&(n=this.clips[e]);break}}if(this.overOutClip!=s)if(null!=this.overOutClip)(e<this.overOutClip.time.start||e>this.overOutClip.time.end)&&(this.executeClipExitSet(this.overOutClip),this.overOutClip=null);else if(null!=this.enterClip&&null==this.overOutClip){let i=this.getClipDataByIndex(l-1);null!=i&&i.time.overOut>0&&e>=i.time.overOut&&e<i.time.end&&(this.overOutClip=i,this.executeClipEnterSet(this.overOutClip,e,t))}if(this.enterClip!=s&&(null!=this.enterClip&&this.enterClip!=this.overOutClip&&1==this.enterClip.isPlayActivate&&(this.enterClip.time.overOut>0&&e>=this.enterClip.time.overOut&&e<this.enterClip.time.end?this.overOutClip!=this.enterClip&&(this.executeClipExitSet(this.overOutClip),this.overOutClip=this.enterClip):this.executeClipExitSet(this.enterClip)),this.enterClip=s,this.enterClipIndex=l,null!=this.enterClip&&(this.overOutClip==this.enterClip&&(this.overOutClip=null),i!=this.enterClip.layerIndex&&(this.enterClip.isPlayActivate=!1),this.enterClip.layerIndex=i,this.executeClipEnterSet(this.enterClip,e,t))),this.enterClip!=n){if(this.nextClip!=n&&(null!=this.nextClip&&this.nextClip!=this.enterClip&&(this.nextClip.exitMedia(),this.nextClip=null),null!=n)){let e=n.isSupportPreSeekTime;0==e&&null==this.enterClip&&n.type==pi.Video&&(e=!0),1==e&&(this.nextClip=n,this.nextClip.enterMedia(),this.nextClip.preSeekTime())}}else this.nextClip=null;return null!=this.enterClip&&this.enterClip.onUpdateScriptTimeline(e),this.enterClip}exitActivateClip(){null!=this.enterClip&&this.executeClipExitSet(this.enterClip)}executeClipExitSet(e){null!=e&&0!=e.isPlayActivate&&(null!=this.clipExitTimelineHandler&&this.clipExitTimelineHandler(this,e),e.isPlayActivate=!1,e.onExitScript(),e.exitMedia(),this.enterClip==e&&(this.enterClip=null,this.enterClipIndex=null),this.overOutClip==e&&(this.overOutClip=null),this.enterClip==this.nextClip&&(this.nextClip=null))}executeClipEnterSet(e,t,i){if(null==e)return;let a=this.isMute;this.overOutClip==e&&(a=!0),1!=e.isPlayActivate?(e.isPlayActivate=!0,e.onEnterScript(),e.activateData(),e.setCurrentTime(t),e.setMute(a),e.setPlay(i),null!=this.clipEnterTimelineHandler&&this.clipEnterTimelineHandler(this,e)):e.setMute(a)}resetClip(){this.executeClipExitSet(this.overOutClip),this.executeClipExitSet(this.enterClip),null!=this.nextClip&&(this.nextClip.exitMedia(),this.nextClip=null)}getActivateClip(){return this.enterClip}setTimeline(e){null!=this.enterClip&&this.enterClip.setCurrentTime(1e3*e),null!=this.overOutClip&&this.overOutClip.setCurrentTime(1e3*e)}setPlay(e){null!=this.enterClip&&this.enterClip.setPlay(e),null!=this.overOutClip&&this.overOutClip.setPlay(e)}setMute(e){this.isMute=e,null!=this.enterClip&&this.enterClip.setMute(e),null!=this.overOutClip&&this.overOutClip.setMute(e)}getClipDataByIndex(e){if(null==this.clips)return null;if(e>=0&&e<this.clips.length){return this.clips[e]}return null}clear(){for(let e=0;e<this.clips.length;e++){this.clips[e].clear()}this.clips.length=0,this.executeClipExitSet(this.overOutClip),this.executeClipExitSet(this.enterClip),this.enterClip=null,this.enterClipIndex=0,this.nextClip=null,this.clipEnterTimelineHandler=null,this.clipExitTimelineHandler=null}}class Bs{static GetTrackSize(e){let t=24;switch(e){case pi.Video:t=62;break;case pi.Audio:t=50;break;case pi.Text:t=24}return t}static GetTrackName(e){return(e+"").toString()}static GetTrackColor(e){let t="#9c4937";switch(e){case pi.Video:t="#004d52";break;case pi.Audio:t="#0e3058";break;case pi.Text:t="#9c4937"}return t}static convertToTrackType(e){let t=null;switch(e){case Qi.Video:t=pi.Video;break;case Qi.Audio:t=pi.Audio;break;case Qi.Image:t=pi.Image;break;case Qi.Krc:case Qi.Jrc:t=pi.Karaoke}return null==t&&this.isLRCType(e)&&(t=pi.Text),t}static isLRCType(e){switch(e){case Qi.Lrc:case Qi.Krc:case Qi.Vtt:case Qi.Jrc:return!0}return!1}}var Ws=(e=>(e.auto="auto",e.default="default",e.hand="hand",e.wait="wait",e.text="text",e.verticalText="vertical-text",e.noDrop="no-drop",e.notAllowed="not-allowed",e.help="help",e.allScroll="all-scroll",e.move="move",e.crosshair="crosshair",e))(Ws||{});class zs{static getTempClip(){return null==this.tempClip&&(this.tempClip=new Os({name:"darg-temp-clip"})),this.tempClip}static setBodyCursor(e){if(this.cursorOld==e)return;this.cursorOld=e;let t=this.getBody();null!=t&&(t.style.cursor=e)}static setBodyCursorDefault(){this.setBodyCursor(Ws.default)}static getBody(){return null==this._body&&(this._body=document.body,null==this._body&&(this._body=document.querySelector("body"))),this._body}static async toImageURL(e){null!=this.tempdrawcanvas&&(this.deleteCanvas(this.tempdrawcanvas),this.tempdrawcanvas=null);return null}static deleteCanvas(e){e.width=e.height=0,e.getContext("2d").fillRect(0,0,0,0)}static getCanvas(e){var t=document.getElementById(e);return null==t&&((t=document.createElement("canvas")).id=e),t}static browserDownload(e,t=""){if(null!=e&&"string"==typeof e){let a="alink";var i=this.alink;null==i&&null==(i=document.getElementById(a))&&((i=document.createElement("a")).id=a,this.alink=i),null!=i&&(i.style.display="none",i.href=e,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(e))}}}dt(zs,"_body",null),dt(zs,"tempdrawcanvas",null),dt(zs,"cursorOld","default"),dt(zs,"tempClip",null),dt(zs,"alink",null);class Gs{}dt(Gs,"URL_audiomask",`url(${new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACoAAAAqCAYAAADFw8lbAAAACXBIWXMAAAsTAAALEwEAmpwYAAAGlmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgOS4wLWMwMDAgNzkuMTcxYzI3ZiwgMjAyMi8wOC8xNi0xODowMjo0MyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIyLjAgKFdpbmRvd3MpIiB4bXA6Q3JlYXRlRGF0ZT0iMjAyMy0wMS0yNlQxNzo0NDoxMyswODowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAyMy0wMi0wOFQyMDoxODozOCswODowMCIgeG1wOk1vZGlmeURhdGU9IjIwMjMtMDItMDhUMjA6MTg6MzgrMDg6MDAiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6YzA5NzUwM2MtMDMyNC0zNzQ0LWEwY2ItNzI0NGY5ZmI1ZmE0IiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6MzRjZmE0YzMtOWFjOC0yMzQ4LTkxZDMtZGVlMzE1NDFlZTUwIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6ZTNjZDQzNDAtMWY5Ni1jZTQyLTg5NjgtZTNiZjE5YzgyMTI0IiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNyZWF0ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6ZTNjZDQzNDAtMWY5Ni1jZTQyLTg5NjgtZTNiZjE5YzgyMTI0IiBzdEV2dDp3aGVuPSIyMDIzLTAxLTI2VDE3OjQ0OjEzKzA4OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjIuMCAoV2luZG93cykiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmFkYWI3MzgwLTU3NjktMTI0ZC1hMDc0LWFhNzYxNWVhMzU3NSIgc3RFdnQ6d2hlbj0iMjAyMy0wMS0yNlQxNzo0NDoxMyswODowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIyLjAgKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDpjMDk3NTAzYy0wMzI0LTM3NDQtYTBjYi03MjQ0ZjlmYjVmYTQiIHN0RXZ0OndoZW49IjIwMjMtMDItMDhUMjA6MTg6MzgrMDg6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCAyNC4wIChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4CiIKbAAAAVElEQVRYhe3OMREAIADDwIIBvOAG/0KKiQxwl1+yZrTN2qdJRpJnO/MJR2mO0hylOUpzlOYozVGaozRHaY7SHKU5SnOU5ijNUZqjNEdpjtIcpTlKuz17GOpvFysiAAAAAElFTkSuQmCC",self.location).href})`),dt(Gs,"URL_blur",`url(${new URL(""+new URL("../jpg/blur-865ab216.jpg",import.meta.url).href,self.location).href})`),dt(Gs,"URL_lockmask",`url(${new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACoAAAAqCAIAAABKoV4MAAAACXBIWXMAAAsTAAALEwEAmpwYAAAGvmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNi4wLWMwMDIgNzkuMTY0NDg4LCAyMDIwLzA3LzEwLTIyOjA2OjUzICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgMjIuMCAoV2luZG93cykiIHhtcDpDcmVhdGVEYXRlPSIyMDIzLTAxLTI2VDE3OjQ0OjEzKzA4OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIzLTAxLTI3VDEzOjU0OjA4KzA4OjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMy0wMS0yN1QxMzo1NDowOCswODowMCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDplZWM4NWFjMS04MDI4LTBhNDYtYTNkNi0yMTY4MDQzY2Q0MGIiIHhtcE1NOkRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDphZmUwZWZjZS04YzAyLTBmNGQtYTRjMC0xYjEwNzRiNGRjZDQiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDplM2NkNDM0MC0xZjk2LWNlNDItODk2OC1lM2JmMTljODIxMjQiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmUzY2Q0MzQwLTFmOTYtY2U0Mi04OTY4LWUzYmYxOWM4MjEyNCIgc3RFdnQ6d2hlbj0iMjAyMy0wMS0yNlQxNzo0NDoxMyswODowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIyLjAgKFdpbmRvd3MpIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDphZGFiNzM4MC01NzY5LTEyNGQtYTA3NC1hYTc2MTVlYTM1NzUiIHN0RXZ0OndoZW49IjIwMjMtMDEtMjZUMTc6NDQ6MTMrMDg6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCAyMi4wIChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6ZWVjODVhYzEtODAyOC0wYTQ2LWEzZDYtMjE2ODA0M2NkNDBiIiBzdEV2dDp3aGVuPSIyMDIzLTAxLTI3VDEzOjU0OjA4KzA4OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjIuMCAoV2luZG93cykiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+T/jqYwAAAIRJREFUWIXt0rENgDAMRFFFLl0EmhshI5ARMgdsm0G8QVKbAgkhWiTTXPsby/ZL+37MOXvv7p5SqrWqaliRUoqqAjAzdzczAGFFxpiR815Fcs7BGz+LLMsaf/O7SGvtl69fRbat/uUOAOVTPuVTPuVTPuVTPuVTPuVTPuVTPuVTPuV/KCdZkDyX9y383AAAAABJRU5ErkJggg==",self.location).href})`),dt(Gs,"URL_gridsmall",`url(${new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFyWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgOS4wLWMwMDAgNzkuMTcxYzI3ZiwgMjAyMi8wOC8xNi0xODowMjo0MyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKFdpbmRvd3MpIiB4bXA6Q3JlYXRlRGF0ZT0iMjAyMy0wMi0xM1QxNDozMjowNiswODowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAyMy0wMi0xM1QxNDozMjowNiswODowMCIgeG1wOk1vZGlmeURhdGU9IjIwMjMtMDItMTNUMTQ6MzI6MDYrMDg6MDAiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6M2M2ZDU0YzYtY2MyNy0zMzRkLTllYjYtNjE5ZjYyZmNmYzQ1IiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6ZjUwMmM5NzctMTdmOC02MDQ5LTlhZWYtOWIyYzEzZDgwZmQ4IiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6YzNhODBmNmEtMWIwYS02NDQwLThiMGItMGQwMmNlZmU3ZTZiIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNyZWF0ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6YzNhODBmNmEtMWIwYS02NDQwLThiMGItMGQwMmNlZmU3ZTZiIiBzdEV2dDp3aGVuPSIyMDIzLTAyLTEzVDE0OjMyOjA2KzA4OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjQuMCAoV2luZG93cykiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjNjNmQ1NGM2LWNjMjctMzM0ZC05ZWI2LTYxOWY2MmZjZmM0NSIgc3RFdnQ6d2hlbj0iMjAyMy0wMi0xM1QxNDozMjowNiswODowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDwvcmRmOlNlcT4gPC94bXBNTTpIaXN0b3J5PiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PtPPAP0AAAA4SURBVDiNY5SUlGQgF7AwMDBwcnLikv7+/TseWSayrR3VPJQ0szAwMHz//h2PCjyyoylsVDNBAAArEwx5Yz0g3gAAAABJRU5ErkJggg==",self.location).href})`),dt(Gs,"URL_alpha",`url(${new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFjGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgOS4wLWMwMDAgNzkuMTcxYzI3ZiwgMjAyMi8wOC8xNi0xODowMjo0MyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKFdpbmRvd3MpIiB4bXA6Q3JlYXRlRGF0ZT0iMjAyMy0wMi0yNlQwMjozNToxNSswODowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAyMy0wMi0yNlQwMjozNToxNSswODowMCIgeG1wOk1vZGlmeURhdGU9IjIwMjMtMDItMjZUMDI6MzU6MTUrMDg6MDAiIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOmVjMWExY2NjLWQ1MzAtMDU0Ni1iYThkLWI2ZDgwYWEzNWEzOSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDplYzFhMWNjYy1kNTMwLTA1NDYtYmE4ZC1iNmQ4MGFhMzVhMzkiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDplYzFhMWNjYy1kNTMwLTA1NDYtYmE4ZC1iNmQ4MGFhMzVhMzkiPiA8cGhvdG9zaG9wOkRvY3VtZW50QW5jZXN0b3JzPiA8cmRmOkJhZz4gPHJkZjpsaT5hZG9iZTpkb2NpZDpwaG90b3Nob3A6MzRjZmE0YzMtOWFjOC0yMzQ4LTkxZDMtZGVlMzE1NDFlZTUwPC9yZGY6bGk+IDwvcmRmOkJhZz4gPC9waG90b3Nob3A6RG9jdW1lbnRBbmNlc3RvcnM+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNyZWF0ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6ZWMxYTFjY2MtZDUzMC0wNTQ2LWJhOGQtYjZkODBhYTM1YTM5IiBzdEV2dDp3aGVuPSIyMDIzLTAyLTI2VDAyOjM1OjE1KzA4OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjQuMCAoV2luZG93cykiLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+g/nXdAAAAU1JREFUSImVVsERxCAIBCcNJf23kFiS92COMICw4eVdVlhZEHmtRZnNOXWtGGY+z7PF210jRaeumXnHZreLiA4ExMzyjyxaEyoC3gaIfmvvArMnlnUV4BP9lAQzNxpYaC2AfI2JhQKA2qZWBXCk6kNYYa0dc073Qbxc15U6ep7H+tLFrj+G0ozpKwysV5IUKVpiIKlQvJ5jG8C5Q/RUQkgFHxTOi3esIGtwUkXInYMX7qC/wrjI9vJoIw3kmM6+get5EFtk1x9xHoj1V4XNXsE97ac+gGavzbXqYfFrreYu0j1IGNuwWgVVANfhhF0hTjZIAzBLdgsawHJBqtOxqTRQRExUzdo1Ft/3rQTt4K7ngXXazAPnXX/umKafmus6nVC14XU1kCGzM6S6XpHBC9LmvfVOREd8jiEPLOcdnWhaRfgbtMW8T0fQOy6v2A/AKj03zGbCHQAAAABJRU5ErkJggg==",self.location).href})`),dt(Gs,"URL_zimu1",new URL(""+new URL("../jpg/zimu1-d4cf32d4.jpg",import.meta.url).href,self.location).href),dt(Gs,"URL_zimu2",new URL(""+new URL("../jpg/zimu2-34405547.jpg",import.meta.url).href,self.location).href),dt(Gs,"URL_zimu3",new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAnCAYAAAB9qAq4AAAACXBIWXMAAAsSAAALEgHS3X78AAACPUlEQVRYhe1Yy3HCMBBdM9xDB1ACBWgEVBAuOsepIHSQpIOkAuCsC6kgyc4WAB1AB+nAmWVWjPlYlrECzgzvwtj6PXb1nldKsiwDa20GfoyMMV8lfYJhrR0CwGdZf2NM0oq16F+hfcj4EotKNgrXyme08RG8EayLG8G6cCoeNYzXjs/WqJuMdgg3a+3LGf9hZoxZuwciSpVSs6qTBBEEgOeqEwMAm/E69zwlojEAMNGf0ElCCb5W57dHzuGe3xPRm1IqKCsX24NEdLjQRqLpLUKuYTOPQq7LFQ1H09c5KIJSHvmwNMZ495WLoFIqIaIOAHCKn6R5rpRKT40L3YNltdtIRBEEEcmEiJYsHgAYElFPKXW0b0MJfpe0B6syD7YdIuKxX0XKvrhIOMVVxv2vijoGEJEF0Jep1lrrU34Yl2DBoerbGLNTNyL2+PMGAIN8J0Tc+l2rdV6yokQQEfui4jt5tRLhDJzf8V5PkupHntoikZSuhRwTG7u0Shsb8QM/cxSvIZJUyHEqh/k9p7X+0Vpz+wc/nxOMGATH8vvChAr6TOCKBB0K1VpHyTEJdooaZC+ehRgEl/I78fRxbauqk8cg6MqlASIelfSImOYqcm9p5cBHDHfMcLdb20okb7xVICSmMmQjhs0Y5ox7LooOIZgJn8QZ9cA/xA+t9QwRXYS6J84w71pr3xYoRLRvsZBciO305DXbzqKOiqMWC+KDlY+WPtzuZupiL8Uld9XR7qnFQoIuAxofwWZfHgHAL3jr30xgz99IAAAAAElFTkSuQmCC",self.location).href);const Zs=["data"],Hs=[(e=>(Rt("data-v-427e62a1"),e=e(),Lt(),e))((()=>Et("div",{class:"clip-text"},"这里是拖动的块哦",-1)))],js=gi(wt({__name:"DragComTrackClip",props:{data:{}},setup(e,{expose:t}){const i=e;bt((e=>({"73a698eb":a.clipWidth,"3144eabc":a.clipHeight,a54040ac:a.backgroundColor,e92398a4:a.backgroundImageMask,a4994cbc:a.backgroundImage,"2589c116":a.backgroundPositionX,"2589c117":a.backgroundPositionY,"57daea4c":a.backgroundSize})));const a=Tt({clipWidth:"0px",clipHeight:"0px",backgroundColor:"#9c4937",backgroundImage:"none",backgroundImageMask:"none",backgroundSize:"100% 100%",backgroundPositionX:"0px",backgroundPositionY:"0px"}),s={captureImage:"none"};function l(){if(null==i.data)return;let e=i.data.clip;if(e instanceof Os==0)return;let t=e.time.end-e.time.start;if(e.timepx.left=Ji.convertTimeToPixel(e.time.start/1e3),e.timepx.width=Ji.convertTimeToPixel(t/1e3),e.timepx.height=Bs.GetTrackSize(e.type),a.clipWidth=e.timepx.width+"px",a.clipHeight=e.timepx.height+"px",a.backgroundColor=Bs.GetTrackColor(e.type),e.type==pi.Audio)a.backgroundImageMask=Gs.URL_audiomask,a.backgroundSize="100% 100%",a.backgroundPositionY="0px";else if(e.type==pi.Video){let t=e.totalTime,i=Ji.convertTimeToPixel(t/1e3),s=i*(e.time.startCut/t);a.backgroundPositionX="-"+Math.round(s)+"px",a.backgroundImageMask="none",a.backgroundSize=Math.round(i)+"px 45px",a.backgroundPositionY=(e.timepx.height-45)/2+"px"}else a.backgroundSize="100% 100%",a.backgroundPositionY="0px"}kt((()=>{l()})),Ct((()=>{})),Mt((()=>i.data),((e,t)=>{l()}));let n=xt((()=>{let e="none";if(null!=i.data){let t=i.data.clip.getMediaFile();null!=t&&(e=t.captureImage,null==e&&(e=t.thumbnail))}return s.captureImage!=e&&(s.captureImage=e,a.backgroundImage=`url(${s.captureImage})`),""}));return t({updateData:l}),(e,t)=>(St(),At("div",{class:"clip-container bindClipWidth",data:It(n)},Hs,8,Zs))}}),[["__scopeId","data-v-427e62a1"]]);var Ys=(e=>(e.TOP="TOP",e.DEFAULT="DEFAULT",e.BOTTOM="BOTTOM",e))(Ys||{});const Xs=class{static dragclear(){Xs.dragProxy.setComData(null,null)}static dragstart(e,t,i,a){let s=t.sourceTarget;Xs.dragProxy.startImage(s),i instanceof Os?Xs.dragProxy.setComData(Xs.comDragTrackClip,{clip:i}):Xs.dragProxy.setComData(null,null);let l=s.parentElement;l&&l.getAttribute("divname")==fi.TrackLine&&this.onHoverTrackLine(e,l),this.selectClip=i,this.selectTrack=a,this.dragDistX=0,this.changeRenderCanvas=!0,this.hoverData.trackData=null,this.hoverData.insertType=null,this.hoverData.trackDiv=null}static dragmove(e,t){let i=e.target,a=i.getAttribute("divname"),s=i.getBoundingClientRect();switch(e.pageX,s.left,e.pageY,s.top,this.dragNotAllowed=null==a?0:-1,a){case fi.TrackBG:null!=this.selectClip&&this.hoverFindNearTrack(this.selectClip);break;case fi.TrackLine:this.onHoverTrackLine(e,i);break;case fi.TrackClip:i!=t.sourceTarget&&(this.dragNotAllowed=1);let a=i.parentElement;a&&a.getAttribute("divname")==fi.TrackLine&&this.onHoverTrackLine(e,a)}null!=this.hoverData.trackData?(this.dragCheackHoverTrack(this.selectClip),Xs.hoverInsertType=this.hoverData.insertType,Xs.setHoverTrack(this.hoverData.trackDiv,"#282829",this.hoverData.trackData)):(Xs.hoverInsertType="DEFAULT",Xs.setHoverTrack()),this.dragDistX=t.distX,this.changeRenderCanvas=!0;let l=-1!=this.dragNotAllowed;1==l&&"TOP"==this.hoverData.insertType&&null!=this.selectClip&&this.selectClip.type==pi.Audio&&null!=this.hoverData.trackData&&this.hoverData.trackData.type!=pi.Audio&&(this.hoverData.trackData=null,this.hoverData.trackDiv=null),Xs.updateRenderHoverTrack(),Xs.dragProxy.moveImage(t.distX,t.distY,l)}static dragCheackHoverTrack(e){let t=qs.mainTrack,i=this.hoverData.trackData,a=this.hoverData.insertType;(this.selectTrack&&this.selectTrack.type!=i.type||this.selectClip&&this.selectClip.type!=i.type)&&(this.dragNotAllowed=3),1==this.dragNotAllowed&&("TOP"!=a&&"BOTTOM"!=a||(this.dragNotAllowed=-1)),3==this.dragNotAllowed&&(i.isMain&&e.type==pi.Audio?(this.hoverData.insertType="BOTTOM",this.dragNotAllowed=-1):i.type==pi.Audio?(this.dragNotAllowed=4,this.hoverData.insertType="BOTTOM",this.hoverData.trackData=t,this.hoverData.trackDiv=t.domdiv):"BOTTOM"!=this.hoverData.insertType&&"TOP"!=this.hoverData.insertType||(this.dragNotAllowed=-1)),"BOTTOM"!=a||i.type!=pi.Audio&&1!=i.isMain||e.type!=pi.Audio&&(this.dragNotAllowed=4,this.hoverData.insertType="BOTTOM",this.hoverData.trackData=t,this.hoverData.trackDiv=t.domdiv)}static hoverFindNearTrack(e){if(null!=this.hoverData.trackData)return;let t=qs.datas;if(null!=t&&null!=e){for(let i=0;i<t.length;i++){const a=t[i];if(e.type==a.type){this.hoverData.trackData=a,this.hoverData.trackDiv=a.domdiv;break}}if(null==this.hoverData.trackData){let e=qs.mainTrack;this.hoverData.trackData=e,this.hoverData.trackDiv=e.domdiv}}}static onHoverTrackLine(e,t){let i=Number(t.getAttribute("trackIndex")),a=qs.getTrackDataByIndex(i);if(a){let i=t.getBoundingClientRect();e.pageX,i.left;let s=e.pageY-i.top,l="DEFAULT",n=Bs.GetTrackSize(a.type)*(1/6);s<n?l="TOP":s>i.height-n&&(l="BOTTOM"),this.hoverData.trackData=a,this.hoverData.insertType=l,this.hoverData.trackDiv=t}}static dragend(e,t){let i=t.sourceTarget;t.downArgs,Xs.dragProxy.endImage(i);let a=e.target.getAttribute("divname");this.hoverData.trackData=null,this.hoverData.insertType=null,this.hoverData.trackDiv=null;let s=this.selectClip;null!=s&&(s.event.cuthand=!0);let l=Xs.hoverTrackData;-1==this.dragNotAllowed&&(null==l&&a==fi.TrackBG&&this.selectClip.type==pi.Audio&&qs.insertNewTrackAndClip(this.selectClip,t),null!=l&&qs.insertTrackLineClip(Xs.hoverTrackData,Xs.hoverInsertType,t,this.selectClip,this.selectTrack)),Xs.setHoverTrack(null,null),Xs.updateRenderHoverTrack(),Ci.selectClipData(null),this.selectClip=null,this.selectTrack=null}static setCanvas(e){this.canvas=e,this.ctx=this.canvas.getContext("2d")}static getCanvas(){return this.canvas}static setHoverTrack(e,t,i){null!=this.hoverTrackLineDiv&&(this.hoverTrackLineDiv.style.backgroundColor="",this.hoverTrackLineDiv=null),this.hoverTrackData=i,this.hoverTrackLineDiv=e,null!=this.hoverTrackLineDiv&&(this.hoverTrackLineDiv.style.backgroundColor=t)}static updateRenderHoverTrack(){this.changeRenderCanvas=!0}static toTrackPos(e){let t=Ji.toTargetLocal(e,this.canvas),i=0,a=0;return Xs.divTrackScroll&&(i=Xs.divTrackScroll.scrollLeft,a=Xs.divTrackScroll.scrollTop),t.left+=i,t.top+=a,t}static drawClipRect(e,t,i){this.changeRenderCanvas=!0,this.drawRect=t,this.drawTrack=e,this.drawLine=i}static addDrawFunc(e,t){for(let i=0;i<this.drawFunclist.length;i++){if(this.drawFunclist[i].handler==t)return}this.drawFunclist.push({eventid:e,handler:t})}static removeDrawFunc(e,t=null){for(let i=0;i<this.drawFunclist.length;i++){const a=this.drawFunclist[i];(null==t&&a.eventid==e||a.handler==t&&a.eventid==e)&&this.drawFunclist.splice(i--,1)}}static drawCanvasTrack(e,t){let i=this.drawTrack,a=null;if(null!=i&&(a=i.domdiv),null!=a){let i=Ji.toTargetLocal(a,this.canvas);i.left=i.left-t,this.drawRect.x=this.drawRect.x-t,e.lineWidth=2,e.strokeStyle="#00ff00",this.drawLine?(e.moveTo(this.drawRect.x,0),e.lineTo(this.drawRect.x,this.canvas.height)):e.rect(this.drawRect.x,this.drawRect.y,this.drawRect.width,this.drawRect.height),e.stroke()}if(null!=this.hoverTrackLineDiv){let i=this.canvas.getBoundingClientRect(),a=this.hoverTrackLineDiv.getBoundingClientRect(),s=a.left-i.left,l=a.top-i.top;if(s-=t,-1!=this.dragNotAllowed?e.strokeStyle="#ff0000":e.strokeStyle="#39878b",e.lineWidth=3,e.beginPath(),this.dragNotAllowed<0?("TOP"==this.hoverInsertType?(e.moveTo(s,l-4),e.lineTo(a.width,l-4)):"BOTTOM"==this.hoverInsertType&&(e.moveTo(s,l+a.height),e.lineTo(a.width,l+a.height)),e.stroke()):4==this.dragNotAllowed&&("TOP"==this.hoverInsertType?(e.moveTo(s,l-4),e.lineTo(a.width,l-4)):"BOTTOM"==this.hoverInsertType&&(e.moveTo(s,l+a.height),e.lineTo(a.width,l+a.height),e.globalAlpha=.1,e.fillRect(s,l+a.height,a.width,i.height-(l+a.height)),e.globalAlpha=1),e.stroke()),this.dragNotAllowed<0&&null!=this.selectClip){let i=this.selectClip.timepx.left+this.dragDistX-t,s=l,n=this.selectClip.timepx.width;-1!=this.dragNotAllowed?e.strokeStyle="#ff0000":e.strokeStyle="#39878b","DEFAULT"==this.hoverInsertType&&(e.lineWidth=3,e.beginPath(),e.strokeRect(i,s,n,a.height),e.stroke()),e.lineWidth=1,e.beginPath(),e.moveTo(i,0),e.lineTo(i,this.canvas.height),e.moveTo(i+n,0),e.lineTo(i+n,this.canvas.height),e.stroke()}}}static clearCanvas(){null!=this.ctx&&null!=this.canvas&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}static async loadFont(){}static drawTest(){const e=this.ctx;null!=this.ctx&&(e.clearRect(0,0,this.canvas.width,this.canvas.height),e.font="80px 极影毁片圆",e.strokeStyle="#FFFFFF",e.fillStyle="#0000FF",e.lineWidth=5,e.strokeText("你好中国  幽静",100,100),e.fillText("你好中国  幽静",100,100),e.stroke())}static updateRenderCanvas(){const e=this.ctx;if(null==this.ctx)return;if(0==this.changeRenderCanvas)return;this.changeRenderCanvas=!1,e.clearRect(0,0,this.canvas.width,this.canvas.height);let t=this.canvas.parentElement;if(t){let e=t.getBoundingClientRect();this.canvas.width=e.width,this.canvas.height=e.height}let i=0;Xs.divTrackScroll&&(i=Xs.divTrackScroll.scrollLeft),e.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawCanvasTrack(e,i);for(let a=0;a<this.drawFunclist.length;a++){this.drawFunclist[a].handler(e,this.canvas)}}static clearAll(){}};let Js=Xs;dt(Js,"dragTarget",null),dt(Js,"divTrackScroll",null),dt(Js,"comDragTrackClip",Pt(js)),dt(Js,"dragNotAllowed",-1),dt(Js,"dragProxy",{}),dt(Js,"selectClip",null),dt(Js,"selectTrack",null),dt(Js,"dragDistX",0),dt(Js,"hoverData",{trackData:null,insertType:null,trackDiv:null}),dt(Js,"canvas",null),dt(Js,"ctx",null),dt(Js,"changeRenderCanvas",!0),dt(Js,"hoverInsertType",null),dt(Js,"hoverTrackData",null),dt(Js,"hoverTrackLineDiv",null),dt(Js,"drawRect",null),dt(Js,"drawTrack",null),dt(Js,"drawLine",null),dt(Js,"drawFunclist",[]);class Qs{}dt(Qs,"isRef",_t),dt(Qs,"isReactive",Dt),dt(Qs,"isReadonly",Ft),dt(Qs,"isProxy",Nt);var Ks=(e=>(e.Ass="ass",e.Krc="krc",e.Jrc="jrc",e.Lrc="lrc",e.Vtt="vtt",e))(Ks||{});const $s=class{static initDatas(){let e=new Vs({type:pi.Video});return e.isMain=!0,this.addTrack(e),this.mainTrack=this.datas[this.datas.length-1],this.datas}static addTrack(e){e.type==pi.Audio?this.datas.push(e):this.datas.unshift(e)}static getTrackDataByIndex(e){return this.datas[e]}static getClipDataByIndex(e,t){let i=e.clips;if(null==i)return null;if(t>=0&&t<i.length){return i[t]}return null}static getKaraoke(e){let t="",i=null,a=null;for(let s=0;s<this.datas.length;s++){const e=this.datas[s];if(e.type==pi.Karaoke){a=e;break}}if(null!=a&&a.clips.length>0)for(let s=0;s<a.clips.length;s++){const l=a.clips[s],n=l.getMediaFile();if(null==i&&null!=n.fileBaseName&&(i=n.fileBaseName),null!=n&&null!=n.lrcParse&&n.lrcParse.list.length>0){let i=l.time.start-l.time.startCut,a="";switch(e){case Ks.Ass:a=n.lrcParse.encodeKaraokeAss(i);break;case Ks.Jrc:a=n.lrcParse.encodeKaraokeJrc(i)}null!=a&&(t+=a)}}return null==t||""==t?null:{content:t,filename:i,format:e}}static removeAllClipByLRC(){let e=0;for(let t=0;t<this.datas.length;t++){const i=this.datas[t];if(i.type==pi.Text){let a=i.clips;for(let t=0;t<a.length;t++){let i=a[t].getMediaFile();i&&Bs.isLRCType(i.type)&&(a.splice(t--,1),e++)}0==a.length&&this.datas.splice(t--,1)}}if(e>0){let e=Ci.mc;e.durationChange=!0,e.makeTrackTimeUpdate(),e.makeTimeupdateChange()}}static async addClipFromMediaFile(e){let t=Bs.convertToTrackType(e.type);if(null==t)return;let i=Bs.isLRCType(e.type);if(1==i){if(0==e.lrcParse.list.length)return;1==e.lrcParse.isKaraoke&&(t=pi.Karaoke)}let a=null;if(t==pi.Video&&0==this.mainTrack.clips.length&&(a=this.mainTrack),null==a)if(a=new Vs({type:t}),a.type==pi.Audio)this.datas.push(a);else{let e=-1;for(let i=0;i<this.datas.length;i++){if(this.datas[i].type==t){e=i;break}}-1==e?this.datas.unshift(a):this.datas.splice(e,0,a)}if(1==i)if(t==pi.Karaoke){let t=e.lrcParse.list,i=t[t.length-1].lineEnd,s=this.cheackClipProxy(new Os({start:0,end:i}));s.mediaId=e.mediaId,a.pushClip(s)}else{let t=e.lrcParse.list;for(let i=0;i<t.length;i++){let s=t[i],l=null,n=s.lineStart,r=0;if(null==s.lineEnd||isNaN(s.lineEnd)||s.lineEnd<s.lineStart?i<t.length-1?(l=t[i+1],r=l.lineStart):r=n+1e4:r=s.lineEnd,null!=s.lyric&&""!=s.lyric&&n<r){let t=this.cheackClipProxy(new Os({start:n,end:r}));t.text.content=s.lyric,t.mediaId=e.mediaId,a.pushClip(t)}}}else{let t=this.cheackClipProxy(new Os({start:0,end:1e3*e.duration}));t.mediaId=e.mediaId,a.pushClip(t),e.captureUpdate()}if(a.clips.length>0){let e=Ci.mc;e.durationChange=!0,e.makeTrackTimeUpdate(),e.makeTimeupdateChange(),await gt();for(let t=0;t<a.clips.length;t++){a.clips[t].changeWatchVer()}}}static async selectClipSplit(e){let t=Ci.getSelectClipData();if(1!=t.length)return;let i=t[0],a=i.clip,s=i.track,l=Math.round(1e3*e);if(l<a.time.start)return;if(l>a.time.end)return;let n=l-a.time.start+a.time.startCut,r=a.time.end-l+a.time.endCut;if(n<500||r<500)return;let o=a.time.start,d=a.time.end,c=Tt(a.clone());c.name="split_"+mi.randRangeInt(1e3,2e3),c.time.start=l,c.time.end=a.time.end,c.time.startCut=n;let u=a;u.time.start=a.time.start,u.time.end=l,u.time.endCut=r,c.time.overOut=u.time.overOut,u.time.overOut=0,s.clips.splice(i.index+1,0,c),await gt(),u.changeWatchVer(),c.changeWatchVer();let h=s.clips.indexOf(c),m={tracks:$s.datas,editTrack:s,selectClip:u,oldStart:o,oldEnd:d,newStart:u.time.start,newEnd:u.time.end,splitClip:c,splitClipIndex:h};ol.SaveExecuteAction(vi.Undo_SplitClip,m)}static cheackClipProxy(e){let t=zs.getTempClip();if(e==t){if(1!=Qs.isProxy(e)){e.uuid;(e=Tt(t.clone())).name="copy_"+mi.randRangeInt(1e3,2e3)}}else 1!=Qs.isProxy(e)&&((e=Tt(e)).name="add_"+mi.randRangeInt(1e3,2e3));return e}static async insertNewTrackAndClip(e,t){if(null==e)return;let i=$s.datas,a=e.timepx.left+t.distX,s=!1,l=null;if(e.type==pi.Audio?(e=this.cheackClipProxy(e),l=new Vs({type:e.type}),l.pushClip(e),this.addTrack(l),s=!0):e.type==pi.Video&&(l=i[0],0==l.clips.length&&(e=this.cheackClipProxy(e),l.pushClip(e),a=0,s=!0)),1==s){let t=e.time.end-e.time.start,i=1e3*Ji.convertPixelToTime(a),s=i+t;e.time.start=i,e.time.end=s,await gt(),e.changeWatchVer();let n={tracks:$s.datas,editTrack:l,selectClip:e};ol.SaveExecuteAction(vi.Undo_AddClipToNewTrack,n)}}static async insertTrackLineClip(e,t,i,a,s){if(null==a)return;let l=-1,n=-1;if(null!=s){if(l=s.clips.indexOf(a),-1==l)return;n=$s.datas.indexOf(s)}if(null==e)return;let r=$s.datas.indexOf(e),o=null,d=a.timepx.left+i.distX,c=a.time.end-a.time.start,u=1e3*Ji.convertPixelToTime(d),h=u+c,m=!0,p=a.time.start,g=a.time.end;u<0&&(u=0,h+=-u);let f=r;t==Ys.TOP?f=r-1:t==Ys.BOTTOM&&(f=r+1);let v=null,y=null,T=null;if(f<0)o=new Vs({type:a.type}),this.datas.unshift(o),a=this.cheackClipProxy(a),o.pushClip(a),null==s?v={tracks:$s.datas,editTrack:o,selectClip:a}:T={selectClip:a,oldTrack:s,oldIndex:l,oldStart:p,oldEnd:g,newTrack:o,newIndex:-1,newStart:-1,newEnd:-1};else if(f>=this.datas.length){let e=this.getTrackDataByIndex(this.datas.length-1);if(e.type==pi.Video&&1==e.isMain&&a.type!=pi.Audio)return;o=new Vs({type:a.type}),this.datas.push(o),a=this.cheackClipProxy(a),o.pushClip(a),null==s?v={tracks:$s.datas,editTrack:o,selectClip:a}:T={selectClip:a,oldTrack:s,oldIndex:l,oldStart:p,oldEnd:g,newTrack:o,newIndex:-1,newStart:-1,newEnd:-1}}else if(t==Ys.TOP)o=new Vs({type:a.type}),this.datas.splice(r,0,o),a=this.cheackClipProxy(a),o.pushClip(a),null==s?v={tracks:$s.datas,editTrack:o,selectClip:a}:T={selectClip:a,oldTrack:s,oldIndex:l,oldStart:p,oldEnd:g,newTrack:o,newIndex:-1,newStart:-1,newEnd:-1};else if(t==Ys.BOTTOM)o=new Vs({type:a.type}),this.datas.splice(r+1,0,o),a=this.cheackClipProxy(a),o.pushClip(a),null==s?v={tracks:$s.datas,editTrack:o,selectClip:a}:T={selectClip:a,oldTrack:s,oldIndex:l,oldStart:p,oldEnd:g,newTrack:o,newIndex:-1,newStart:-1,newEnd:-1};else{if(null==e)return;if(1!=this.hasInsertClipToTrack(e,a,u,h))return;let t=-1,i=0,n=e.clips;for(let l=0;l<n.length;l++){const r=n[l];let o=r.time.start,d=r.time.end;if(e==s&&r==a)i++;else{if(h<o){t=l-i;break}u>d&&(t=l+1-i)}}if(-1==t&&(0==n.length&&(t=0),1==n.length&&n[0]==a&&(t=0)),-1==t)return;e==s?(m=!1,l!=t&&(e.clips.splice(l,1),e.clips.splice(t,0,a),o=e,y={editTrack:o,selectClip:a,oldIndex:l,oldStart:p,oldEnd:g,newIndex:t,newStart:-1,newEnd:-1})):(m=!0,a=this.cheackClipProxy(a),e.clips.splice(t,0,a),o=e,null==s?v={tracks:$s.datas,editTrack:o,selectClip:a}:T={selectClip:a,oldTrack:s,oldIndex:l,oldStart:p,oldEnd:g,newTrack:o,newIndex:t,newStart:-1,newEnd:-1})}1==m&&null!=s&&(-1!=l&&s.clips.splice(l,1),this.cheackTrackZero(s));let w=[];w.push(a);let b=Ci.mc,k=!1;if(a.time.start=u,a.time.end=h,1==this.isMainTrackMagnet){let e=null;if(o&&o.isMain?e=o:s&&s.isMain&&(e=s),null!=e)if(l<=-1||isNaN(l)||null==s)this.mainTrackAlignment(e,a);else{let t=e.clips.indexOf(a);if(-1==t){if(l<e.clips.length){let t=e.clips[l];this.mainTrackAlignment(e,t)}this.removeOverInOut(s,a,l)}else if(-1!=s.clips.indexOf(a)){let t=e.clips[l];this.mainTrackAlignment(e,t)}else{let i=e.clips[t];this.mainTrackAlignment(e,i)}}}0==k&&(k=this.cheackDurationChange(o,a)),1==k&&(b.durationChange=!0,b.makeTimeupdateChange()),b.makeTrackTimeUpdate(),await gt();for(let C=0;C<w.length;C++){w[C].changeWatchVer()}null!=y&&(y.newStart=a.time.start,y.newEnd=a.time.end,ol.SaveExecuteAction(vi.Undo_SwitchClip,y),y=null),null!=T&&(s&&s.exitActivateClip(),T.tracks=$s.datas,T.newStart=a.time.start,T.newEnd=a.time.end,T.newIndex=T.newTrack.clips.indexOf(a),T.oldTrackIndex=n,T.newTrackIndex=$s.datas.indexOf(T.newTrack),ol.SaveExecuteAction(vi.Undo_SwitchTrack,T),T=null),null!=v&&(ol.SaveExecuteAction(vi.Undo_AddClipToNewTrack,v),v=null)}static hasInsertClipToTrack(e,t,i,a){(isNaN(i)||null==i)&&(i=t.time.start),(isNaN(a)||null==a)&&(a=t.time.end);let s=e.clips;for(let l=0;l<s.length;l++){const e=s[l];let n=e.time.start,r=e.time.end;if(e!=t&&(i>n&&i<r||a>n&&a<r))return!1}return!0}static async setMainTrackMagnet(e){if(this.isMainTrackMagnet!=e&&(this.isMainTrackMagnet=e,1==this.isMainTrackMagnet)){let e=0,t=null,i=[],a=[];for(let s=0;s<this.mainTrack.clips.length;s++){const l=this.mainTrack.clips[s];if(e=null==t?-l.time.start:t.time.end-l.time.start,0!=e){let t=l.time.start,s=l.time.end;l.time.start+=e,l.time.end+=e,i.push(l),a.push({clip:l,oldStart:t,oldEnd:s,newStart:l.time.start,newEnd:l.time.end})}t=l}if(i.length>0){let e=Ci.mc;e.durationChange=!0,e.makeTimeupdateChange()}await gt();for(let s=0;s<i.length;s++){i[s].changeWatchVer()}a.length>0&&ol.SaveExecuteAction(vi.Undo_MoveClipList,a)}}static mainTrackAlignment(e,t){if(1!=this.isMainTrackMagnet||null==e||null==t)return 0;if(1!=e.isMain)return 0;let i=e.clips,a=i.indexOf(t);if(-1==a)return 0;let s=0;for(let l=a;l<i.length;l++){const e=i[l];if(0==l)s=-e.time.start;else{let t=i[l-1];(t.time.overOut<=0||e.time.overIn<=0)&&(t.time.overOut=e.time.overIn=0),s=t.time.end-t.time.overOut-e.time.start}s<0&&(e.time.start+=s,e.time.end+=s,e.changeWatchVer())}return s}static removeOverInOut(e,t,i){let a=this.getClipDataByIndex(e,i-1);a&&(a.time.overOut=0);let s=this.getClipDataByIndex(e,i+1);s&&(s.time.overIn=0),t&&(t.time.overIn=0,t.time.overOut=0)}static cheackTrackZero(e){if(0==e.isMain&&0==e.clips.length){let t=this.datas.indexOf(e);-1!=t&&(this.datas.splice(t,1),e.clear())}}static async deleteSelectClip(){let e=Ci.getSelectClipData();if(0==e.length)return;let t=Ci.mc,i=!1,a=[],s=[];for(let n=0;n<e.length;n++){const t=e[n];let l=t.clip,r=t.track,o=r.clips;for(let e=0;e<o.length;e++){const t=o[e];if(t==l){if(1==this.isMainTrackMagnet&&r.isMain){let t=0,a=this.getClipDataByIndex(r,e-1);a&&(t=a.time.end);let l=this.getClipDataByIndex(r,e+1);if(l){let a=t-l.time.start;if(a<0)for(let t=e;t<o.length;t++){const e=o[t];e.time.start+=a,e.time.end+=a,s.push(e),i=!0}}}e==o.length-1&&(i=!0);let n=this.datas.indexOf(r);a.push({track:r,trackIndex:n,clip:t,clipIndex:e}),this.removeOverInOut(r,l,e),r.removeClip(e--,1),t.clear()}}this.cheackTrackZero(r)}1==i&&(t.durationChange=!0,t.makeTimeupdateChange()),await gt();for(let n=0;n<s.length;n++){s[n].changeWatchVer()}let l={tracks:$s.datas,removelist:[...a]};ol.SaveExecuteAction(vi.Undo_RemoveClipToTrack,l)}static cheackDurationChange(e,t){if(null==e||null==t)return!1;if(0==e.clips.length)return!1;let i=Ci.mc;return e.clips[e.clips.length-1]==t&&(i.durationChange=!0,i.makeTimeupdateChange(),!0)}static getNearClipLeft(e,t){let i=Number.MAX_VALUE,a=null;for(let s=0;s<this.datas.length;s++){const l=this.datas[s];if(l!=e&&(l.type==pi.Video||l.type==pi.Audio))for(let e=l.clips.length-1;e>=0;e--){const s=l.clips[e];if(s!=t){if(s.time.end<=t.time.start){let e=Math.abs(s.time.end-t.time.start);i>e&&(i=e,a=s);break}if(s.time.start<=t.time.start){let e=Math.abs(s.time.start-t.time.start);i>e&&(i=e,a=s);break}}}}return a}static getNearClipRight(e,t){let i=Number.MAX_VALUE,a=null;for(let s=0;s<this.datas.length;s++){const l=this.datas[s];if(l!=e&&(l.type==pi.Video||l.type==pi.Audio))for(let e=0;e<l.clips.length;e++){const s=l.clips[e];if(s!=t){if(s.time.start>=t.time.end){let e=Math.abs(s.time.start-t.time.end);i>e&&(i=e,a=s);break}if(s.time.end>=t.time.end){let e=Math.abs(s.time.end-t.time.end);i>e&&(i=e,a=s);break}}}}return a}static logClips(e){let t="";for(let i=0;i<e.length;i++){t+=e[i].name+" --\x3e "}return t}static sendLogger(e){Bi.send(ki.Logger,e)}};let qs=$s;dt(qs,"datas",Tt([])),dt(qs,"mainTrack",null),dt(qs,"isMainTrackMagnet",!0),dt(qs,"isAutoTrackMagnet",!0),dt(qs,"isAutoOverInOut",!0);class el extends Ti{constructor(){super(),this.name="主轨磁吸"}get doname(){return 1==this.data.newVal?this.name+"：开":this.name+"：关"}async onExecute(){let e=this.data;qs.isMainTrackMagnet=e.newVal,e.uidata.isMainTrackMagnet=e.newVal}async onUnExecute(){let e=this.data;qs.isMainTrackMagnet=e.oldVal,e.uidata.isMainTrackMagnet=e.oldVal}Clear(){this.data=null}}class tl extends Ti{constructor(){super(),this.name="移动剪辑"}isDifferentData(e){let t=e;return(t.newStart!=t.oldStart||t.newEnd!=t.oldEnd)&&(t.newStart!=this.data.newStart||t.newEnd!=this.data.newEnd)}async onExecute(){let e=this.data;e.selectClip.time.start=e.newStart,e.selectClip.time.end=e.newEnd,await this.nextTick(),e.selectClip.changeWatchVer()}async onUnExecute(){let e=this.data;e.selectClip.time.start=e.oldStart,e.selectClip.time.end=e.oldEnd,await this.nextTick(),e.selectClip.changeWatchVer()}Clear(){this.data=null}}class il extends Ti{constructor(){super(),this.name="移动多个剪辑"}async onExecute(){let e=this.data;for(let t=0;t<e.length;t++){const i=e[t];i.clip.time.start=i.newStart,i.clip.time.end=i.newEnd}await this.nextTick();for(let t=0;t<e.length;t++){e[t].clip.changeWatchVer()}}async onUnExecute(){let e=this.data;for(let t=0;t<e.length;t++){const i=e[t];i.clip.time.start=i.oldStart,i.clip.time.end=i.oldEnd}await this.nextTick();for(let t=0;t<e.length;t++){e[t].clip.changeWatchVer()}}Clear(){this.data=null}}class al extends Ti{constructor(){super(),this.name="删除剪辑"}async onExecute(){let e=this.data,t=e.tracks,i=e.removelist;for(let a=0;a<i.length;a++){const e=i[a];e.track.clips.indexOf(e.clip)==e.clipIndex&&(e.track.clips.splice(e.clipIndex,1),0==e.track.isMain&&0==e.track.clips.length&&t.indexOf(e.track)==e.trackIndex&&t.splice(e.trackIndex,1))}await this.nextTick();for(let a=0;a<i.length;a++){i[a].clip.changeWatchVer()}}async onUnExecute(){let e=this.data,t=e.tracks,i=e.removelist;for(let a=0;a<i.length;a++){const e=i[a];-1==t.indexOf(e.track)&&t.splice(e.trackIndex,0,e.track),-1==e.track.clips.indexOf(e.clip)&&e.track.clips.splice(e.clipIndex,0,e.clip)}await this.nextTick();for(let a=0;a<i.length;a++){i[a].clip.changeWatchVer()}}Clear(){this.data=null}}class sl extends Ti{constructor(){super(),this.name="分割剪辑"}async onExecute(){let e=this.data;e.tracks,e.selectClip.time.start=e.newStart,e.selectClip.time.end=e.newEnd,-1==e.editTrack.clips.indexOf(e.splitClip)&&e.editTrack.clips.splice(e.splitClipIndex,0,e.splitClip),await this.nextTick(),e.selectClip.changeWatchVer(),e.splitClip.changeWatchVer()}async onUnExecute(){let e=this.data;e.tracks;let t=e.editTrack.clips.indexOf(e.splitClip);t==e.splitClipIndex&&e.editTrack.clips.splice(t,1),e.selectClip.time.start=e.oldStart,e.selectClip.time.end=e.oldEnd,await this.nextTick(),e.selectClip.changeWatchVer()}Clear(){this.data=null}}class ll extends Ti{constructor(){super(),this.name="位置变化"}async onExecute(){let e=this.data,t=e.editTrack.clips.indexOf(e.selectClip);-1!=t&&t==e.oldIndex&&(e.oldIndex!=e.newIndex&&(e.editTrack.clips.splice(e.oldIndex,1),e.editTrack.clips.splice(e.newIndex,0,e.selectClip)),e.selectClip.time.start=e.newStart,e.selectClip.time.end=e.newEnd,await this.nextTick(),e.selectClip.changeWatchVer())}async onUnExecute(){let e=this.data,t=e.editTrack.clips.indexOf(e.selectClip);-1!=t&&t==e.newIndex&&(e.oldIndex!=e.newIndex&&(e.editTrack.clips.splice(e.newIndex,1),e.editTrack.clips.splice(e.oldIndex,0,e.selectClip)),e.selectClip.time.start=e.oldStart,e.selectClip.time.end=e.oldEnd,await this.nextTick(),e.selectClip.changeWatchVer())}Clear(){this.data=null}}class nl extends Ti{constructor(){super(),this.name="切换轨道"}async onExecute(){let e=this.data,t=e.oldTrack.clips.indexOf(e.selectClip);if(-1!=t&&t==e.oldIndex){if(e.oldTrack.clips.splice(e.oldIndex,1),e.newTrack.clips.splice(e.newIndex,0,e.selectClip),1!=e.oldTrack.isMain&&0==e.oldTrack.clips.length){let t=e.tracks.indexOf(e.oldTrack);null!=t&&e.tracks.splice(t,1)}-1==e.tracks.indexOf(e.newTrack)&&-1!=e.newTrackIndex&&e.tracks.splice(e.newTrackIndex,0,e.newTrack),e.selectClip.time.start=e.newStart,e.selectClip.time.end=e.newEnd,await this.nextTick(),e.selectClip.changeWatchVer()}}async onUnExecute(){let e=this.data,t=e.newTrack.clips.indexOf(e.selectClip);if(-1!=t&&t==e.newIndex){if(e.newTrack.clips.splice(e.newIndex,1),e.oldTrack.clips.splice(e.oldIndex,0,e.selectClip),1!=e.newTrack.isMain&&0==e.newTrack.clips.length){let t=e.tracks.indexOf(e.newTrack);null!=t&&e.tracks.splice(t,1)}-1==e.tracks.indexOf(e.oldTrack)&&-1!=e.oldTrackIndex&&e.tracks.splice(e.oldTrackIndex,0,e.oldTrack),e.selectClip.time.start=e.oldStart,e.selectClip.time.end=e.oldEnd,await this.nextTick(),e.selectClip.changeWatchVer()}}Clear(){this.data=null}}class rl extends Ti{constructor(){super(),this.name="空"}async onExecute(){}async onUnExecute(){}Clear(){this.data=null}}class ol{static getNewUndoRedo(e){null==this.classbindlist&&(this.classbindlist={},this.addCommandBind(vi.Undo_Empty,rl),this.addCommandBind(vi.Undo_AddClipToNewTrack,wi),this.addCommandBind(vi.Undo_RemoveClipToTrack,al),this.addCommandBind(vi.Undo_SplitClip,sl),this.addCommandBind(vi.Undo_MoveClip,tl),this.addCommandBind(vi.Undo_MoveClipList,il),this.addCommandBind(vi.Undo_CutClip,bi),this.addCommandBind(vi.Undo_SwitchClip,ll),this.addCommandBind(vi.Undo_SwitchTrack,nl),this.addCommandBind(vi.Undo_MainTrackMagnet,el),this.SaveExecuteAction(vi.Undo_Empty));let t=this.classbindlist[e];if(null!=t){let i=Tt(new t);return i.cmd=e,i}return null}static addCommandBind(e,t){this.classbindlist[e]=t}static async selectUndoRedo(e){if(this.selectUndo=e,1==e.isExecute){if(this.Undocommands[this.Undocommands.length-1]==e)return;for(;this.Undocommands.length>0;){let t=this.Undocommands[this.Undocommands.length-1];if(t==e)break;this.Undocommands.pop(),await t.UnExecute(),this.Redocommands.push(t)}}else for(;this.Redocommands.length>0;){let t=this.Redocommands.pop();if(await t.Execute(),this.Undocommands.push(t),t==e)break}}static async UnExecute(){if(this.Undocommands.length>0){let e=this.Undocommands.pop();await e.UnExecute(),this.Redocommands.push(e),this.selectUndo=e}}static async Execute(){if(this.Redocommands.length>0){let e=this.Redocommands.pop();await e.Execute(),this.Undocommands.push(e)}}static async SaveExecuteAction(e,t){if(this.allList.length>0){let i=this.allList[this.allList.length-1];if(i.cmd==e&&0==i.isDifferentData(t))return}if(null!=this.selectUndo){for(let e=0;e<this.allList.length;e++){1!=this.allList[e].isExecute&&this.allList.splice(e--,1)}this.Redocommands.length=0,this.selectUndo=null}if(this.Undocommands.length>50){this.Undocommands.shift(),this.allList.shift().Clear()}let i=this.getNewUndoRedo(e);null!=i&&(i.setExecuteData(t),this.allList.push(i),this.Undocommands.push(i))}}dt(ol,"Undocommands",[]),dt(ol,"Redocommands",[]),dt(ol,"classbindlist"),dt(ol,"allList",Tt([])),dt(ol,"selectUndo",null);const dl=["onMouseup"],cl={class:"title"},ul=gi(wt({__name:"UndoRedo",setup(e){let t=ol.allList,i=Ut();function a(e){return e.isExecute?"execute":"unexecute"}return Mt([()=>t.length],(e=>{let t=i.value;null!=t&&(t.scrollTop=t.scrollHeight)})),(e,s)=>(St(),At("div",{ref_key:"refContainer",ref:i,class:"div-undo-container"},[(St(!0),At(Ot,null,Vt(It(t),((e,t)=>(St(),At("div",{class:Bt(["div-undo-item",a(e)]),key:e.uuid,onMouseup:t=>function(e){ol.selectUndoRedo(e)}(e)},[Et("span",cl,"历史操作["+Wt(t)+"]：",1),zt(Wt(e.doname),1)],42,dl)))),128))],512))}}),[["__scopeId","data-v-b83d2b3b"]]),hl=e=>(Rt("data-v-2106e577"),e=e(),Lt(),e),ml={class:"divbody"},pl=hl((()=>Et("div",{class:"header"},"属性",-1))),gl=hl((()=>Et("div",{class:"line"},null,-1))),fl=gi(wt({__name:"Attributes",setup:e=>(e,t)=>(St(),At("div",ml,[pl,gl,Gt(ul)]))}),[["__scopeId","data-v-2106e577"]]),vl={class:"div-draggable-anime"},yl=gi(wt({__name:"DragFrame",setup(e){let t=Ut(),i=Ut(),a=Ut(),s=!1;kt((()=>{Js.dragProxy.setComData=d,Js.dragProxy.startImage=c,Js.dragProxy.moveImage=u,Js.dragProxy.endImage=h})),Ct((()=>{Js.dragProxy.startImage=null,Js.dragProxy.moveImage=null,Js.dragProxy.endImage=null}));let l=0,n=0,r=Tt({com:null,data:null}),o=Ut();async function d(e,t){if(r.com=e,r.data=t,null==e)return;let a=NaN,s=NaN,d=i.value;if(null!=d){if(await gt(),l=n=0,t&&t.clip instanceof Os){let e=t.clip;if(a=e.timepx.width,s=e.timepx.height,d.oh>s&&(n=s/2),0==e.time.start){let t=Js.toTrackPos(d),i=1e3*Ji.convertPixelToTime(t.left);e.time.start=i,e.time.end=i+e.time.end,o.value.updateData()}let i=e.getMediaFile();null!=i&&i.captureUpdate()}isNaN(a)||(d.style.width=a+4+"px"),isNaN(s)||(d.style.height=s+4+"px")}}function c(e){Js.dragTarget=e;let l=e.getBoundingClientRect(),n=l.left,r=l.top,o=l.width,d=l.height,c=i.value;c.ox=n,c.oy=r,c.ow=o,c.oh=d,c.style.left=n-2+"px",c.style.top=r-2+"px",c.style.width=o+4+"px",c.style.height=d+4+"px",c.style.display="block";let u=a.value,h=t.value;h.style.width="100%",h.style.height="100%",s=!0,zs.toImageURL(e).then((t=>{1==s&&(h.style.display="block",u.style.backgroundImage=`url(${t})`,e.style.opacity="0.1",zs.setBodyCursor(Ws.move))}))}function u(e,t,s){let r=a.value,o=i.value,d=o.ox,c=o.oy;o.style.left=d+e+l+"px",o.style.top=c+t+n+"px",null!=s&&(1==s?(r.style.opacity="0.7",o.style.backgroundColor="#FF0000",zs.setBodyCursor(Ws.notAllowed)):(r.style.opacity="1.0",o.style.backgroundColor="#FFFFFF",zs.setBodyCursor(Ws.move)))}function h(e){if(1==s){Js.dragTarget=null;let l=i.value;l.style.display="none",l.style.width="0px",l.style.height="0px",a.value.style.backgroundImage="none";let n=t.value;n.style.width="0px",n.style.height="0px",n.style.display="none",e.style.opacity="1.0",zs.toImageURL(null),zs.setBodyCursorDefault(),s=!1}}return(e,s)=>(St(),At("div",{ref_key:"refcontainer",ref:t,class:"div-container"},[Et("div",{ref_key:"refbox",ref:i,class:"div-draggable-box"},[Et("div",vl,[Et("div",{ref_key:"refcontent",ref:a,class:"div-draggable-content"},[null!=It(r).com?(St(),Zt(Ht(It(r).com),{key:0,ref_key:"refCurrentCom",ref:o,data:It(r).data},null,8,["data"])):jt("",!0)],512)])],512)],512))}}),[["__scopeId","data-v-54190c4a"]]);class Tl{static downArguments(e){e&&e.length>0?this.downArgs=e:this.downArgs=[]}static dragEventProxy(e,t,i){this.dragstartHandler=e,this.dragmoveHandler=t,this.dragendHandler=i}static downEventProxy(e,t,i,a,s){if(e&&2==e.button)return;if(null==e||"mousedown"!=e.type)return;e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault(),this.calller=t,this.moveHandler=a,this.upHandler=s,this.isMouseDrag=!1,null!=t&&"string"!=typeof t&&(i=i.bind(t),this.moveHandler=a.bind(t),this.upHandler=s.bind(t)),null!=this.timeoutIndex&&(clearTimeout(this.timeoutIndex),this.timeoutIndex=null);let l=!1;null!=i&&(l=1==i(e,{sourceTarget:e.target,offsetX:e.offsetX,offsetY:e.offsetY,downArgs:this.downArgs})),1!=l?(this.isMouseDown=!0,this.downTarget=e.target,this.downOffsetX=e.offsetX,this.downOffsetY=e.offsetY,this.downClientX=e.clientX,this.downClientY=e.clientY,this.draggable=!1,this.lastmovex=e.clientX,this.lastmovey=e.clientY,Bi.on(ki.mousemove,this,this.mousemoveHandler),Bi.on(ki.mouseup,this,this.onWindowMouseupHandler)):this.clear()}static mousemoveHandler(e){if(e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault(),1==this.isMouseDown){let t=e.offsetX,i=e.offsetY,a=e.clientX-this.downClientX,s=e.clientY-this.downClientY;t=this.downOffsetX+a,i=this.downOffsetY+s,null!=this.timeoutIndex&&(clearTimeout(this.timeoutIndex),this.timeoutIndex=null);let l=!1;if((Math.abs(a)>20||Math.abs(s)>5)&&(l=!0,this.isMouseDrag=!0),1==l&&null!=this.dragstartHandler){let t=this.dragstartHandler;if(this.dragstartHandler=null,Math.abs(s)>Math.abs(a/5))return this.draggable=!0,void t(e,{sourceTarget:this.downTarget,offsetX:this.downOffsetX,offsetY:this.downOffsetY,downArgs:this.downArgs})}let n={sourceTarget:this.downTarget,offsetX:t,offsetY:i,distX:a,distY:s};if(1==this.draggable)return void(null!=this.dragmoveHandler&&this.dragmoveHandler(e,n));null!=this.moveHandler&&this.moveHandler(e,n)}}static onWindowMouseupHandler(e){e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault();let t=this.upHandler,i=this.dragendHandler,a=this.downTarget,s=this.draggable,l=this.downArgs,n=e.offsetX,r=e.offsetY,o=e.clientX-this.downClientX,d=e.clientY-this.downClientY;n=this.downOffsetX+o,r=this.downOffsetY+d,this.clear();let c=!1;1==s&&null!=i&&(c=i(e,{sourceTarget:a,offsetX:n,offsetY:r,distX:o,distY:d,downArgs:l,dragComplete:s})),1!=c&&null!=t&&t(e,{sourceTarget:a,offsetX:n,offsetY:r,distX:o,distY:d,downArgs:l,dragComplete:s}),this.isMouseDrag=!1}static clear(){this.downTarget=null,this.downOffsetX=null,this.downOffsetY=null,this.downClientX=null,this.downClientY=null,this.downArgs=[],this.calller=null,this.moveHandler=null,this.upHandler=null,this.draggable=!1,this.dragstartHandler=null,this.dragmoveHandler=null,this.dragendHandler=null,null!=this.timeoutIndex&&(clearTimeout(this.timeoutIndex),this.timeoutIndex=null),1==this.isMouseDown&&(this.isMouseDown=!1,Bi.off(ki.mousemove,this,this.mousemoveHandler),Bi.off(ki.mouseup,this,this.onWindowMouseupHandler))}static stopEvent(e){return 1==this.draggable||(e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),e.preventDefault&&e.preventDefault(),!1)}}dt(Tl,"isMouseDown",!1),dt(Tl,"downTarget",null),dt(Tl,"downOffsetX",0),dt(Tl,"downOffsetY",0),dt(Tl,"downClientX",0),dt(Tl,"downClientY",0),dt(Tl,"lastmovex",0),dt(Tl,"lastmovey",0),dt(Tl,"downArgs",[]),dt(Tl,"isMouseDrag",!1),dt(Tl,"draggable",!1),dt(Tl,"timeoutIndex",null),dt(Tl,"cheackTime",60),dt(Tl,"calller",null),dt(Tl,"moveHandler",null),dt(Tl,"upHandler",null),dt(Tl,"dragstartHandler",null),dt(Tl,"dragmoveHandler",null),dt(Tl,"dragendHandler",null);const wl={class:"slider"},bl=["min","max","step"],kl={key:0,class:"text"},Cl=gi(wt({__name:"SSlider",props:{min:{type:Number,default:0},max:{type:Number,default:100},step:{type:Number,default:1},value:{type:Number,default:0}},emits:["change","complete"],setup(e,{expose:t,emit:i}){const a=e;let s=Ut(),l=Ut(""),n=Ut(!1);function r(){let e=s.value,t=function(e,t,i,a){return(e/=.5*a)<1?.5*i*e*e*e+t:.5*i*((e-=2)*e*e+2)+t}(Number(e.value),Number(e.min),Number(e.max),Number(e.max));return l.value=Math.ceil(t/a.max*100)+"%",t}return kt((()=>{s.value.value=a.value.toString();let e=r();i("change",e)})),t({addValue:function(e){let t=s.value;t.value=0==e?(Number(t.value)-50).toString():(Number(t.value)+50).toString();let a=r();i("change",a,!0)}}),(t,a)=>(St(),At("div",wl,[Et("input",{ref_key:"sliderbar",ref:s,type:"range",min:e.min,max:e.max,step:e.step,onInput:a[0]||(a[0]=Yt((e=>function(e){let t=r();i("change",t),n.value=!0}()),["stop"])),onChange:a[1]||(a[1]=e=>function(e){let t=e.target.value;i("complete",t),n.value=!1}(e))},null,40,bl),It(n)?(St(),At("div",kl,Wt(It(l)),1)):jt("",!0)]))}}),[["__scopeId","data-v-dfd6c4b9"]]);class Ml{static initial(){Bi.on(ki.keydown,this,this.handleKeyDown),Bi.on(ki.keyup,this,this.handleKeyUp)}static addListener(e,t,i,a){let s=this.getKeyline(e);if(null!=s){var l=this.typelists[s];null==l&&(l=[]);for(var n=0;n<l.length;n++){var r=l[n];if(r.caller==i&&r.listener==a)return}let e={enable:!0,command:t,caller:i,listener:a};return l.push(e),this.typelists[s]=l,e}return null}static removeListener(e,t,i){let a=this.getKeyline(e);var s=this.typelists[a];if(null!=s){for(var l=0;l<s.length;l++){var n=s[l];null==i?t==n.caller&&s.splice(l--,1):i==n.listener&&t==n.caller&&s.splice(l--,1)}s.length>0?this.typelists[a]=s:delete this.typelists[a]}}static clearAll(e){for(var t in this.typelists)this.removeListener(t,e,null)}static handleKeyDown(e){let t=e.target;if(null!=t){if(1==("true"==t.getAttribute("contenteditable")))return}var i=e.key.toLocaleLowerCase();if(this.isDebugKeyCode,"f5"==i||"f12"==i||"meta"==i)return;if(this.keydownlist.length>=1&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()),-1!=this.keydownlist.indexOf(i))return!1;this.keydown[i]=!0,this.keydownlist.push(i);let a=this.getKeyline(this.keydownlist);var s=this.typelists[a];if(null!=s&&s.length>0)for(var l=s.length,n=0;n<l;n++){var r=s[n];if(1==r.enable){var o=r.caller,d=r.listener;null!=d&&("string"==typeof o?d(r.command):d.call(o,r.command))}}return!1}static getKeyline(e){if(null==e||""==e)return null;let t=null;return t=e instanceof Array?e.join("+"):e,t.toLocaleLowerCase()}static handleKeyUp(e){var t=e.key.toLocaleLowerCase();if("f5"==t||"f12"==t)return;e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),delete this.keydown[t];let i=this.keydownlist.indexOf(t);-1!=i&&this.keydownlist.splice(i,1)}static isKeyDown(e){if(null==e||""==e)return!1;let t=!0;if(e instanceof Array)for(let i=0;i<e.length;i++){const a=e[i].toLocaleLowerCase();if(1!=this.keydown[a]){t=!1;break}}else t=1==this.keydown[e.toLocaleLowerCase()];return t}}dt(Ml,"keydown",{}),dt(Ml,"keydownlist",[]),dt(Ml,"typelists",{}),dt(Ml,"isDebugKeyCode",!1);class xl{}dt(xl,"shift","shift"),dt(xl,"control","Control"),dt(xl,"b","b"),dt(xl,"s","s"),dt(xl,"z","z"),dt(xl,"escape","escape"),dt(xl,"backspace","backspace"),dt(xl,"delete","delete");class Al{static onMounted(){if(Ml.isDebugKeyCode=!0,null!=this.keySetting)for(const e in this.keySetting){const t=this.keySetting[e];t.keyline=Ml.getKeyline(t.key),t.short+="("+t.keyline+")",Ml.addListener(t.keyline,t.name,this,this.KeyboardHandler)}else Ml.addListener([xl.control,xl.b],"剪辑块分割",this,this.KeyboardHandler),Ml.addListener([xl.control,xl.s],"保存文件",this,this.KeyboardHandler),Ml.addListener([xl.control,xl.z],"撤销",this,this.KeyboardHandler),Ml.addListener([xl.control,xl.shift,xl.z],"恢复",this,this.KeyboardHandler),Ml.addListener([xl.delete],"删除选择",this,this.KeyboardHandler)}static onUnmounted(){Ml.clearAll(this)}static async KeyboardHandler(e){this.executeCommand(e)}static executeCommand(e){switch(e){case"撤销":ol.UnExecute();break;case"恢复":ol.Execute();break;case"分割":case"剪辑块分割":qs.selectClipSplit(Ci.selectTimeValue);break;case"删除":case"删除选择":qs.deleteSelectClip();break;case"保存文件":ua.executeTrackAudio(qs.datas,!0)}}}dt(Al,"keySetting",{splitClip:{name:"剪辑块分割",short:"分割",key:[xl.control,xl.b]},saveFile:{name:"保存文件",short:"保存",key:[xl.control,xl.s]},undo:{name:"撤销",short:"撤销",key:[xl.control,xl.z]},redo:{name:"恢复",short:"恢复",key:[xl.control,xl.shift,xl.z]},delClip:{name:"删除选择",short:"删除",key:[xl.delete]}});class Il{static startRenderFrame(e,t){this.settingFPS=e,this.onFrameUpdate=t,this.stopRenderFrame();let i=Math.round(1e3/e);Ui.timer.loop(i,this,this.onRenderFrame),this.startTime=Ui.timer.getTime()}static stopRenderFrame(){Ui.timer.clearAll(this),Ui.timer.removeRenderFrame(this,this.onRenderFrame)}static getFpsCount(){return this.fpsCount}static onRenderFrame(){this.settingFPS;let e=Ui.timer.getTime(),t=e-this.startTime;this.startTime=e,this.passTime+=t,this.passTime>=1e3?(this.fpsCount=this.passCount,this.passCount=0,this.passTime=0):this.passCount+=1,null!=this.onFrameUpdate&&this.onFrameUpdate(t)}}dt(Il,"startTime",0),dt(Il,"passTime",0),dt(Il,"passCount",0),dt(Il,"fpsCount",0),dt(Il,"settingFPS",0),dt(Il,"onFrameUpdate");const Sl=class{static initial(){var e=window,t=Sl.userAgent=e.navigator.userAgent,i=e.navigator.maxTouchPoints||0,a=e.navigator.platform;Sl.onMobile=!!window.conch||t.indexOf("Mobile")>-1,Sl.onIOS=!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),Sl.onIPhone=t.indexOf("iPhone")>-1,Sl.onMac=t.indexOf("Mac OS X")>-1,Sl.onIPad=t.indexOf("iPad")>-1||"MacIntel"===a&&i>1,Sl.onAndroid=t.indexOf("Android")>-1||t.indexOf("Adr")>-1,Sl.onWP=t.indexOf("Windows Phone")>-1,Sl.onQQBrowser=t.indexOf("QQBrowser")>-1,Sl.onMQQBrowser=t.indexOf("MQQBrowser")>-1||t.indexOf("Mobile")>-1&&t.indexOf("QQ")>-1,Sl.onIE=!!e.ActiveXObject||"ActiveXObject"in e,Sl.onWeiXin=t.indexOf("MicroMessenger")>-1,Sl.onSafari=t.indexOf("Safari")>-1,Sl.onPC=!Sl.onMobile,Sl.onFirefox=t.indexOf("Firefox")>-1,Sl.onEdge=t.indexOf("Edge")>-1,Sl.onChorme=t.indexOf("Chorme")>-1}static VideoEncodeWebGlQueryParameter(){if(null==this.gl){let e=document.createElement("canvas");this.gl=e.getContext("webgl")}null!=this.gl&&(null==this.glext&&(this.glext=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")),null!=this.glext&&this.gl.getParameter(this.glext.MAX_TEXTURE_MAX_ANISOTROPY_EXT))}};let Rl=Sl;dt(Rl,"userAgent"),dt(Rl,"onMobile"),dt(Rl,"onIOS"),dt(Rl,"onMac"),dt(Rl,"onIPhone"),dt(Rl,"onIPad"),dt(Rl,"onAndroid"),dt(Rl,"onWP"),dt(Rl,"onQQBrowser"),dt(Rl,"onMQQBrowser"),dt(Rl,"onSafari"),dt(Rl,"onIE"),dt(Rl,"onWeiXin"),dt(Rl,"onPC"),dt(Rl,"onFirefox"),dt(Rl,"onEdge"),dt(Rl,"onChorme"),dt(Rl,"glext",null),dt(Rl,"gl",null);var Ll=(e=>(e.PeviewAudio="PeviewAudio",e.PeviewVideo="PeviewVideo",e.PeviewMovieClip="PeviewMovieClip",e))(Ll||{});class El{constructor(){dt(this,"playFPS",30),dt(this,"isPlaying",!1),dt(this,"_currenFrame",-1),dt(this,"_currentTime",-1),dt(this,"_duration",0),dt(this,"durationChange",!0),dt(this,"datas",[]),dt(this,"TrackActivateList",[]),dt(this,"ClipActivateList",[]),dt(this,"fpsReal"),dt(this,"realTimeTotal",0),dt(this,"lastSendTime",null),dt(this,"isTrackTimeUpdate",!1),dt(this,"isTrackTimeChange",!1),dt(this,"isSendTimeupdateChange",!1),dt(this,"isTrackPlayChange",!1),dt(this,"encodeCount",0),dt(this,"useMediaVideoList",[]),this.fpsReal=new Oi}onMounted(){}onUnmounted(){}setDatas(e){this.datas=e,this.durationChange=!0}get duration(){return this._duration}updateDurationChange(){if(1==this.durationChange&&null!=this.datas){this.durationChange=!1;let e=0,t=null;for(let i=0;i<this.datas.length;i++){const a=this.datas[i];if(0==a.clips.length)continue;let s=a.clips[a.clips.length-1].time.end/1e3;s>e&&(e=s,t=a)}this._duration!=e&&(this._duration=e,this._currentTime>this._duration&&(this._currentTime=this._duration),this.isTrackTimeUpdate=!0,this.isSendTimeupdateChange=!0,this.lastSendTime=null,null!=t&&t.setTimeline(this.currentTime))}}setProcess(e){}setPlaying(e){this.isPlaying!=e&&(this.isPlaying=e,this.isTrackPlayChange=!0)}get currentTime(){return this._currentTime}set currentTime(e){e>=this.duration&&(e=this.duration),this._currentTime=e;let t=1e3/this.playFPS;this._currenFrame=Math.round(1e3*e/t),this.isTrackTimeChange=!0,this.isTrackTimeUpdate=!0}makeTimeupdateChange(){this.isSendTimeupdateChange=!0}beforeRecordingResetClip(){Rs.recorder.getEnableAudioSound();for(let e=0;e<this.datas.length;e++){this.datas[e].resetClip()}this.isTrackTimeUpdate=!0}resetFpsTime(){this.realTimeTotal=0}onUpdate(e){if(Rl.VideoEncodeWebGlQueryParameter(),Rs.isRecordering){if(this.encodeCount>0)return void this.encodeCount--;const e=20;if(Rs.recorder.getEncodeQueueSize()>e)return this.encodeCount=Math.ceil(e/2),this.setPlaying(!1),void this.onTrackPlayChange();this.setPlaying(!0);for(let t=0;t<this.ClipActivateList.length;t++){if(1==this.ClipActivateList[t].isSeeking)return}}if(this.updateDurationChange(),this.onTrackTimeUpdate(),this.onTrackTimeChange(),this.onTrackPlayChange(),1==this.isPlaying){let t=e/1e3;if(t*=Mi.playbackRate,this._currentTime+=t,this._duration>0){this.isTrackTimeUpdate=!0;let t=this.duration;this.currentTime>=t&&t>0&&(this._currentTime=t,this.setPlaying(!1),Bi.send(ki.PeviewPlayComplete,Ll.PeviewMovieClip)),this.realTimeTotal+=e/1e3,this.fpsReal.updateFrame(1e3*this.realTimeTotal),this.onSendTimeupdate(!0,!1)}}else{let e=!1;Rs.recorder.state==ji.ready&&(e=!0,this.isSendTimeupdateChange=!0),1==this.isSendTimeupdateChange&&(this.isSendTimeupdateChange=!1,this.onSendTimeupdate(!1,e))}this._duration>0&&this.currentTime<=this._duration&&Hi.sendmainmessage(hi.TF_UPDATE_TIMELINE,this.currentTime,this._duration)}makeTrackTimeUpdate(){this.isTrackTimeUpdate=!0}onTrackTimeUpdate(){if(0==this.isTrackTimeUpdate)return;this.isTrackTimeUpdate=!1,this.TrackActivateList.length=0,this.ClipActivateList.length=0;let e=this.currentTime,t=this.datas.length;for(let i=t-1;i>=0;i--){const a=this.datas[i];let s=i;if(0==a.clips.length){s++;continue}a.indexZ=s,a.setClipEnterAndExitTimeline(this.onClipEnterTimelineHandler,this.onClipExitTimelineHandler),a.updateTimeline(e,this.isPlaying,t-i);let l=a.getActivateClip();null!=l&&(this.TrackActivateList.push(a),this.ClipActivateList.push(l))}}onTrackTimeChange(){if(0==this.isTrackTimeChange)return;this.isTrackTimeChange=!1;let e=this.currentTime;for(let t=0;t<this.datas.length;t++){this.datas[t].setTimeline(e)}}onTrackPlayChange(){if(0==this.isTrackPlayChange)return;this.isTrackPlayChange=!1;let e=this.currentTime;for(let t=0;t<this.datas.length;t++){const i=this.datas[t];i.setPlay(this.isPlaying),0==this.isPlaying&&i.setTimeline(e)}Bi.send(ki.PeviewPlayerStateUpdate,this.isPlaying)}onSendTimeupdate(e,t){let i=this.currentTime,a=Math.round(i);if(1==t||1==e||this.lastSendTime!=a){this.lastSendTime=a;let t=this.duration,s={type:Ll.PeviewMovieClip,currentTime:i,duration:t,target:this,isRealtTime:e};Bi.send(ki.PeviewPlayTimeupdate,s)}}sendClipEnterAll(){for(let e=0;e<this.TrackActivateList.length;e++){const t=this.TrackActivateList[e];null!=t.getActivateClip()&&this.onClipEnterTimelineHandler(t,t.getActivateClip())}}onClipEnterTimelineHandler(e,t){Hi.sendmainmessage(hi.TF_ClipEnterTimeline,e,t)}onClipExitTimelineHandler(e,t){Hi.sendmainmessage(hi.TF_ClipExitTimeline,e,t)}getUseMediaVideoList(){let e={},t=[],i=!1;for(let a=0;a<this.datas.length;a++){const s=this.datas[a];let l=s.clips,n=s.oldClipsLen,r=l.length;if(s.type==pi.Video&&r!=n)for(let a=0;a<l.length;a++){const s=l[a];1!=e[s.mediaId]&&(e[s.mediaId]=!0,t.push(s),i=!0)}}return 1==i&&(this.useMediaVideoList=t),this.useMediaVideoList}captureVideoFrameAlls(){let e=this.getUseMediaVideoList(),t=e.length;if(0!=t)for(let i=0;i<t;i++){let t=e[i].getMediaFile();t&&t.captureVideoFrame(Ji.zoomIndex,!1)}}getFrameTimeString(){let e=this.currentTime;return Vi.formatMillisTime(e,!0,!0)}}const Pl={class:"track-head-content"},_l={class:"track-head-icon"},Dl={key:0,class:"text gg-format-text"},Fl={key:1,class:"video gg-play-button-o"},Nl={key:2,class:"audio gg-music"},Ul={key:3,class:"image gg-image"},Ol=gi(wt({__name:"TrackHead",props:{itemdata:{}},setup(e){const t=e;function i(e){let i=t.itemdata;null!=i&&(1==e?i.isLock=!i.isLock:2==e?i.isHide=!i.isHide:3==e&&(i.type!=pi.Video&&i.type!=pi.Audio||t.itemdata.setMute(!i.isMute)))}let a=xt((()=>{let e=50;return t.itemdata&&(e=Bs.GetTrackSize(t.itemdata.type)),`height: ${e}px;`})),s=xt((()=>{let e="";return t.itemdata&&1==t.itemdata.isLock&&(e="LockColor"),e})),l=xt((()=>{let e="";return t.itemdata&&1==t.itemdata.isHide&&(e="LockColor"),e})),n=xt((()=>{let e="";return t.itemdata&&1==t.itemdata.isMute&&(e="LockColorRed"),e}));return xt((()=>{let e="";return t.itemdata&&(e=Bs.GetTrackName(t.itemdata.type)),e})),(e,t)=>(St(),At("div",{class:"track-head-container",style:Xt(It(a))},[Et("div",Pl,[Et("div",_l,[e.itemdata.type==It(pi).Text?(St(),At("i",Dl)):jt("",!0),e.itemdata.type==It(pi).Video?(St(),At("i",Fl)):jt("",!0),e.itemdata.type==It(pi).Audio?(St(),At("i",Nl)):jt("",!0),e.itemdata.type==It(pi).Image?(St(),At("i",Ul)):jt("",!0)]),Et("div",{class:"track-head-icon title","data-title":"锁定",onClick:t[0]||(t[0]=e=>i(1))},[Et("i",{class:Bt(It(s)+" lock gg-lock")},null,2)]),Et("div",{class:"track-head-icon title","data-title":"显隐",onClick:t[1]||(t[1]=e=>i(2))},[Et("i",{class:Bt(It(l)+" eye gg-eye")},null,2)]),Et("div",{class:"track-head-icon title","data-title":"声音",onClick:t[2]||(t[2]=e=>i(3))},[e.itemdata.type==It(pi).Video||e.itemdata.type==It(pi).Audio?(St(),At("i",{key:0,class:Bt(It(n)+" volume gg-volume")},null,2)):jt("",!0)])])],4))}}),[["__scopeId","data-v-a0cf8321"]]),Vl=e=>(Rt("data-v-1974d865"),e=e(),Lt(),e),Bl=["data"],Wl=[Vl((()=>Et("div",{class:"icon"},null,-1)))],zl=[Vl((()=>Et("div",{class:"icon"},null,-1)))],Gl=gi(wt({__name:"TrackClip",props:{clipindex:{},clipdata:{},type:{},zoom:{}},setup(e){const t=e;let i=Bi.createEventID();const a={isZoom:!1,border:"1px solid rgb(252, 252, 252)",display:"none",backgroundColor:"#9c4937",backgroundImage:"none",backgroundImageMask:"none",backgroundSize:"100% 100%",backgroundPositionX:"0px",backgroundPositionY:"0px"};let s=!1;kt((()=>{a.backgroundColor=Bs.GetTrackColor(t.type),n.value.style.backgroundColor=a.backgroundColor,h.value.style.backgroundColor=a.backgroundColor,m(t.clipdata.event.selected),Bi.on(ki.ZoomScroll,i,v)})),Ct((()=>{s=!0,Bi.clearAll(i)})),Mt([()=>t.clipdata.event.selected,()=>t.clipdata.event.cuthand],(e=>{m(t.clipdata.event.selected)}));let l=xt((()=>t.clipdata.type==pi.Text&&null!=t.clipdata.text.content?t.clipdata.text.content:t.clipdata.mediaFileName)),n=Ut(),r=Ut(),o=Ut(),d=Ut(),c=Ut(),u=Ut(),h=Ut();function m(e){let i=t.clipdata,s="0";1==e?(s="1",a.border="1px solid rgb(252, 252, 252)",1==t.clipdata.event.cuthand?a.display="flex":a.display="none"):(a.border="1px solid "+a.backgroundColor,a.display="none");let l=n.value;l.style.border=a.border,l.style.zIndex=s;let d=c.value;i.time.overOut>0?d.style.display=a.display:d.style.display="none";let h=r.value,m=o.value;h.style.display=a.display,m.style.display=a.display;let g=u.value;t.type==pi.Audio&&(g.style.display=a.display,"none"!=a.display&&p())}function p(){let e=u.value,i=t.clipdata,a=i.timepx.height-20,s=i.timepx.height/a,l=10/i.timepx.height*100+(100-i.media.volume)/s;e.style.top=l+"%"}function g(){let e=n.value,i=t.clipdata,a=i.time.end-i.time.start,s=Ji.convertTimeToPixel(i.time.start/1e3),l=Ji.convertTimeToPixel(a/1e3),r=Bs.GetTrackSize(i.type),o=0,u=d.value;i.time.overIn>0?(o=Ji.convertTimeToPixel(i.time.overIn/1e3),u.style.width=o+"px",u.style.display="flex"):(u.style.width="0px",u.style.display="none");let m=c.value;if(i.time.overOut>0){let e=Ji.convertTimeToPixel(i.time.overOut/1e3);m.style.width=e+"px"}else m.style.width="0px";let p=h.value;p.style.left=o+8+"px",p.style.maxWidth=Math.max(1,l-16)+"px",i.timepx.left=s,i.timepx.width=l,i.timepx.height=r,e.style.setProperty("left",`${Math.round(s)}px`,"important"),e.style.setProperty("width",`${Math.round(l)}px`,"important")}function f(){n.value;let e=t.clipdata;e.type==pi.Audio?a.backgroundImageMask=Gs.URL_audiomask:a.backgroundImageMask="none";let i=e.totalTime,s=Ji.convertTimeToPixel(i/1e3);if(e.type==pi.Video||e.type==pi.Audio){let t=oa.getFileByMediaId(e.mediaId);null!=t&&null!=t.captureImage&&(a.backgroundImage=`url(${t.captureImage})`)}else a.backgroundImage="none";let l=s*(e.time.startCut/i);a.backgroundPositionX="-"+Math.round(l)+"px";let r=e.timepx.height;if(e.type==pi.Audio){let t=e.media.volume/100;a.backgroundSize=Math.round(s)+"px "+Math.round(r*t)+"px",a.backgroundPositionY=Math.round(r*(1-t))+"px"}else e.type==pi.Video?(a.backgroundSize=Math.round(s)+"px 45px",a.backgroundPositionY=(e.timepx.height-45)/2+"px"):(a.backgroundSize=Math.round(s)+"px "+Math.round(r)+"px",a.backgroundPositionY="0px");y()}function v(e){a.isZoom=e,y()}function y(){let e=n.value,i=t.clipdata;0==a.isZoom||i&&i.type==pi.Audio&&1==i.isPlayActivate?(e.style.backgroundImage=a.backgroundImageMask+","+a.backgroundImage,e.style.backgroundPositionX=a.backgroundPositionX+","+a.backgroundPositionX,e.style.backgroundPositionY="0px,"+a.backgroundPositionY,e.style.backgroundSize="42px 42px , "+a.backgroundSize):e.style.backgroundImage="none,none"}Mt((()=>t.zoom),((e,t)=>{g(),f()})),Mt((()=>t.clipdata.watchVer),((e,t)=>{g(),f()})),Mt((()=>t.clipdata.media.volume),((e,t)=>{p()}));let T=xt((()=>{let e=t.clipdata,i=n.value;if(null!=e&&null!=i){let t="none";if(e.type==pi.Video||e.type==pi.Audio){let i=oa.getFileByMediaId(e.mediaId);null!=i&&null!=i.captureImage&&(t=`url(${i.captureImage})`)}a.backgroundImage!=t&&(a.backgroundImage=t,i.style.backgroundImage=a.backgroundImageMask+","+a.backgroundImage)}return""}));return(e,i)=>(St(),At("div",{ref_key:"refContainer",ref:n,class:"clip-container",data:It(T)},[Et("div",{ref_key:"refOverIn",ref:d,class:"clip-over left"},Wl,512),Et("div",{ref_key:"refOverOut",ref:c,class:"clip-over right"},zl,512),Et("div",{ref_key:"refcliptext",ref:h,class:"clip-text"},Wt(" "+It(l)+" "),513),Et("div",{ref_key:"refHandL",ref:r,id:"cuthand-left",class:"cuthand left"},null,512),Et("div",{ref_key:"refHandR",ref:o,id:"cuthand-right",class:"cuthand right"},null,512),Jt(Et("div",{ref_key:"refVolumeHand",ref:u,id:"volume-hand",class:"div-volume-hand"},null,512),[[Qt,t.type==It(pi).Audio]])],8,Bl))}}),[["__scopeId","data-v-1974d865"]]),Zl=["divname","trackIndex"],Hl={key:0,id:"track-line-lockmask",class:"track-line-lockmask"},jl=gi(wt({__name:"TrackLine",props:{itemindex:{},itemdata:{},zoom:{}},setup(e){const t=e;let i=Bi.createEventID(),a=fi;const s=e=>{t.itemdata instanceof Vs&&(t.itemdata.domdiv=e)};kt((()=>{Hi.onlib(hi.TM_SCENE_PICK_CLIP,i,v),Bi.on(ki.CancelSelectClip,i,y)})),Ct((()=>{Bi.clearAll(i),Hi.clearAll(i)}));let l=xt((()=>{let e=50;return t.itemdata&&(e=Bs.GetTrackSize(t.itemdata.type)),`height: ${e}px;`})),n=xt((()=>{let e="",i=t.itemdata;return i&&1==i.isHide&&(e="styleHide"),e})),r=xt((()=>{let e="";return 1==t.itemdata.isMain&&(e="styleMain"),e})),o={index:0,clip:null,track:null},d=null,c=0,u=0,h=0,m=0,p=0,g=!1;function f(e){let i=t.itemdata.clips;if(null==i)return null;if(e>=0&&e<i.length){return i[e]}return null}function v(e,i){let a=o;if(null!=i&&null!=e){let a=e.clips.indexOf(i);-1!=a&&(o={index:a,clip:i,track:t.itemdata})}else o=null;a!=o&&Ci.selectClipData(o)}function y(e){let i=o,a=null;e>=0&&(a=f(e)),o=null!=a?{index:e,clip:a,track:t.itemdata}:null,i!=o&&(Ci.selectClipData(o),Hi.sendmainmessage(hi.TF_SELECT_PICK_CLIP,a))}let T={};function w(e,t){T.move=null,T.cut=null;let i=e.target;if("track-line-content"==i.parentElement.id){let e=Number(i.id);if(isNaN(e))return!0;y(e)}else if(null!=(null==o?void 0:o.clip))switch(i.id){case"cuthand-left":d=1;break;case"cuthand-right":d=2;break;case"volume-hand":g=!0;break;default:y(null)}let a=null==o?void 0:o.clip;if(null==a)return!0;c=a.time.start,u=a.time.end,h=a.time.startCut,m=a.time.endCut,p=a.media.volume}function b(e,t){let i=o.clip,a=o.track;if(null==i||null==a)return;if(0==t.distX)return;let s=1e3*Ji.convertPixelToTime(t.distX),l=c,n=u,r=h,v=m,y=u-c,w=Math.round(u+m-(c-h)),b=1e3;i.time.start,i.time.end;let k=i.time.startCut,C=i.time.endCut,M=i.isCutLimit,x=i.time.overIn,A=i.time.overOut,I=i.isOverEnable,S=!1,R=!1;if(1==d){if(l=c+s,r=h+s,s<0)r<=0&&(r=0,1==M&&(l=c-h));else{if(!(s>0))return;{let e=w-m-b;r>e&&(r=e,l=c+(e-h))}}S=!0}else if(2==d){if(n=u+s,v=m+-s,s<0){let e=w-h-b;v>e&&(v=e,n=c+b)}else{if(!(s>0))return;v<=0&&(v=0,1==M&&(n=u+m))}R=!0}else{if(1==g){let e=Math.max(0,Math.min(100,p-3*t.distY));return i.setVolume(e),void i.changeWatchVer()}l=c+s,n=u+s,S=!0,R=!0}let L=-1,E=1e3*Ji.convertPixelToTime(10);if(1==qs.isAutoOverInOut&&1==I){let e=f(o.index-1);if(null!=e){let t=!1,i=e.time.end;if(l<=i+E&&l>=i)l=i,null==d?n=l+y:(r=k,v=C),L=0,t=!0;else if(l<=i){let t=e.time.start+e.time.overIn;l<=t&&(l=t,null==d?n=l+y:(r=k,v=C),L=0),x=Math.max(0,i-l),e.time.overOut=x,e.changeWatchVer()}(l>i||1==t)&&0!=e.time.overOut&&(x=0,e.time.overOut=0,e.changeWatchVer())}let t=f(o.index+1);if(null!=t){let e=!1,i=t.time.start;if(n>=i-E&&n<=i)n=i,null==d?l=n-y:(r=k,v=C),L=1,e=!0;else if(n>=i){let e=t.time.end-t.time.overOut;n>=e&&(n=e,null==d?l=n-y:(r=k,v=C),L=1),A=Math.max(0,n-i),t.time.overIn=A,t.changeWatchVer()}(n<i||1==e)&&0!=t.time.overIn&&(A=0,t.time.overIn=0,t.changeWatchVer())}}if(1!=qs.isAutoTrackMagnet&&(E=0),1==S&&t.distX<0&&(l<=0+E&&(l=0,null==d?n=y:(r=k,v=C),L=0),x<=0)){let e=f(o.index-1);if(null!=e&&l<=e.time.end+E&&(l=e.time.end,null==d?n=l+y:(r=k,v=C),L=0),E>0&&-1==L&&t.distX<0){let e=qs.getNearClipLeft(a,i);if(e){let t=e.time.start;Math.abs(l-e.time.start)>Math.abs(l-e.time.end)&&(t=e.time.end),Math.abs(l-t)<E&&(l=t,null==d?n=l+y:(r=k,v=C),L=0)}}}if(1==R&&t.distX>0&&A<=0){let e=f(o.index+1);if(null!=e&&n>=e.time.start-E&&(n=e.time.start,null==d?l=n-y:(r=k,v=C),L=1),E>0&&-1==L&&t.distX>0){let e=qs.getNearClipRight(a,i);if(e){let t=e.time.start;Math.abs(n-e.time.start)>Math.abs(n-e.time.end)&&(t=e.time.end),Math.abs(n-t)<E&&(n=t,null==d?l=n-y:(r=k,v=C),L=1)}}}if(-1!=L&&0!=t.distX){let e=Ji.convertTimeToPixel(l/1e3);0==L?Js.drawClipRect(a,{x:e},!0):Js.drawClipRect(a,{x:e+i.timepx.width},!0)}i.time.start==l&&i.time.end==n&&i.time.startCut==r&&i.time.endCut==v||(i.time.start=l,i.time.end=n,i.time.startCut=r,i.time.endCut=v,i.time.overIn=x,i.time.overOut=A,i.changeWatchVer(),1==S&&1==R?T.move={selectClip:i,oldStart:c,oldEnd:u,newStart:-1,newEnd:-1}:1!=S&&1!=R||(T.cut={selectClip:i,oldStart:c,oldEnd:u,oldStartCut:h,oldEndCut:m,newStart:-1,newEnd:-1,newStartCut:r,newEndCut:v}))}async function k(e,t){Js.drawClipRect(null);let i=o.clip,a=o.track,s=!1;null!=T&&(1!=t.dragComplete&&(null==T.move&&null==T.cut||qs.mainTrackAlignment(a,i),null!=T.move?i.time.start!=T.move.oldStart&&(T.move.newStart=i.time.start,T.move.newEnd=i.time.end,ol.SaveExecuteAction(vi.Undo_MoveClip,T.move),s=!0):null!=T.cut&&(T.cut.newStart=i.time.start,T.cut.newEnd=i.time.end,ol.SaveExecuteAction(vi.Undo_CutClip,T.cut),2==d&&(s=!0))),T.move=null,T.cut=null),c=null,u=null,d=null,g=!1,1!=Math.abs(t.distX)<5&&1==s&&qs.cheackDurationChange(o.track,o.clip)}function C(e,t){t.sourceTarget;let i=null==o?void 0:o.clip,a=o.track;null!=i&&(i.event.cuthand=!1),Js.dragstart(e,t,i,a)}function M(e,t){Js.dragmove(e,t)}function x(e,t){return Js.dragend(e,t),!1}return(e,t)=>(St(),At("div",{class:"track-line-container",style:Xt(It(l))},[Et("div",{ref:s,divname:It(a).TrackLine,trackIndex:e.itemindex,id:"track-line-content",class:Bt(It(n)+" track-line-content "+It(r)),onMousedown:t[0]||(t[0]=e=>function(e){let t=e.target;t.getAttribute("divname")!=fi.TrackLine&&(Tl.downEventProxy(e,null,w,b,k),"track-line-content"==t.parentElement.id&&Tl.dragEventProxy(C,M,x))}(e))},[(St(!0),At(Ot,null,Vt(e.itemdata.clips,((t,i)=>(St(),Zt(Gl,{divname:It(a).TrackClip,id:i,key:t.uuid,clipdata:t,type:e.itemdata.type,zoom:e.zoom,clipindex:i},null,8,["divname","id","clipdata","type","zoom","clipindex"])))),128))],42,Zl),e.itemdata.isLock?(St(),At("div",Hl)):jt("",!0)],4))}}),[["__scopeId","data-v-e2061f48"]]),Yl=e=>(Rt("data-v-0905098c"),e=e(),Lt(),e),Xl={class:"divbody"},Jl={class:"header"},Ql={class:"header-left"},Kl=Yl((()=>Et("div",{class:"a1 title","data-title":"切换鼠标为选择状态或分割状态"},null,-1))),$l=Yl((()=>Et("div",{class:"iconline"},null,-1))),ql=["data-title"],en=["data-title"],tn=["data-title"],an=["data-title"],sn=Kt('<div class="a6 display-none title" data-title="定格" data-v-0905098c></div><div class="a7 display-none title" data-title="倒放" data-v-0905098c></div><div class="a8 display-none title" data-title="镜像" data-v-0905098c></div><div class="a9 display-none title" data-title="旋转" data-v-0905098c></div><div class="a10 display-none title" data-title="裁剪" data-v-0905098c></div><div class="a11 display-none title" data-title="智能口播" data-v-0905098c></div>',6),ln={class:"header-right"},nn=Yl((()=>Et("div",{class:"b1 display-none title","data-title":"录音"},null,-1))),rn=Yl((()=>Et("div",{class:"iconline"},null,-1))),on=["data-title"],dn=["data-title"],cn=Yl((()=>Et("div",{class:"b4 display-none title","data-title":"打开联动"},null,-1))),un=Yl((()=>Et("div",{class:"b5 display-none title","data-title":"打开预览轴"},null,-1))),hn={class:"b7"},mn=Yl((()=>Et("div",{class:"line"},null,-1))),pn={class:"track"},gn={class:"track-container"},fn={class:"track-header"},vn=Yl((()=>Et("div",{class:"timeline-head"},null,-1))),yn=Yl((()=>Et("div",{class:"timeline-content-space"},null,-1))),Tn={class:"track-content"},wn=["onMousedown"],bn={class:"timeline-content bindRightMinWidth"},kn=["divname"],Cn=Yl((()=>Et("div",{class:"timeline-content-space"},null,-1))),Mn=[Yl((()=>Et("div",{class:"timeline-pointer-top"},null,-1)))],xn={class:"track-draw-layer"},An=gi(wt({__name:"EditorMain",setup(e){bt((e=>({"2cc0406e":a.timelinePointerLeft,"6c7b9c03":a.rightMinWidthPx,"40fee29a":a.rightMinHeightPx,"3b303395":a.timelinecanvasLeft})));let t=Bi.createEventID(),i=fi;const a=Tt({timelinePointerLeft:"0px",rightMinWidth:0,rightMinWidthPx:"0px",rightMinHeightPx:"0px",timelinecanvasLeft:"0px"}),s=Tt({zoomMax:3e3,zoomVal:300,isMainTrackMagnet:!0,isAutoTrackMagnet:!0});let l=qs.initDatas();const n={selectTimeValue:0,selectTimePixel:0,isZoomScroll:!1,lastCurrenTimePixel:-1,isScrollLeft:!1,lastScrollTop:null,lastScrollLeft:null,isDisableScroll:!1,timelineChange:!0};let r=Ut(),o=Ut(),d=Ut(!1),c=Ut(),u=Ut();const h=Ut(null);function m(){N(!1)}let p=new El;function g(e,t){(isNaN(e)||e<=0)&&(e=30),p.resetFpsTime(),Il.startRenderFrame(e,b)}function f(e){Al.executeCommand(e)}function v(e){switch(e){case"主轨磁吸":s.isMainTrackMagnet=!s.isMainTrackMagnet,qs.setMainTrackMagnet(s.isMainTrackMagnet);let e={uidata:s,oldVal:!s.isMainTrackMagnet,newVal:s.isMainTrackMagnet};ol.SaveExecuteAction(vi.Undo_MainTrackMagnet,e);break;case"自动吸附":s.isAutoTrackMagnet=!s.isAutoTrackMagnet,qs.isAutoTrackMagnet=s.isAutoTrackMagnet}}function y(e){null!=e?p.setPlaying(!1):C()}function T(e,t){}function w(e,t){null!=t&&(e=!1),p.setPlaying(e),e&&N(!1)}function b(e){p.onUpdate(e),1==p.isPlaying&&1!=Rs.isRecordering&&C(),function(){if(0==n.timelineChange)return;n.timelineChange=!1;var e=h.value;if(null==e)return;let t=u.value;if(null==t)return;let i=Ji.timelineZoom;a.timelinecanvasLeft=u.value.scrollLeft+"px",function(){let e=100,t=u.value;if(t){e=t.scrollWidth;let i=n.selectTimePixel+t.clientWidth/2;e<i&&(e=i),e-=5,a.rightMinWidth=e,a.rightMinWidthPx=e+"px",a.rightMinHeightPx=t.clientHeight+"px"}}(),document.body.clientWidth;let s=t.scrollLeft,l=B(),r=Math.max(e.offsetWidth,l),o=e.clientHeight;e.width=r,e.height=o;var d=e.getContext("2d");d.fillStyle="#1b1b1b",d.fillRect(0,0,e.width,e.height),d.font='10px "微软雅黑"',d.textAlign="left",d.fillStyle="#696969";let c=20,m=100*i,p=(s+e.width)/m,g=60*p*1e3;Vi.millisToMinutesAndSeconds(g,!0);for(let a=0;a<p;a++){let e=a*m-s;d.lineWidth=1,d.strokeStyle="#696969",d.beginPath(),d.moveTo(e,0),d.lineTo(e,.8*c),d.stroke();let t=!1,l=0,n=0;for(let a=0;a<=6;a++){let r=a*m/6,o=e+r;a>0&&a<6&&(d.lineWidth=.7,d.strokeStyle="#696969",d.beginPath(),d.moveTo(o,0),d.lineTo(o,c/4),d.stroke());let u=r-l;if(u>=50){if(t=!0,a<6){d.font='10px   "微软雅黑"';let e=10*(o+s)*60/i,t=Vi.millisToMinutesAndSeconds(e);d.fillText(t,o-2,.78*c)}for(let e=1;e<6;e++){let t=n+e*u/6;d.strokeStyle="#696969",d.lineWidth=.3,d.beginPath(),d.moveTo(t,0),d.lineTo(t,c/5),d.stroke()}}l=r,n=o}t&&(d.font='normal bold 10px  "微软雅黑"');let r=10*(e+s)*60/i,o=Vi.millisToMinutesAndSeconds(r);d.fillText(o,e+Math.max(5,5/i),.78*c)}}(),Js.updateRenderCanvas()}function k(e,t,i){p.setPlaying(t);let a=!1;p.currentTime!=e&&(p.currentTime=e,a=!0),p.onSendTimeupdate(!1,!0),1!=a&&1!=i||F(e,!0)}function C(){if(0==n.isDisableScroll){F(p.currentTime,!1)}}function M(){d.value=!d.value,W(),n.lastScrollTop=null,n.lastScrollLeft=null}function x(){if(n.isDisableScroll=!1,1==n.isZoomScroll){n.isZoomScroll=!1;const e=10;let t=Math.round(s.zoomVal/s.zoomMax*e);Ji.zoomIndex=t,Bi.send(ki.ZoomScroll,n.isZoomScroll),p.captureVideoFrameAlls()}1==A.mode&&(A.mode=!1,Bi.off(ki.mousemove,t,S),Js.removeDrawFunc(t,I)),Js.clearCanvas()}Ci.mc=p,kt((()=>{p.onMounted(),p.setDatas(l),p.makeTimeupdateChange(),p.currentTime=0,W(),Js.setCanvas(o.value),Js.divTrackScroll=u.value,Bi.on(ki.SlotFrameResize,t,M),Bi.on(ki.mouseup,t,x),Bi.on(ki.PeviewPlayerChangeFile,t,y),Bi.on(ki.PeviewPlayerSetProcess,t,T),Bi.on(ki.PeviewPlayerPlaying,t,w),Bi.on(ki.GotoTimeline,t,k),Bi.on(ki.SetRenderFrameFPS,t,g),Al.onMounted(),g(30)})),Ct((()=>{p.onUnmounted(),Bi.clearAll(t),Al.onUnmounted(),Js.clearAll(),Il.stopRenderFrame(),Ui.timer.clearAll(t)}));const A={mode:!1,downPoint:{x:0,y:0},distX:0,distY:0};function I(e,t){let i=t.getBoundingClientRect(),a=A.downPoint.x-i.left,s=A.downPoint.y-i.top,l=A.distX,n=A.distY;l<0&&(a+=l,l=-l),n<0&&(s+=n,n=-n),e.lineWidth=2,e.strokeStyle="#00ff00",e.beginPath(),e.strokeRect(a,s,l,n),e.stroke()}function S(e){A.distX=e.clientX-A.downPoint.x,A.distY=e.clientY-A.downPoint.y,Js.changeRenderCanvas=!0}function R(e,t){n.isDisableScroll=!0;let i=u.value.scrollLeft;P(e.offsetX,i,!1,!1)}function L(e,t){let i=u.value.scrollLeft,a=u.value.scrollWidth,s=B();P(t.offsetX,i,!1,!0);let l=-1;n.selectTimePixel>=0&&n.selectTimePixel<i+50?l=n.selectTimePixel-50:n.selectTimePixel>i+(s-50)&&(l=n.selectTimePixel-(s-50)),-1!=l&&l>=0&&l<=a&&(u.value.scrollLeft=l)}function E(e,t){let i=u.value.scrollLeft;P(t.offsetX,i,!0,!1),W()}function P(e,t,i,s){let l=Math.max(0,t+e),r=(o=l,n.selectTimeValue=Ji.convertPixelToTime(o),n.selectTimePixel=o,Ci.selectTimeValue=n.selectTimeValue,n.selectTimeValue);var o;r>p.duration&&(r=p.duration,l=_(r)),a.timelinePointerLeft=l+"px",(1==s||1==i)&&(p.currentTime=r,p.makeTimeupdateChange())}function _(e){return n.selectTimePixel=Ji.convertTimeToPixel(e),n.selectTimeValue=e,Ci.selectTimeValue=n.selectTimeValue,n.selectTimePixel}function D(e,t){s.zoomVal=e;let i=e/100+.8;Ji.timelineZoom=i,n.isDisableScroll=!0,1!=t&&0==n.isZoomScroll&&(n.isZoomScroll=!0,Bi.send(ki.ZoomScroll,n.isZoomScroll)),F(n.selectTimeValue,!0)}function F(e,t=!1){let i=Math.round(_(e));n.lastCurrenTimePixel==i&&1!=t||(n.lastCurrenTimePixel=i,a.timelinePointerLeft=i+"px",W(),N(1!=t))}function N(e){let t=u.value;if(t){let i=.5,a=t.clientWidth*i,s=_(n.selectTimeValue)-a;1==e?s>t.scrollLeft&&(t.scrollLeft+=.5*(s-t.scrollLeft)):t.scrollLeft=s}}function U(e){n.isScrollLeft=e}function O(e){n.isDisableScroll=!0}let V=xt((()=>{let e=100;d.value;let t=u.value;return t&&(e=t.clientHeight),`min-height: ${e}px;`}));function B(){let e=u.value;return e?e.clientWidth-5:0}function W(){n.timelineChange=!0}return(e,a)=>(St(),At("div",Xl,[Et("div",Jl,[Et("div",Ql,[Kl,$l,Et("div",{class:"a2 button title","data-title":It(Al).keySetting.undo.short,onMouseup:a[0]||(a[0]=e=>f(It(Al).keySetting.undo.name))},null,40,ql),Et("div",{class:"a3 button title","data-title":It(Al).keySetting.redo.short,onMouseup:a[1]||(a[1]=e=>f(It(Al).keySetting.redo.name))},null,40,en),Et("div",{class:"a4 button title","data-title":It(Al).keySetting.splitClip.short,onMouseup:a[2]||(a[2]=e=>f(It(Al).keySetting.splitClip.name))},null,40,tn),Et("div",{class:"a5 button title","data-title":It(Al).keySetting.delClip.short,onMouseup:a[3]||(a[3]=e=>f(It(Al).keySetting.delClip.name))},null,40,an),sn]),Et("div",ln,[nn,rn,Et("div",{class:Bt(["button title",s.isMainTrackMagnet?"b2s":"b2"]),"data-title":(s.isMainTrackMagnet?"关闭":"打开")+"主轨磁吸",onMouseup:a[4]||(a[4]=e=>v("主轨磁吸"))},null,42,on),Et("div",{class:Bt(["button title",s.isAutoTrackMagnet?"b3s":"b3"]),"data-title":(s.isAutoTrackMagnet?"关闭":"打开")+"自动吸附",onMouseup:a[5]||(a[5]=e=>v("自动吸附"))},null,42,dn),cn,un,Et("div",{class:Bt(["b6 button title",0==s.zoomVal?"disabled":""]),"data-title":"缩小",onClick:a[6]||(a[6]=e=>It(r).addValue(!1))},null,2),Et("div",hn,[Gt(Cl,{ref_key:"refZoomSlider",ref:r,max:s.zoomMax,value:s.zoomVal,step:1,onChange:D},null,8,["max","value"])]),Et("div",{class:Bt(["b8 button title",s.zoomVal==s.zoomMax?"disabled":""]),"data-title":"放大",onClick:a[7]||(a[7]=e=>It(r).addValue(!0))},null,2),Et("div",{class:"b9 button title","data-title":"定位",onClick:m})])]),mn,Et("div",pn,[Et("div",gn,[Et("div",fn,[Et("div",{ref_key:"divScrollLeft",ref:c,class:"track-header-scroll",onScroll:a[8]||(a[8]=e=>{1==n.isScrollLeft&&(u.value.scrollTop=c.value.scrollTop)}),onMouseover:a[9]||(a[9]=e=>U(!0))},[vn,Et("div",{class:"div-left-autosize",style:Xt(It(V))},[yn,(St(!0),At(Ot,null,Vt(It(l),((e,t)=>(St(),Zt(Ol,{key:e.uuid,itemdata:It(l)[t],"onUpdate:itemdata":e=>It(l)[t]=e},null,8,["itemdata","onUpdate:itemdata"])))),128))],4)],544)]),Et("div",Tn,[Et("div",{ref_key:"divTrackContentScroll",ref:u,class:"track-content-scroll",onScroll:a[13]||(a[13]=e=>function(e){if(0==n.isScrollLeft){let e=u.value.scrollTop;n.lastScrollTop!=e&&(n.lastScrollTop=e,c.value.scrollTop=u.value.scrollTop);let t=u.value.scrollLeft;n.lastScrollLeft!=t&&(n.lastScrollLeft=t,W())}}()),onMouseover:a[14]||(a[14]=e=>U(!1)),onMousedown:Yt(O,["self"])},[Et("div",bn,[Et("canvas",{ref_key:"refTimecanvas",ref:h,class:"timeline-content-canvas bindTimelinecanvasLeft",onMousedown:a[10]||(a[10]=Yt((e=>{return t=e,void Tl.downEventProxy(t,null,R,L,E);var t}),["stop"]))},null,544)]),Et("div",{divname:It(i).TrackBG,id:"id-right-autosize",class:"div-right-autosize bindRightMinWidth bindRightMinHeight",onMouseup:a[11]||(a[11]=e=>function(e){if(1==A.mode&&(A.distX>10||A.distY>10))return;let t=e.target,i=t.getAttribute("divname");i!=fi.TrackBG&&"id-right-autosize"!=t.id&&"track-line-content"!=t.id&&"track-line-lockmask"!=t.id||(i==fi.TrackBG&&Ci.getSelectClipData().length>0&&1!=Tl.isMouseDrag&&Bi.send(ki.CancelSelectClip),P(e.offsetX,0,!0,!1))}(e)),onMousedown:a[12]||(a[12]=e=>{return i=e,A.mode=!0,A.downPoint.x=i.clientX,A.downPoint.y=i.clientY,Bi.on(ki.mousemove,t,S),void Js.addDrawFunc(t,I);var i})},[Cn,Et("div",{class:"timeline-pointer bindPointerLeft",style:Xt(It(V))},Mn,4),(St(!0),At(Ot,null,Vt(It(l),((e,t)=>(St(),Zt(jl,{key:e.uuid,itemdata:It(l)[t],"onUpdate:itemdata":e=>It(l)[t]=e,itemindex:t,"data-id":e.uuid,zoom:s.zoomVal},null,8,["itemdata","onUpdate:itemdata","itemindex","data-id","zoom"])))),128))],40,kn)],40,wn),Et("div",xn,[Et("canvas",{ref_key:"drawcanvas",ref:o,class:"track-draw-canvas"},null,512)])])])])]))}}),[["__scopeId","data-v-0905098c"]]),In={class:"loading"},Sn=gi(wt({__name:"Mloading1",setup:e=>(e,t)=>(St(),At("div",In))}),[["__scopeId","data-v-d78990ab"]]);var Rn=(e=>(e.okNormal="gg-check-o",e.okGreen="gg-check-o green",e.error="gg-close-o red",e.warning="gg-info yellow",e))(Rn||{}),Ln=(e=>(e.green="green",e.red="red",e.yellow="yellow",e))(Ln||{});const En={class:"div-export-container"},Pn={class:"a center"},_n={class:"time center"},Dn={class:"b center"},Fn={class:"div-progress gridsmall"},Nn={class:"div-progress-text center"},Un={class:"c"},On={class:"c1 center"},Vn={class:"info center green"},Bn={class:"c2"},Wn={class:"gg-software-download"},zn=gi(wt({__name:"PopupExport",setup(e){let t=Bi.createEventID(),i=Ut(),a=Ut(),s=Ut(),l=Tt({progress:"0",remind:"",isRecordering:!1,isComplete:!1,btnExportLabel:"导出",timeInfo:"00:00:00.00 / 00:00:00.00",exportInfo:"",exportIcon:Rn.error,exportIconColor:Ln.red}),n={currentTime:0,duration:0,videoRate:"",videoInfo:""},r=!1;function o(e){e.type==Ll.PeviewMovieClip&&(n.currentTime=e.currentTime,n.duration=e.duration,1==Rs.isRecordering&&c())}function d(){Rs.stop()}function c(){if(1==l.isComplete){s.value.style.width="100%",l.remind="快去发布视频上热门吧！"}else if(1!=Rs.isRecordering){s.value.style.width="0%",l.remind="准备好了吗？快点击导出您制作的热门视频吧！"}else{let e=Rs.recorderProgress;e=mi.clamp(e,0,100);let t=(Math.round(1e3*e)/1e3).toFixed(2);(0==e||e>=100)&&(t=e+""),l.progress=t,l.remind=e>=100?`视频已生成，快去看看吧！${t}%`:`正在编码，请不要将窗口最小化或进行任何操作，${t}%`,s.value.style.width=`${t}%`}let e=Vi.formatMillisTime(1e3*n.currentTime,!0,!0),t=Vi.formatMillisTime(1e3*n.duration,!0,!0),i=Rs.high.canvas.width,a=Rs.high.canvas.height;l.timeInfo=`${i}x${a}      ${n.videoRate}      [ ${e} / ${t} ]`}function u(){let e=Rs.isRecordering;l.isRecordering=e,l.btnExportLabel=1==e?"停止":"导出视频"}function h(){Rs.stop(),l.btnExportLabel="下载",l.isComplete=!0,c(),m("视频已经生成啦",0)}function m(e,t){switch(t){case 0:default:l.exportIcon=Rn.okGreen,l.exportIconColor=Ln.green;break;case 1:l.exportIcon=Rn.warning,l.exportIconColor=Ln.yellow;break;case 2:l.exportIcon=Rn.error,l.exportIconColor=Ln.red}l.exportInfo=e||""}function p(){let e=qs.getKaraoke(Ks.Jrc);if(null!=e){let t=new Blob([e.content],{type:"text/plain"}),i=URL.createObjectURL(t),a=e.filename||"字幕-未命名";zs.browserDownload(i,a+"."+e.format)}}function g(){if(1==l.isComplete)return void Rs.downloadVideo();let e=Ci.mc;e.duration<=0||e.currentTime>=e.duration?m("时间轴没有时长，无法录制",2):(m(),1!=Rs.isRecordering?Rs.start():Rs.stop())}function f(){Rs.stop(),Ar.close()}return $t((()=>{r=!0,gt((()=>{1==r&&async function(){let e=i.value,s=a.value,n=e.getBoundingClientRect();s.width=n.width,s.height=n.height,Rs.preview.viewWidth=n.width,Rs.preview.viewHeight=n.height,Rs.preview.canvas=s,Rs.preview.ctx=s.getContext("2d"),l.isComplete=!1,l.isRecordering=!1,l.progress="0",m(),Bi.send(ki.GotoTimeline,0,!1,!0),Bi.on(ki.PeviewPlayTimeupdate,t,o),Bi.on(ki.PeviewPlayComplete,t,d),Bi.on(ki.RecorderStateChange,t,u),Bi.on(ki.RecorderComplete,t,h),c(),u(),Rs.beforeReadying(),await Vi.setTimeout(50),c()}()}))})),qt((()=>{r=!1,r=!1,Rs.preview.canvas=null,Rs.preview.ctx=null,Bi.clearAll(t)})),(e,t)=>(St(),At("div",En,[Et("div",Pn,[Et("div",_n,Wt(It(l).timeInfo),1),Et("div",{ref_key:"refDivContent",ref:i,class:"div-canvas-content center gridsmall"},[Et("canvas",{ref_key:"refTargetCanvas",ref:a,class:"div-target-canvas"},null,512)],512)]),Et("div",Dn,[Et("div",Fn,[Et("div",{ref_key:"refProgressbar",ref:s,class:"div-progress-bar progressmask"},null,512),Et("div",Nn,Wt(It(l).remind),1)])]),Et("div",Un,[Et("div",On,[Jt(Et("div",Vn,[Et("i",{class:Bt(["icon",It(l).exportIcon,It(l).exportIconColor])},null,2),Et("i",{class:Bt(It(l).exportIconColor)},Wt(It(l).exportInfo),3)],512),[[Qt,""!=It(l).exportInfo]])]),Et("div",Bn,[Et("div",{class:"btn0 center",onMouseup:p},"导出歌词（JRC）",32),Et("div",{class:"btn1 center",onMouseup:g},[Jt(Gt(Sn,{style:{left:"-10px"}},null,512),[[Qt,1==It(l).isRecordering]]),Jt(Et("i",Wn,null,512),[[Qt,1==It(l).isComplete]]),zt(" "+Wt(It(l).btnExportLabel),1)],32),Et("div",{class:"btn2 center",onMouseup:f},"取消",32)])])]))}}),[["__scopeId","data-v-712465ac"]]);class Gn{}dt(Gn,"paneWidth",1),dt(Gn,"paneHeight",1);const Zn={class:"com__box center"},Hn=(e=>(Rt("data-v-635568f9"),e=e(),Lt(),e))((()=>Et("div",{class:"loading"},[Et("div"),Et("div"),Et("div")],-1))),jn={class:"explain"},Yn=gi(wt({__name:"Mloading2",props:{text:{}},setup(e){const t=e;return(e,i)=>(St(),At("div",Zn,[Hn,Et("h4",jn,Wt(null!=It(t).text?It(t).text:""),1)]))}}),[["__scopeId","data-v-635568f9"]]),Xn={class:"div-left"},Jn={class:"div-right"},Qn=["src"],Kn=gi(wt({__name:"PopupEffectOverEditor",setup(e){let t=Bi.createEventID(),i=!1,a=Ut(),s=Ut();function l(){let e=a.value;e.style.width=Gn.paneWidth+"px",e.style.height=Gn.paneHeight+"px"}$t((()=>{i=!0,gt((()=>{1==i&&(Bi.on(ki.SlotFrameResize,t,l),l(),async function(){let e=s.value;e.style.backgroundImage=`url('${o}')`,e.style.backgroundSize="100% 100%",Hi.initIframe(null,r,n,o)}())}))})),qt((()=>{i=!1,Bi.off(ki.SlotFrameResize,t,l),async function(){}()}));let n=Ut({isLoading:!0,loadingText:"加载中",iframeURL:""}),r=Ut(),o="./cdn/images/player/bg01.jpg";function d(){Hi.reloadMainIframe(),Ar.close()}return(e,t)=>(St(),At("div",{ref_key:"refContainer",ref:a,class:"div-eff-container"},[Et("div",Xn,[zt("左边 "),Et("button",{onMouseup:d},"关闭",32)]),Et("div",Jn,[Et("div",{ref_key:"refIframeContainer",ref:s,class:"iframe-container center"},[1==It(n).isLoading?(St(),Zt(Yn,{key:0,class:"div-loading",text:It(n).loadingText},null,8,["text"])):jt("",!0),Jt(Et("iframe",{ref_key:"refIframe",ref:r,class:"iframe-offscreen display-block-fade",src:It(n).iframeURL,frameborder:"0"},null,8,Qn),[[Qt,1!=It(n).isLoading]])],512)])],512))}}),[["__scopeId","data-v-4bd8b3ba"]]),$n={},qn={class:"com__box"},er=[Kt('<div class="loading" data-v-574b6505><div class="shape shape-1" data-v-574b6505></div><div class="shape shape-2" data-v-574b6505></div><div class="shape shape-3" data-v-574b6505></div><div class="shape shape-4" data-v-574b6505></div></div>',1)];const tr=gi($n,[["render",function(e,t){return St(),At("div",qn,er)}],["__scopeId","data-v-574b6505"]]),ir={class:"div-container"},ar={class:"div-icon"},sr=(e=>(Rt("data-v-b2f44308"),e=e(),Lt(),e))((()=>Et("div",{class:"div-text"},"歌词识别中...",-1))),lr=["onMouseup"],nr=gi(wt({__name:"PopupAudioToLyrics",setup(e){function t(){Gi.sendIPC("AudioToLyricsCancel"),Ar.close()}return(e,i)=>(St(),At("div",ir,[Et("div",ar,[Gt(tr,{class:"loading"})]),sr,Et("div",{class:"div-button button",onMouseup:Yt(t,["stop"])},"取消",40,lr)]))}}),[["__scopeId","data-v-b2f44308"]]),rr=e=>(Rt("data-v-0e580bb2"),e=e(),Lt(),e),or={class:"div1"},dr={class:"div-layer"},cr=rr((()=>Et("br",null,null,-1))),ur={class:"div-text-number"},hr=rr((()=>Et("div",{class:"div-help"}," 建议 ",-1))),mr={class:"div-number"},pr={class:"div2"},gr={class:"btn1"},fr=["onMouseup"],vr=["onMouseup"],yr=["onMouseup"],Tr=rr((()=>Et("input",{divname:"check",type:"checkbox",id:"checkbox-sub-ck",checked:""},null,-1))),wr=rr((()=>Et("label",{for:"checkbox-sub-ck"},"保留标点",-1))),br={class:"btn2"},kr=["onMouseup"],Cr=["onMouseup"],Mr=gi(wt({__name:"PopupInputDocMatch",setup(e){let t=Ut(),i=Ut(),a=Ut(),s=Ut();Bi.createEventID();function l(){n()}function n(){let e=i.value,t=a.value;if(t){let i=t.innerText,a="",l=i.split("\n");for(let e=0;e<l.length;e++)a+=e+"<br>";e.innerHTML=a,s.value=i.replaceAll("\n","").length}}function r(){let e=i.value,t=a.value;t&&(e.scrollTop=t.scrollTop)}function o(){let e=a.value;e.innerText=e.innerText,n()}function d(){let e=a.value,t=e.innerText;null!=t&&""!=t&&(navigator.clipboard.writeText(t),e.innerText="",n())}async function c(){let e=await navigator.clipboard.readText();if(null!=e){a.value.innerText=e,n()}}function u(){let e=a.value,i=e.innerText,s=/(？|！|。|;|，|!|\?|,|\.|；)/gim,l=/(？|！|。|;|，|!|\?|,|\.|；)(.+)/gim,r=i.match(l),o=1e4,d=t.value.querySelector('[divname="check"]'),c=null==d?void 0:d.checked;for(;null!=r&&r.length>0&&o>0;)i=i.replace(l,"$1\n$2"),r=i.match(l),o--;1!=c&&(i=i.replace(s,"")),e.innerText=i,n()}function h(){}function m(){Ar.close()}return $t((()=>{})),qt((()=>{})),(e,n)=>(St(),At("div",{ref_key:"vuedom",ref:t,class:"div-container"},[Et("div",or,[Et("div",dr,[Et("div",{ref_key:"refLine",ref:i,class:"div-text-line"},[zt("00"),cr,zt("01")],512),Et("div",{ref_key:"refInput",ref:a,class:"div-text-input",placeholder:"在这里输入文稿内容",onInput:l,onScroll:r,contenteditable:"true",onBlur:o,spellcheck:"false"},null,544)]),Et("div",ur,[hr,Et("div",mr,[zt(" 字数："),Et("span",null,Wt(It(s)),1),zt("/5000 ")])])]),Et("div",pr,[Et("div",gr,[Et("div",{class:"div-button button",onMouseup:Yt(d,["stop"])},"清空内容",40,fr),Et("div",{class:"div-button button",onMouseup:Yt(c,["stop"])},"剪切板粘贴",40,vr),Et("div",{class:"div-button button",onMouseup:Yt(u,["stop"])},"格式化文稿",40,yr),Tr,wr]),Et("div",br,[Et("div",{class:"div-button button submit",onMouseup:Yt(h,["stop"])},"开始匹配",40,kr),Et("div",{class:"div-button button",onMouseup:Yt(m,["stop"])},"取消",40,Cr)])])],512))}}),[["__scopeId","data-v-0e580bb2"]]);var xr=(e=>(e.PopupExport="PopupExport",e.PopupEffectOverEditor="PopupEffectOverEditor",e.PopupAudioToLyrics="PopupAudioToLyrics",e.PopupInputDocMatch="PopupInputDocMatch",e))(xr||{});class Ar{static initPopup(){1!=this.popup.inited&&(this.popup.inited=!0,this.addPopup("PopupExport","导出您的视频",zn),this.addPopup("PopupEffectOverEditor","编辑转场效果",Kn),this.addPopup("PopupAudioToLyrics",null,nr),this.addPopup("PopupInputDocMatch","音频字幕与文稿匹配",Mr))}static addPopup(e,t,i){this.popup.currenTab[e]={title:t,component:Pt(i)}}static open(e,t){this.initPopup();let i=this.popup.currenTab[e];null!=i&&(this.current.name=e,this.current.data={data:t,current:this.current},this.current.title=i.title,this.current.component=i.component)}static isOpen(e){let t=this.popup.currenTab[e];return null!=t&&null!=this.current.component&&this.current.component==t.component}static close(e){null!=e&&this.current.name!=e||(this.current.name=null,this.current.component=null,this.current.data=null,this.current.title="")}}dt(Ar,"popup",{inited:!1,currenTab:{}}),dt(Ar,"current",Tt({component:null,data:null,title:"",fadeIn:"0.2s",name:null}));const Ir=e=>(Rt("data-v-85352e10"),e=e(),Lt(),e),Sr={class:"win-traffic-light-btn"},Rr=[Ir((()=>Et("svg",{viewBox:"0 0 32 32",xmlns:"http://www.w3.org/2000/svg"},[Et("g",{id:"cross"},[Et("line",{class:"cls-1",x1:"7",x2:"25",y1:"7",y2:"25"}),Et("line",{class:"cls-1",x1:"7",x2:"25",y1:"25",y2:"7"})])],-1)))],Lr=[Ir((()=>Et("svg",{viewBox:"0 0 256 256","xml:space":"preserve",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},[Et("path",{d:"M208,134.4H48c-3.534,0-6.4-2.866-6.4-6.4s2.866-6.4,6.4-6.4h160c3.534,0,6.4,2.866,6.4,6.4S211.534,134.4,208,134.4z"})],-1)))],Er=[Kt('<svg width="7" height="7" viewBox="0 0 25 24" xmlns="http://www.w3.org/2000/svg" data-v-85352e10><g id="Layer_2" data-name="Layer 2" data-v-85352e10><g id="Layer_1-2" data-name="Layer 1" data-v-85352e10><path class="cls-1" d="M2,18V2H18" data-v-85352e10></path><path class="cls-1" d="M23,6V22H7" data-v-85352e10></path></g></g></svg>',1)],Pr=gi(wt({__name:"WinCloseBar",setup(e){function t(){Gi.sendIPC("app-quit")}function i(){Gi.sendIPC("app-min")}function a(){Gi.sendIPC("app-max")}return(e,s)=>(St(),At("div",Sr,[Et("div",{onClick:t,class:"ctl-btn close-btn"},Rr),Et("div",{onClick:i,class:"ctl-btn min-btn"},Lr),Et("div",{onClick:a,class:"ctl-btn max-btn"},Er)]))}}),[["__scopeId","data-v-85352e10"]]);class _r{static encodeWav(e){var t=e.numberOfChannels;if(null==e||0==e.length)return new Blob([],{type:"audio/wav"});if(1!==t&&2!==t)throw new Error("Expecting mono or stereo audioBuffer");var i=e.length,a=new ArrayBuffer(this.HEADER_LENGTH+2*i*t),s=new Int16Array(a),l=new Uint8Array(a),n=e.sampleRate,r=i*t*2,o=r+36,d=n*t*2;l.set([82,73,70,70,255&o,o>>8&255,o>>16&255,o>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,t,0,255&n,n>>8&255,n>>16&255,n>>24&255,255&d,d>>8&255,d>>16&255,d>>24&255,4,0,16,0,100,97,116,97,255&r,r>>8&255,r>>16&255,r>>24&255]);for(var c=[],u=0;u<t;u++)c.push(e.getChannelData(u));for(var h=0,m=this.HEADER_LENGTH/2;h<i;h++)for(u=0;u<t;u++){var p=c[u][h];p=Math.min(1,Math.max(-1,p)),p=Math.round(p*this.MAX_AMPLITUDE),s[m++]=p}return new Blob([l],{type:"audio/wav"})}static encodeWavBase64URL(e){return new Promise(((t,i)=>{let a=this.encodeWav(e);var s=new FileReader;s.onload=function(e){let i=e.target.result;t(i)},s.readAsDataURL(a)}))}}dt(_r,"HEADER_LENGTH",44),dt(_r,"MAX_AMPLITUDE",32767);const Dr=e=>(Rt("data-v-2983eb56"),e=e(),Lt(),e),Fr={class:"divbody"},Nr={class:"c1"},Ur=Dr((()=>Et("div",{class:"logo"},null,-1))),Or=Dr((()=>Et("i",{class:"gg-arrow-down-o"},null,-1))),Vr={class:"menu-content"},Br=Dr((()=>Et("i",{class:"gg-chevron-right"},null,-1))),Wr={class:"menu-child"},zr=Dr((()=>Et("i",{class:"gg-chevron-right"},null,-1))),Gr={class:"menu-child"},Zr=Dr((()=>Et("i",{class:"gg-chevron-right"},null,-1))),Hr={class:"menu-child"},jr=Dr((()=>Et("i",{class:"gg-chevron-right"},null,-1))),Yr={class:"menu-child"},Xr=Dr((()=>Et("i",{class:"gg-chevron-right"},null,-1))),Jr={class:"menu-child"},Qr=Dr((()=>Et("div",{class:"c2"},"↗版本：v1.0.2023.04.20 (已是最新版啦)↖",-1))),Kr={class:"c3"},$r=["value"],qr=gi(wt({__name:"HeaderMain",setup(e){let t=Bi.createEventID();const{proxy:i}=ii(),a=Tt({lang_icon:""}),s=[{value:"zh",label:"简体中文",icon:new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAQCAYAAAAMJL+VAAACQklEQVQ4jZWUu24TQRSGv5mdvThOnDiKDQEFpUGCDiEhOiSgp6OgoUPUvAE1z8ALJDVdKupAgSBKE0WggERCwMHxbb27M2hmcbz4lnCa3bmc83/nzJkRO49vVUSr+RQpnwHrQMosM2C0QAgDcuI+AXjALvBKAS+Al2PbTGH7yLxXyjCpwGRifH1od4HXluH5pODGCMyIt0kE4VpM/ckRwWrfjc+xqhWo/kNtcurgch+1lDrSYjbC1+iORPclWstzReRZzUUePGt7yChj6d4J/nJC2lCu5nlwQ2+/xOFGneTId+vReuzm0ZMFVJHeryVE5Rj/SszC7Sa6KzH9PHj/e5BnY0Hs1zcs3mkSXov5sblCmihEaKYL2AMTgaH6sEF0vYuqGKoPfjN3o0Nja5n4IByWSRnXRfHXkOSnIut4zndaiXI/aegdRDTeLuadsgKyrDndXqD1oXxWpoGIHbd35mhuV/Iok1u2UCLrFAv0qcJ0Ja3tAFVJwAhXqrH0Bch57bKx52YBZwto8MoZfq3Pr60qzXcVyjfbqJUUr5KhewVEk3tW758QrMYcblwia9rm0MOOGxP469/ZK2ES6Q609XEe4RnnZEkHIDqReCKj9yUiOVFubrBvegYDuDhXcg7WssJttlnOa0prXXqfI1qfyg5MenoIMGLjxyNGnofCvyUPrsbUHh0T1mNHLJWe9VyMZzDLZKiJvwUcbtZJjxXSn3K7Cmbp3/+PiG55dPdKrnOmteaogH1J9y+eBjn5BYIDb/4AfD/k17sb48sAAAAASUVORK5CYII=",self.location).href},{value:"en",label:"English",icon:new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAQCAYAAAAMJL+VAAAEb0lEQVQ4jW2TeWwUZRjGf9/M7NlZSi9BqD2WUqCSEkotiUBAEpSWSEVCiRpB/tEYYxTRBBEIEBMQIhpEKmeVIhBDIjU1pTUBEQJYKS2H3FAuuy1Hj91u2925zE5bosD7z5f5vpnf+7zP94yoGzd5wNBPPlg0aO6s+UDCT4ev6Mu2H+XylRawYNTooVSteRVP+Q6ubypDjvMiLIv8nd9QHk5iwdJ9GJ1RnIMSKHkxhyWZllA2fyu3Xb95MXPF4nXKU6P8H7dsKF2mB4MMfn0OJZOHM9qfzNrdteyuqCcUjvLEEoKIpmN06wzLzWRRYRbFd07SunQXWtozDN+0viBh8oQt8tS123/Mchu+1rJy2k+expWZRuqIDGZMzCI5WeVBWKOoIAPX2Qba/mpAcjqQsBhSXMjfSiIur5N1+W6eryqn5ZcqBrxWgn/lYuJyRtJ4N+iRq4L5n3fkFyh5k3IRfxwmsGcflqYT789gfJ6fibmpJHjdRGr/JHTqDMLhAMsivmg66cOGMOFUDd4dm+kwZVJXLefpeXMx4rxUHr/G++t+Q8pOH6gfPd/M3sTReEo3kVryCh3HarlbcxB0HX+KSqLqwECywcK2S2B6PCQG7yNdvoRjZjHZZd+ROHVS7Nqoqf+HzdWXMNwuxL0HwZBhWGpnRCfZ58DnVNDbg1iahuRTEZJk+x3Y+j1NpWVIqtdukvX1GnwFeRidYWRVBcPAMk27QSCsYyKIcyuIW+8tDAmBGlMV0QwMBMLptJNiaFE7SfaF3rpDNNCMkGV7Ek+2HyUpGSEElq7Z8N7ZwO2QkWL7sYmPDxsbglgDm9NbVt/a/wxIHg+S22XDY2WEw1hR/bH3+r/vRyiy1/3kGD5SQpEfwu2GTieWrDwOf6QUz+CUhzumaWH2MexpYv7HBBkmZk8PZjSK6DtX4uMRLod9ZveQpT6IhSQs2zqbY95oDFmmpXZFdSzTQu5TKXlcICtYuo4VjdL8wx7u7a9EdrtjSkhbvBDfc3lYUa1XjCwjuVy279FIFJcETqeCsvJEO+GIRnZ6Ei+Pz2Cwu1dJ97UbtFXX4MsYim/6SzgGpYCmg8uyhbgz0vFk+XtFd3XTWn0QvTmAtyCf86kjOXDyNj1t95FWflEp1dU3MirFQ5JLwoxECOzYxaW589EqKmgP9tClmQhNA0n0h8r+R7otMCyQ3E5kNY57NYe4+uY7DNxWihpqpbz6IspXnxUxrzCXRK9C+Mw5bq7fhHXiBOklxRwrKGR/i+DTtm7UGPzh/QhU1cnPDU3UNTTy0exxJE+bwoCxudzeUkbH7r0sKLhA3ow5SB/OzqtLEBpN23ZydcG7DGy+TdLqVZSOmcVbZef4teY0Md1C+n9cJEXifnsXq7ccoWR5Bb+fbUJOTiRjySLSNq4n0NxG2vYNKNFAy4qbq7/c2ll7yq9OfYH6SUVsPBPiwKGD0NZJTl46Up81/4m5nRav24HsdnDoyFUu3Grl7ZljeGNaDtlTJhD37AiaNm6t/BfJDtHncucgdQAAAABJRU5ErkJggg==",self.location).href}];let l=localStorage.getItem("lang")||"zh",n=!1,r=Ut(null),o=Ut(),d=Tt({logotext:["→ 简单又好用，全能在线音视频剪辑神器！","→ 使用领先的AI技术，让每个人都能轻松创作！"]});const{t:c}=ei();kt((()=>{Bi.on(ki.mouseup,t,v),b(),null!=p&&(clearTimeout(p),p=null),f()})),Ct((()=>{Bi.clearAll(t)}));let u=0,h=u,m=!1,p=null,g=0;function f(){let e=d.logotext[g],t=10;u<t?(t=u,h=0):h+=1;let i=u;0==m&&(i=e.length-u-1);let a=e.substring(i,i+t)||"";a="<font color = '#FFFFFF'>"+a+"</font>";let s=e.substring(0,i)||"",l=e.substring(i+t,e.length)||"";o.value.innerHTML=s+a+l,u++,h>=e.length?(u=0,m=!m,1==m?p=setTimeout(f,100):(g++,g>=d.logotext.length&&(g=0),p=setTimeout((()=>{o.value.innerHTML=d.logotext[g],p=setTimeout(f,500)}),5e3))):p=1==m?setTimeout(f,30):setTimeout(f,10)}function v(e){y(null)}function y(e){e&&e.stopPropagation();let t=r.value.style;null==e||n?(n=!1,t.display="none"):(n=!0,t.display="block")}function T(e){e.target.innerText}const w=e=>{let t=e.target.value;i.$i18n.locale=t,localStorage.setItem("lang",t),b()},b=()=>{for(let e=0;e<s.length;e++){const t=s[e];if(t.value==l){a.lang_icon=t.icon;break}}};function k(){Ar.open(xr.PopupExport)}return(e,t)=>(St(),At("div",Fr,[Et("div",Nr,[Ur,Et("div",{ref_key:"logoText",ref:o,class:"logo-text"},null,512),Et("div",{class:"menu no-drag",onClick:y},[Et("div",null,Wt(e.$t("LangHeaderMain.Menu")),1),Or]),Et("div",{ref_key:"ref_menu_list",ref:r,class:"menu-list"},[Et("div",Vr,[Et("li",null,[zt(Wt(e.$t("LangHeaderMain.File")),1),Br,Et("ul",Wr,[Et("li",{onClick:T},Wt(e.$t("LangHeaderMain.NewDraft")),1),Et("li",{onClick:T},Wt(e.$t("LangHeaderMain.Import")),1),Et("li",{onClick:T},Wt(e.$t("LangHeaderMain.Export")),1)])]),Et("li",null,[zt(Wt(e.$t("LangHeaderMain.Edit")),1),zr,Et("ul",Gr,[Et("li",{onClick:T},Wt(e.$t("LangHeaderMain.Revocation")),1),Et("li",{onClick:T},Wt(e.$t("LangHeaderMain.Recovery")),1)])]),Et("li",null,[zt(Wt(e.$t("LangHeaderMain.LayoutStyle")),1),Zr,Et("ul",Hr,[Et("li",{onClick:T},Wt(e.$t("LangHeaderMain.DefaultLayout")),1),Et("li",{onClick:T},Wt(e.$t("LangHeaderMain.MediaMaterialPriority")),1),Et("li",{onClick:T},Wt(e.$t("LangHeaderMain.PlayerPriority")),1),Et("li",{onClick:T},Wt(e.$t("LangHeaderMain.AttributeAdjustmentPriority")),1),Et("li",{onClick:T},Wt(e.$t("LangHeaderMain.TimelinePriority")),1)])]),Et("li",null,[zt(Wt(e.$t("LangHeaderMain.More")),1),jr,Et("ul",Yr,[Et("li",{onClick:T},Wt(e.$t("LangHeaderMain.Environmental")),1),Et("li",{onClick:T},Wt(e.$t("LangHeaderMain.VersionNumber")),1)])]),Et("li",null,[zt(Wt(e.$t("LangHeaderMain.Help")),1),Xr,Et("ul",Jr,[Et("li",{onClick:T},Wt(e.$t("LangHeaderMain.HelpCenter")),1),Et("li",{onClick:T},Wt(e.$t("LangHeaderMain.Feedback")),1),Et("li",{onClick:T},Wt(e.$t("LangHeaderMain.Shortcuts")),1),Et("li",{onClick:T},Wt(e.$t("LangHeaderMain.About")),1)])]),Et("li",{onClick:T},Wt(e.$t("LangHeaderMain.GlobalSettings")),1),Et("li",{onClick:T},Wt(e.$t("LangHeaderMain.BacktoHome")),1),Et("li",{onClick:T},Wt(e.$t("LangHeaderMain.Exit")),1)])],512)]),Qr,Et("div",Kr,[Et("div",{class:"export no-drag color1",onMouseup:k},"导出视频",32),Et("div",{class:"lang-icon",style:Xt({backgroundImage:"url("+a.lang_icon+")"})},null,4),Jt(Et("select",{class:"lang-select no-drag","onUpdate:modelValue":t[0]||(t[0]=e=>_t(l)?l.value=e:l=e),onChange:w},[(St(),At(Ot,null,Vt(s,(e=>Et("option",{key:e.value,value:e.value},Wt(e.label),9,$r))),64))],544),[[ti,It(l)]]),It(Gi).isTypeSupportedIpc()?(St(),Zt(Pr,{key:0})):jt("",!0)])]))}}),[["__scopeId","data-v-2983eb56"]]),eo={class:"peview-audio-container opacity-fade-in"},to={class:"audio-bg-container"},io=(e=>(Rt("data-v-4f4c1cc1"),e=e(),Lt(),e))((()=>Et("div",{class:"audio-thumbnail-cover"},null,-1))),ao={class:"div-lrc left"},so={class:"lrc-content"},lo=["data-lrc"],no=["data-lrc"],ro={class:"div-lrc right"},oo={class:"lrc-content"},co=["data-lrc"],uo=["data-lrc"],ho={style:{display:"none"}},mo=["src"],po=gi(wt({__name:"PeviewAudioPlayer",props:{mediafile:{default:null}},setup(e){const t=e;let i=Bi.createEventID(),a=Ut(),s=Ut(),l=Ut(),n=!1,r=Ut({mediaFile:null,audioPath:null,lrcA:"",lrcB:""}),o=xt((()=>{if(r&&r.value){let e=r.value.mediaFile;if(null!=e)return`background-image: url("${e.thumbnail}");`}return""})),d=xt((()=>{let e=r.value.mediaFile;return e?e.type:Qi.NULL}));kt((()=>{n=!0,Bi.on(ki.PeviewPlayerSetProcess,i,m),Bi.on(ki.PeviewPlayerPlaying,i,T)})),Ct((()=>{n=!1,r.value.mediaFile=null,r.value.audioPath=null,Bi.off(ki.PeviewPlayerSetProcess,i,m),Bi.off(ki.PeviewPlayerPlaying,i,T),Ui.timer.removeRenderFrame(i,u)}));let c=xt((()=>{let e=t.mediafile;return null!=e&&e.type==Qi.Audio?(r.value.mediaFile=e,r.value.audioPath=e.path,h(),null!=e.lrcParse&&Ui.timer.addRenderFrame(1e3/60,i,u)):(r.value.mediaFile=null,r.value.audioPath=null,h(),Ui.timer.removeRenderFrame(i,u)),r.value.audioPath}));function u(){let e=a.value;if(null==e)return;let t=r.value.mediaFile;if(null==t||null==t.lrcParse)return;let i=t.lrcParse.getPlayTimeLyric(e.currentTime);if(null!=i&&1==i.update)if(i.line%2==0){r.value.lrcA=i.lyric,s.value.style.width=i.processStr,r.value.lrcB=i.lyricNext,l.value.style.width="0%"}else{r.value.lrcA=i.lyricNext,s.value.style.width="0%",r.value.lrcB=i.lyric,l.value.style.width=i.processStr}else h()}function h(){r.value.lrcA="",r.value.lrcB=""}function m(e){if(null==r.value.mediaFile)return;let t=a.value;t&&(t.currentTime=Math.round(e/100*t.duration))}function p(e){let t=e.target;null!=r.value.mediaFile&&(Bi.cheackMounted(n),f(t))}function g(e){let t=e.target;null!=r.value.mediaFile&&(Bi.cheackMounted(n),f(t))}function f(e){let t={type:Ll.PeviewAudio,currentTime:e.currentTime,duration:e.duration};Bi.send(ki.PeviewPlayTimeupdate,t)}function v(e){e.target,null!=r.value.mediaFile&&(Bi.cheackMounted(n),Bi.send(ki.PeviewPlayerStateUpdate,!0,t.mediafile))}function y(e){e.target,null!=r.value.mediaFile&&(Bi.cheackMounted(n),Bi.send(ki.PeviewPlayerStateUpdate,!1,t.mediafile))}function T(){if(null==r.value.mediaFile)return;let e=a.value;1!=e.paused?e.pause():e.play()}return(e,t)=>Jt((St(),At("div",eo,[Et("div",to,[Et("div",{class:"audio-bg",style:Xt(It(o))},null,4),Et("div",{class:"audio-thumbnail",style:Xt(It(o))},null,4),io,Et("div",ao,[Et("div",so,[Et("div",{class:"audio-lrc lrc-a","data-lrc":It(r).lrcA},Wt(It(r).lrcA),9,lo),Et("div",{ref_key:"refLrcA",ref:s,class:"audio-lrc lrc-b","data-lrc":It(r).lrcA},Wt(It(r).lrcA),9,no)])]),Et("div",ro,[Et("div",oo,[Et("div",{class:"audio-lrc lrc-a","data-lrc":It(r).lrcB},Wt(It(r).lrcB),9,co),Et("div",{ref_key:"refLrcB",ref:l,class:"audio-lrc lrc-b","data-lrc":It(r).lrcB},Wt(It(r).lrcB),9,uo)])])]),Et("div",ho,[Et("audio",{ref_key:"webAudio",ref:a,controls:"",src:It(c),onTimeupdate:p,onDurationchange:g,onPlay:v,onPause:y,autoplay:"true"},null,40,mo)])],512)),[[Qt,It(d)==It(Qi).Audio]])}}),[["__scopeId","data-v-4f4c1cc1"]]),go=["src"],fo=gi(wt({__name:"PeviewIframe",setup(e){Bi.createEventID();let t=Ut({isLoading:!0,loadingText:"加载中",iframeURL:""}),i=Ut(),a=Ut(),s="./cdn/images/player/bg01.jpg";return kt((()=>{let e=i.value;e.style.backgroundImage=`url('${s}')`,e.style.backgroundSize="100% 100%",Hi.initIframe(Hi.MainIframeKey,a,t,s)})),Ct((()=>{})),(e,s)=>(St(),At("div",{ref_key:"refIframeContainer",ref:i,class:"iframe-container center"},[1==It(t).isLoading?(St(),Zt(Yn,{key:0,class:"div-loading",text:It(t).loadingText},null,8,["text"])):jt("",!0),Jt(Et("iframe",{ref_key:"refIframe",ref:a,class:"iframe-offscreen display-block-fade",src:It(t).iframeURL,frameborder:"0"},null,8,go),[[Qt,1!=It(t).isLoading]])],512))}}),[["__scopeId","data-v-218b9829"]]),vo=(e=>(Rt("data-v-cbc553fe"),e=e(),Lt(),e))((()=>Et("div",{class:"render-bg"},null,-1))),yo={class:"render-canvas"},To=gi(wt({__name:"PeviewRenderPlayer",props:{mediafile:{}},setup(e){const t=e;let i=Bi.createEventID(),a=Ut(),s=Ut({renderSize:""}),l=9/16,n=l,r=null,o=xt((()=>{let e=t.mediafile;return e?e.type:Qi.NULL}));kt((()=>{Rs.high.canvas=function(){let e="highCanvas",t=document.getElementById(e);null==t&&(t=document.createElement("canvas"),t.id=e,t.width=1920,t.height=1080);return t}(),Rs.high.ctx=Rs.high.canvas.getContext("2d"),Rs.initRecorder(),Bi.on(ki.SlotFrameResize,i,c),Bi.on(ki.RenderRateSetting,i,u),Bi.on(ki.PeviewPlayTimeupdate,i,h),c()})),Ct((()=>{Bi.clearAll(i)}));let d=xt((()=>{if(r&&0==r.index){let e=t.mediafile;e&&(n=e.sourceHeight/e.sourceHeight)}return""}));function c(){if(null==a.value)return;let e=a.value.getBoundingClientRect();if(0==e.width||0==e.height)return;let i=e.width-5,l=e.height-5,o=0,d=0;if(r&&0==r.index){let e=t.mediafile;e&&(n=e.sourceHeight/e.sourceHeight)}o=Math.floor(i/1),d=Math.floor(i*n),d>=l&&(d=l/1,o=l/n),s.value.renderSize=`width:${o}px;height:${d}px;`}function u(e){n=null!=e&&1==e.type?e.value:l,r=e,c()}function h(e){let t=e.type,i=e.currentTime,a=e.duration,s=e.isRealtTime;t==Ll.PeviewMovieClip&&function(e,t,i){let a=Hi.mainCanvas;if(null==a)return;let s=Rs.isRecordering,l=!1;Rs.recorder.state!=ji.ready&&Rs.recorder.state!=ji.recording||(l=!0,Rs.high.canvas=a,Rs.recorder.setCanvas(a));if(Rs.recorderProgress=e/t*100,1==l){let t=a,i=Rs.preview.canvas,s=Rs.preview.ctx;if(null!=i){if(Rs.recorder.state==ji.ready){let e=0,a=0;t.width>t.height?(e=i.width,a=e/t.width*t.height):(a=i.height,e=a/t.height*t.width);let s=Rs.preview.viewWidth,l=Rs.preview.viewHeight;e>s&&(a*=s/e,e=s),a>l&&(e*=l/a,a=l),i.width=e,i.height=a}s.clearRect(0,0,i.width,i.height),s.drawImage(t,0,0,i.width,i.height);let a="预览";s.font="italic 15pt Calibri",s.lineWidth=2,s.strokeStyle="#000000",s.strokeText(a,20,30),s.fillStyle="#FFFFFF",s.fillText(a,20,30);let l=Rs.recorder.getEncodeQueueSize();l<0&&(l=0),l<10&&(l="0"+l),Rs.fpsState.updateRealtime();let n=Rs.fpsState.count;n<10&&(n="0"+n);let r=i.width-60,o=Vi.formatMillisTime(1e3*e,!0,!0);s.font="italic 15pt Calibri",s.strokeStyle="#000000",s.strokeText(o,r-50,30),s.fillStyle="#FFFFFF",s.fillText(o,r-50,30),s.stroke(),a=`${l} ${n}`,s.font="italic 15pt Calibri",s.lineWidth=2,s.strokeStyle="#000000",s.strokeText(a,r,55),s.fillStyle="#FFFFFF",s.fillText(a,r,55),s.stroke()}}s&&i&&Rs.onRenderFrameCanvas(e,t)}(i,a,s)}return(e,t)=>(St(),At(Ot,null,[Jt(Et("div",{ref_key:"renderContainer",ref:a,class:"peview-render-container"},[Et("div",{class:"render-content",style:Xt(It(s).renderSize)},[vo,Et("div",yo,[Gt(fo)])],4)],512),[[Qt,It(o)==It(Qi).NULL]]),zt(Wt(It(d)),1)],64))}}),[["__scopeId","data-v-cbc553fe"]]),wo=e=>(Rt("data-v-ecbde3b7"),e=e(),Lt(),e),bo={class:"peview-player-container"},ko=wo((()=>Et("div",{class:"play-progress-bg"},null,-1))),Co={class:"peview-player-control"},Mo={class:"peview-player-left"},xo={key:0,class:"gg-play-button-o"},Ao={key:1,class:"gg-play-pause-o"},Io={class:"peview-player-right"},So=[wo((()=>Et("i",{class:"gg-assign"},null,-1)))],Ro={class:"peview-player-rate-btn"},Lo={key:0,class:"peview-player-rate-menu"},Eo=["onMouseup"],Po=[wo((()=>Et("i",{class:"gg-ratio"},null,-1)))],_o=gi(wt({__name:"PeviewPlayerControl",props:{mediafile:{}},setup(e){const t=e;let i=Bi.createEventID(),a=Ut({barWidth:"width: 50%;",btnLeft:"left: 50%;",currentTime:"00:00:00.00",duration:"00:00:00.00",playing:!1,mediaFile:null,controlZoom:!0,controlRate:!0,controlFull:!0,showRateMenu:!1,labelRate:"",recorder:"录制",isRecorder:!1}),s={currentTime:0,duration:0},l=0;kt((()=>{l=0,u(0),Bi.on(ki.media_selected_peview,i,r),Bi.on(ki.PeviewPlayTimeupdate,i,o),Bi.on(ki.PeviewPlayerDurationchange,i,d),Bi.on(ki.PeviewPlayerStateUpdate,i,c),Bi.on(ki.mouseup,i,y)})),Ct((()=>{Bi.clearAll(i)}));let n=Tt([{index:2,type:1,menuLabel:"16:9（西瓜视频）",viewLabel:"16:9",value:9/16,selected:!1},{index:3,type:1,menuLabel:"4:3",viewLabel:"4:3",value:3/4,selected:!1},{index:4,type:1,menuLabel:"2:1",viewLabel:"2:1",value:.5,selected:!1},{index:5,type:1,menuLabel:"9:16（抖音）",viewLabel:"9:16",value:16/9,selected:!1},{index:6,type:1,menuLabel:"3:4",viewLabel:"3:4",value:4/3,selected:!1},{index:7,type:1,menuLabel:"1:1",viewLabel:"1:1",value:1,selected:!1}]);function r(e){l=0,a.value.mediaFile=e,a.value.playing=!1,u(0);let t=!0,i=!0;null!=e?t=!1:(a.value.currentTime=Vi.formatSecondTime(0,!0),a.value.duration=a.value.currentTime),e&&e.type!=Qi.Video&&(i=!1),a.value.controlFull=i,a.value.controlZoom=t,a.value.controlRate=t,Bi.send(ki.PeviewPlayerChangeFile,e)}function o(e){let t=e.currentTime,i=e.duration;l=i,u(Number((t/i*100).toFixed(2))),a.value.currentTime=Vi.formatMillisTime(1e3*t,!0,!0),a.value.duration=Vi.formatMillisTime(1e3*i,!0,!0),s.currentTime=t,s.duration=i}function d(e,t){l=t,u(Number((e/t*100).toFixed(2))),a.value.currentTime=Vi.formatMillisTime(1e3*e,!0,!0),a.value.duration=Vi.formatMillisTime(1e3*t,!0,!0),s.currentTime=e,s.duration=t}function c(e){a.value.playing=e}function u(e){e<0&&(e=0),e>100&&(e=100),a.value.barWidth=`width: ${e}%;`,a.value.btnLeft=`left:calc(${e}% - 4px); `}v(null,n[0]);let h=Ut();function m(e){if(e.stopPropagation(),e.preventDefault(),l>0){let i=h.value.getBoundingClientRect(),a=Math.round(e.layerX/i.width*100);a=Math.min(100,Math.max(0,a)),function(e){Bi.send(ki.PeviewPlayerSetProcess,e,t.mediafile)}(a)}}function p(){s.duration<=0||(s.currentTime>=s.duration&&(s.currentTime=0,Bi.send(ki.GotoTimeline,s.currentTime,!1,!0)),Bi.send(ki.PeviewPlayerPlaying,!a.value.playing,t.mediafile))}function g(){a.value.controlZoom}function f(){1==a.value.controlRate&&(a.value.showRateMenu=!0)}function v(e,t){e&&e.stopPropagation(),a.value.showRateMenu=!1;let i=null;for(let s=0;s<n.length;s++){const e=n[s];e==t?(e.selected=!0,i=e,a.value.labelRate=e.viewLabel):e.selected=!1}Bi.send(ki.RenderRateSetting,i)}function y(){a.value.showRateMenu=!1}function T(){1==a.value.controlFull&&Bi.send(ki.PreviewFullScreen,a.value.mediaFile,s.currentTime,s.duration)}return(e,t)=>(St(),At("div",bo,[Et("div",{ref_key:"peviewPlayerProgress",ref:h,class:"peview-player-progress",onMouseup:m},[ko,Et("div",{class:"play-progress-bar",style:Xt(It(a).barWidth)},null,4),Et("div",{class:"play-progress-btn",style:Xt(It(a).btnLeft)},null,4)],544),Et("div",Co,[Et("div",Mo,[Et("div",null,Wt(It(a).currentTime),1),Et("div",null,Wt(It(a).duration),1)]),Et("div",{class:"peview-player-middle",onMouseup:p},[0==It(a).playing?(St(),At("i",xo)):jt("",!0),1==It(a).playing?(St(),At("i",Ao)):jt("",!0)],32),Et("div",Io,[Et("div",{class:Bt(["peview-player-zoom",It(a).controlZoom?"":"disabled"]),onMouseup:g},So,34),Et("div",{class:Bt(["peview-player-rate",It(a).controlRate?"":"disabled"]),onMouseup:f},[Et("div",Ro,Wt(It(a).labelRate),1),It(a).showRateMenu?(St(),At("div",Lo,[(St(!0),At(Ot,null,Vt(It(n),((e,t)=>(St(),At("div",{key:e.menuLabel,onMouseup:t=>v(t,e)},[Et("i",{style:Xt(e.selected?"visibility:visible;":"visibility:hidden;"),class:"gg-check"},null,4),zt(Wt(e.menuLabel),1)],40,Eo)))),128))])):jt("",!0)],34),Et("div",{class:Bt(["peview-player-full",It(a).controlFull?"":"disabled"]),onMouseup:T},Po,34)])])]))}}),[["__scopeId","data-v-ecbde3b7"]]),Do={key:0,class:"peview-video-root opacity-fade-in"},Fo={class:"video-container"},No=["src"],Uo=gi(wt({__name:"PeviewVideoPlayer",props:{mediafile:{}},setup(e){const t=e;let i=Bi.createEventID(),a=Ut(),s=!1,l=Ut({mediaFile:null,videoPath:null}),n=!1,r=0,o=null,d=xt((()=>{let e=l.value.mediaFile;return e?e.type:Qi.NULL}));function c(){if(null==l.value.mediaFile)return;let e=a.value;1!=e.paused&&e.pause()}function u(e,t){if(null==l.value.mediaFile)return;let i=a.value;1==i.paused&&(i.currentTime=e,i.play())}kt((()=>{s=!0,Bi.on(ki.PeviewPlayerSetProcess,i,m),Bi.on(ki.PeviewPlayerPlaying,i,w),Bi.on(ki.PreviewFullScreen,i,c),Bi.on(ki.PreviewFullScreenExit,i,u)})),Ct((()=>{s=!1,l.value.mediaFile=null,l.value.videoPath=null,Bi.clearAll(i)}));let h=xt((()=>{let e=t.mediafile;return null!=e&&e.type==Qi.Video?(l.value.mediaFile=e,l.value.videoPath=e.path):(l.value.mediaFile=null,l.value.videoPath=null),l.value.videoPath}));function m(e){if(null==l.value.mediaFile)return;let t=a.value;t&&(o=Ui.timer.getTime(),t.currentTime=Math.round(e/100*t.duration))}function p(e){null!=o&&(r=Ui.timer.getTime()-o,o=null)}function g(e){let t=e.target;if(1==n&&t.duration>0)return n=!1,void(t.currentTime=0);null!=l.value.mediaFile&&(Bi.cheackMounted(s),function(e){let t={type:Ll.PeviewVideo,currentTime:e.currentTime,duration:e.duration};Bi.send(ki.PeviewPlayTimeupdate,t)}(t))}function f(e){let t=e.target;null!=l.value.mediaFile&&(Bi.cheackMounted(s),Bi.send(ki.PeviewPlayerDurationchange,t.currentTime,t.duration))}function v(e){e.target,null!=l.value.mediaFile&&(Bi.cheackMounted(s),Bi.send(ki.PeviewPlayerStateUpdate,!0,t.mediafile))}function y(e){e.target,null!=l.value.mediaFile&&(Bi.cheackMounted(s),Bi.send(ki.PeviewPlayerStateUpdate,!1,t.mediafile))}function T(e){let t=e.target;t.duration==1/0?(n=!0,t.currentTime=1e101):n=!1}function w(){if(null==l.value.mediaFile)return;let e=a.value;1!=e.paused?e.pause():e.play()}return(e,t)=>null!=It(h)?Jt((St(),At("div",Do,[Et("div",Fo,[Et("video",{ref_key:"webVideo",ref:a,class:"peview-video-player",src:It(h),autoplay:"true",onTimeupdate:g,onDurationchange:f,onPlay:v,onCanplay:p,onPause:y,onLoadedmetadata:T},null,40,No)])],512)),[[Qt,It(d)==It(Qi).Video]]):jt("",!0)}}),[["__scopeId","data-v-0d079014"]]),Oo={class:"header header-title"},Vo={key:0,class:"gg-play-button"},Bo={class:"div-text"},Wo=(e=>(Rt("data-v-47edfc46"),e=e(),Lt(),e))((()=>Et("div",{class:"line"},null,-1))),zo={class:"peview-media-container"},Go={class:"peview-control-container"},Zo=gi(wt({__name:"MediaPlayer",setup(e){let t=Bi.createEventID(),i=Ut({label:null,mediaFile:null,audioPath:null});xt((()=>{let e=i.value.mediaFile;return e?e.type:Qi.NULL}));let a=xt((()=>{let e="播放器",t=i.value.mediaFile;return null!=t&&(t.type==Qi.Audio?e=`预览音频：${t.label}`:t.type==Qi.Video?e=`预览视频：${t.label} （${t.sourceWidth}x${t.sourceHeight}）`:t.type==Qi.Image&&(e=`预览图像：${t.label} （${t.sourceWidth}x${t.sourceHeight}）`)),e}));function s(e){null!=e?(i.value.mediaFile=e,i.value.audioPath=e.path,i.value.label=e.label):(i.value.mediaFile=null,i.value.audioPath=null,i.value.label=null)}function l(e){Tl.stopEvent(e)}return kt((()=>{Bi.on(ki.media_selected_peview,t,s)})),Ct((()=>{Bi.clearAll(t)})),(e,t)=>(St(),At("div",{class:"divbody",onMouseup:l},[Et("div",Oo,[null!=It(i).mediaFile?(St(),At("i",Vo)):jt("",!0),Et("div",Bo,Wt(It(a)),1)]),Wo,Et("div",zo,[Gt(po,{mediafile:It(i).mediaFile},null,8,["mediafile"]),Gt(Uo,{mediafile:It(i).mediaFile},null,8,["mediafile"]),Gt(To,{mediafile:It(i).mediaFile},null,8,["mediafile"])]),Et("div",Go,[Gt(_o,{mediafile:It(i).mediaFile},null,8,["mediafile"])])],32))}}),[["__scopeId","data-v-47edfc46"]]),Ho=["onKeypress"],jo={key:0,class:"preview-layer"},Yo={class:"audio-bg-container"},Xo={key:1,class:"preview-layer"},Jo=["src"],Qo=gi(wt({__name:"PreviewFullScreen",setup(e){let t=Bi.createEventID(),i=Ut(),a=Ut({mediaFile:null,audioPath:null,videoPath:null,isFullScreen:!1}),s={currentTime:0,duration:0},l=xt((()=>{if(a&&a.value){let e=a.value.mediaFile;if(null!=e)return`background-image: url("${e.thumbnail}");`}return""}));function n(e){let t=e.target;s.currentTime=t.currentTime,s.duration=t.duration}kt((()=>{Bi.on(ki.PreviewFullScreen,t,o)})),Ct((()=>{Bi.clearAll(t)}));let r=[xl.escape];function o(e,s,l){if(Ml.addListener(r,"退出全屏",t,d),a.value.mediaFile=e,null!=e){if(e.type==Qi.Audio)return a.value.audioPath=e.path,void(a.value.isFullScreen=!0);if(e.type==Qi.Video)return a.value.videoPath=e.path,a.value.isFullScreen=!0,void gt((()=>{i.value.currentTime=s}))}a.value.videoPath=null,a.value.audioPath=null}function d(){Ml.removeListener(r,t,d),c()}function c(){a.value.isFullScreen=!1,a.value.videoPath=null,a.value.audioPath=null,Bi.send(ki.PreviewFullScreenExit,s.currentTime,s.duration)}function u(e){0!=a.value.isFullScreen&&e.key}return(e,t)=>It(a).isFullScreen?(St(),At("div",{key:0,class:"preview-full-screen gridsmall",onClick:t[0]||(t[0]=Yt((()=>{}),["stop"])),onMouseup:t[1]||(t[1]=Yt((()=>{}),["stop"])),onKeypress:Yt(u,["self"])},[null!=It(a).audioPath?(St(),At("div",jo,[Et("div",Yo,[Et("div",{class:"audio-bg",style:Xt(It(l))},null,4),Et("div",{class:"audio-thumbnail",style:Xt(It(l))},null,4)])])):jt("",!0),null!=It(a).videoPath?(St(),At("div",Xo,[Et("video",{ref_key:"webVideo",ref:i,class:"peview-video-player",src:It(a).videoPath,autoplay:"true",onTimeupdate:n},null,40,Jo)])):jt("",!0),Et("div",{class:"preview-full-screen-close-btn",onMouseup:c},"退出全屏 [ ESC ]",32)],40,Ho)):jt("",!0)}}),[["__scopeId","data-v-b4549972"]]);var Ko=(e=>(e.gettabid="api/api/gettabid",e.gettabone="api/api/gettabone",e.gettabtwo="api/api/gettabtwo",e.gettabres="api/api/gettabres",e))(Ko||{});const $o=class extends ui{constructor(){super(...arguments),dt(this,"_http",new XMLHttpRequest),dt(this,"_responseType"),dt(this,"_data"),dt(this,"_url")}request(e,t=null,i="get",a="text",s=null){var l=[];if(Array.isArray(s))l=s;else if(Object.keys(s).length>0)for(var n in s)l.push(n),l.push(s[n]);if("get"==i){var r="";if(t instanceof Object)for(var n in t)r+=n+"="+t[n]+"&";r.length>0&&(r=r.substr(0,r.length-1)),t="",e=-1==e.indexOf("?")?e+"?"+r:e+"&"+r}else"post"==i&&t instanceof Object&&(t=JSON.stringify(t));this._responseType=a,this._data=null,this._url=e;var o=this,d=this._http;d.open(i,e,!0);let c=!1;if(l)for(var u=0;u<l.length;u++)d.setRequestHeader(l[u++],l[u]);else window.conch||(t&&"string"!=typeof t?(d.setRequestHeader("Content-Type","application/json"),t instanceof ArrayBuffer||"string"==typeof t||(c=!0)):d.setRequestHeader("Content-Type","application/x-www-form-urlencoded"));let h="arraybuffer"!==a?"text":"arraybuffer";d.responseType=h,d.dataType&&(d.dataType=h),d.onerror=function(e){o._onError(e)},d.onabort=function(e){o._onAbort(e)},d.onprogress=function(e){o._onProgress(e)},d.onload=function(e){o._onLoad(e)},t||(t={}),d.send(c?JSON.stringify(t):t)}_onProgress(e){let t=e.loaded/e.total,i={data:t,progress:t,http:this};e&&e.lengthComputable&&this.send($o.PROGRESS,i)}_onAbort(e){this.error("Request was aborted by user")}_onError(e){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText)}_onLoad(e){var t=this._http,i=void 0!==t.status?t.status:200;200===i||204===i||0===i?this.complete():this.error("["+t.status+"]"+t.statusText+":"+t.responseURL)}error(e){this.clear(),this.send($o.ERROR,{data:e,http:this})}complete(){this.clear();var e=!0;try{"json"===this._responseType?this._data=JSON.parse(this._http.responseText):"xml"===this._responseType||(this._data=this._http.response||this._http.responseText)}catch(i){e=!1,this.error(i.message)}let t={data:this._data instanceof Array?[this._data]:this._data,http:this};e&&this.send($o.COMPLETE,t)}clear(){var e=this._http;e.onerror=e.onabort=e.onprogress=e.onload=null}get url(){return this._url}get data(){return this._data}get http(){return this._http}};let qo=$o;dt(qo,"PROGRESS","progress"),dt(qo,"COMPLETE","complete"),dt(qo,"ERROR","error");const ed=class{static connect(e){ed.url=e}static call(e,...t){return null}static onComplete(e){e.http.off(qo.COMPLETE,this,this.onComplete),e.http.off(qo.ERROR,this,this.onError);let t=e.data+"",i=t.substring(0,1),a=t.substring(t.length-1,t.length);if("{"!=i||"}"!=a){t=t.replace(/<.*?>|(=&gt)/g,""),t=t.replace(/\\n/gim,"\n");let e=/\{"json":([.\n\s\S]*)\}\}/gm,i=t.match(e);i&&1==i.length&&(t=i[0],t=t.replaceAll("\n","\\n"))}var s=this.GetMessage(t);if(null!=s.cmd&&""!=s.cmd&&"undefined"!=s.cmd){this.dispatch.send(s.cmd,s)}}static onError(e){e.http.off(qo.COMPLETE,this,this.onComplete),e.http.off(qo.ERROR,this,this.onError),e.data&&(e.data=e.data.replace(/\\n/gim,"\n")),this.dispatch.send(this.ERROR,e.data)}static on(e,t,i){this.dispatch.on(e,t,i)}static off(e,t,i){this.dispatch.off(e,t,i)}static clearAll(e){this.dispatch.clearAll(e)}static GetMessage(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(i){}var t=e;return e&&e.json&&(t=e.json),t}};let td=ed;dt(td,"ERROR","error"),dt(td,"url",null),dt(td,"dispatch",new ui);const id={class:"tab-menu-box"},ad=["namekey","id","onClick","value"],sd=["for"],ld={class:"div-icon display-block-fade"},nd=["id","onClick","value"],rd=["for"],od=gi(wt({__name:"TabbarVertical",props:{MenuListData:{},test:{}},emits:["onMenuSelect"],setup(e,{expose:t,emit:i}){const a=e;let s=Tt({rootIndex:-1,rootLabelSelected:"",childLabelSelected:""}),l=Ut(),n=-1;let r=ai(a).MenuListData.value;function o(e){e?-1!=n&&(l.value.scrollTop=n):n=l.value.scrollTop}kt((()=>{d(0,0,!0,!0)})),$t((()=>{o(!0)})),qt((()=>{}));let d=(e,t,a,l)=>{let n=null,o=null,d=null,c=null;-1==e&&(e=0),null!=r&&e>=0&&e<r.length&&(d=r[e],n=d.label,t<=-1&&d.childs.length>0&&(t=0),t>=0&&t<d.childs.length&&(c=d.childs[t],o=c.label)),s.rootIndex=e,s.rootLabelSelected=n,s.childLabelSelected=o,1==a&&i("onMenuSelect",l?{root:d,child:c}:{root:null,child:null}),null!=d&&(d.selected=l);let u="class-input-"+e,h=document.querySelector(`[namekey="${u}"]`);g(h,d)},c={rootIndex:-1,childIndex:-1},u=(e,t,a)=>{let s=r[t];s.label,c.rootIndex=t,c.childIndex=a;let l=1==s.selected;if(1!=l||0!=s.childs.length)if(-1==a&&(l=!l,s.selected=l),!isNaN(s.gId)&&1!=s.request&&Number(s.gCount)>s.childs.length)i("onMenuSelect",{root:s,child:null});else if(a<=-1&&d(t,a=0,!1,s.selected),1==s.selected){let e=null;a>=0&&a<s.childs.length&&(e=s.childs[a],e.label),i("onMenuSelect",{root:s,child:e})}else i("onMenuSelect",{root:null,child:null})};t({requestRefreshData:()=>{let e=c.rootIndex,t=c.childIndex,i=!0;if(e>=0&&e<=r.length){i=1==r[e].selected}d(e,t,!0,i)}});let h=null,m=null,p=null,g=(e,t)=>{if(null==e||null==t)return;let i=null,a=e.parentNode;if(a&&"tab-menu-item"==a.className){let e=a.getElementsByClassName("tab-menu-content");if(e&&e.length>0){i=e[0].style}}h!=i&&(null!=h&&(h.setProperty("display","none"),h=null),null!=m&&(m.selected=!1,m=null),null!=p&&(p.checked=!1,p=null)),h=i,m=t,p=e,null!=i&&(1==t.selected?(i.setProperty("display","block"),e.checked=!0):(i.setProperty("display","none"),e.checked=!1))};return(e,t)=>(St(),At("div",{ref_key:"refTabContent",ref:l,class:"tab-content",onScroll:t[2]||(t[2]=e=>o(!1))},[Et("div",id,[(St(!0),At(Ot,null,Vt(It(r),((e,i)=>(St(),At("div",{class:"tab-menu-item",key:e.label},[Jt(Et("input",{type:"radio",namekey:"class-input-"+i,id:"menu-item"+i,onClick:e=>It(u)(e,i,-1),value:e.label,"onUpdate:modelValue":t[0]||(t[0]=e=>It(s).rootLabelSelected=e)},null,8,ad),[[si,It(s).rootLabelSelected]]),Et("label",{for:"menu-item"+i},[Et("div",ld,[Jt(Et("i",{class:"gg-play-button",style:Xt(e.childs.length>0||e.gCount>0?"visibility:visible;":"visibility:hidden;")},null,4),[[Qt,1!=e.isLoading]]),1==e.isLoading?(St(),Zt(Sn,{key:0,class:"loading"})):jt("",!0)]),Et("span",null,Wt(e.label),1)],8,sd),Et("div",{class:"tab-menu-content",style:Xt(i==It(s).rootIndex?"display:block":"display:none")},[(St(!0),At(Ot,null,Vt(e.childs,((e,a)=>(St(),At("div",{class:"tab-sub-list",key:e.label},[Jt(Et("input",{type:"radio",id:"menu-item-"+i+"-"+a,name:"child",onClick:e=>It(u)(null,i,a),value:e.label,"onUpdate:modelValue":t[1]||(t[1]=e=>It(s).childLabelSelected=e)},null,8,nd),[[si,It(s).childLabelSelected]]),Et("label",{for:"menu-item-"+i+"-"+a},Wt(e.label),9,rd)])))),128))],4)])))),128))])],544))}}),[["__scopeId","data-v-0d5d8a53"]]),dd={class:"div-container"},cd=(e=>(Rt("data-v-58437d0c"),e=e(),Lt(),e))((()=>Et("i",{class:"gg-gift"},null,-1))),ud=gi(wt({__name:"ComingMore",props:{data:{}},setup:e=>(e,t)=>(St(),At("div",dd,[cd,Et("span",null,Wt(e.data.label?e.data.label+"，":"")+"即将上线，敬请期待",1)]))}),[["__scopeId","data-v-58437d0c"]]),hd={class:"root-content"},md={class:"res-tab"},pd={class:"res-content"},gd=gi(wt({__name:"Sidemenu",props:{data:{}},setup(e,{expose:t}){const i=e;let a,s=Bi.createEventID(),l=Tt({gId:-1,cId:-1,label:"",comName:null}),n=Ut(),r=Pt(ud),o=null,d=null,c=e=>{if(null==e||null==e.root)return;let t=e.root,i=e.child;if(o==t&&d==i)return;if(o=t,d=i,a=t,null==t&&null==i)return void(l.comName=null);if(1==g())return void(l.comName=null);let s=null,n=null,c=-1;null!=i&&(c=i.cId,s=i.label,n=i.comName),null==n&&null!=t&&(n=t.comName,null==s&&(s=t.label)),null!=n?(l.gId=t.gId,l.cId=c,l.label=s,l.comName=n):(l.gId=t.gId,l.cId=c,l.label=s,l.comName=r)},u=null;function h(e){null!=e&&e>=0&&td.call(Ko.gettabone,e)}function m(){td.on(Ko.gettabone,s,p),td.on(Ko.gettabtwo,s,f)}function p(e){if(1==e.success&&Array.isArray(e.data)){let t=e.data;for(let e=0;e<t.length;e++){const a=t[e];for(let e=0;e<i.data.menudata.length;e++){const t=i.data.menudata[e];if(t.label==a.gName){t.gId=Number(a.gId),t.gCount=Number(a.gCount);break}}}}g()}function g(){if(null==a)return!1;if((isNaN(a.gCount)||null==a.gCount)&&(a.gCount=0),a.gCount<=a.childs.length)return!1;if(null==a)return!1;if(1!=a.request&&null!=a.gId){let e=a.gId;return a.isLoading=!0,td.call(Ko.gettabtwo,e),!0}return!1}function f(e){if(null!=a&&1!=a.request){if(a.request=!0,1==e.success&&Array.isArray(e.data)){let t=e.data;for(let e=0;e<t.length;e++){const i=t[e];if(1==i.cEnable&&i.gId==a.gId){let e={gId:Number(i.gId),cId:Number(i.cId),label:i.cName,comName:null};a.childs.push(e)}}}a.isLoading=!1,o=null,d=null,n.value.requestRefreshData()}}return kt((()=>{u=i.data.label,m(),h(i.data.tId)})),$t((()=>{m()})),qt((()=>{td.clearAll(s)})),Ct((()=>{td.clearAll(s)})),t({sendGettabone:h}),(e,t)=>(St(),At("div",hd,[Et("div",md,[Gt(od,{ref_key:"tabbar",ref:n,MenuListData:e.data.menudata,onOnMenuSelect:It(c)},null,8,["MenuListData","onOnMenuSelect"])]),Et("div",pd,[(St(),Zt(li,null,[(St(),Zt(Ht(It(l).comName),{data:It(l),key:It(l).gId},null,8,["data"]))],1024))])]))}}),[["__scopeId","data-v-7f4eae7b"]]);class fd{static gettabres(e,t){this.resCallback=t;let i=this.reslist[e];null==i?(this.reslist[e]={list:[],complete:!1},td.on(Ko.gettabres,this,this.onEasyTabres),td.call(Ko.gettabres,e)):1==i.complete&&this.resCallback(i.list)}static onEasyTabres(e){if(1==e.success&&Array.isArray(e.data.list)){let t=Number(e.data.cId),i=e.data.list;this.reslist[t]={list:i,complete:!0},this.resCallback(i)}}}dt(fd,"reslist",{}),dt(fd,"resCallback");const vd={class:"div-media-container"},yd=(e=>(Rt("data-v-545b6bd9"),e=e(),Lt(),e))((()=>Et("div",{class:"div-search center"},[Et("span",null,"聚合搜索："),Et("input",{type:"text",name:"search",placeholder:"您想找什么音乐？"})],-1))),Td={class:"div-media-content"},wd={class:"div-media-grid-scroll"},bd=["onMouseup"],kd={class:"div-media-time"},Cd=["onMouseup"],Md={class:"div-media-title"},xd=gi(wt({__name:"SubTabAudio",props:{data:{}},setup(e){const t=e;let i,a=Tt([]),s=null,l=Bi.createEventID();function n(e){1==e?(Bi.on(ki.mouseup,l,r),o()):(Bi.clearAll(l),null!=i&&(i(),i=null)),function(e){if(1==e){if(null==i){let e=Mt([()=>t.data.cId],(e=>{a.length=0,o()}));i=e}}else null!=i&&(i(),i=null)}(e)}function r(){null!=u&&(u=null,Bi.send(ki.media_selected_peview,null))}function o(){0==a.length&&fd.gettabres(t.data.cId,d)}function d(e){a.length=0;for(let t=0;t<e.length;t++){const i=e[t];a.push(i)}}kt((()=>{s=t.data.label,n(!0)})),$t((()=>{n(!0)})),qt((()=>{n(!1)})),Ct((()=>{n(!1)}));let c,u,h=e=>null==e?"":null==e.rPicture?Gi.toAssetsURL("./renderer/assets/images/media/type_audio-7347d8fc.jpg"):e.rPicture,m=e=>null==e?"":null==e.rDurationStr?c&&c.label==e.rName?c.durationStr:"":e.rDurationStr,p=e=>e&&null!=e.rPicture?"div-btn-add":"div-btn-download";function g(e){return"./cdn/"+e.rUrl}function f(e){null!=u&&(u.isLoading=!1,u.rPicture=e.thumbnail,u.rDurationStr=e.durationStr,Bi.send(ki.media_selected_peview,c))}return(e,t)=>(St(),At("div",vd,[yd,Et("div",Td,[Et("div",wd,[(St(!0),At(Ot,null,Vt(It(a),((e,t)=>(St(),At("div",{class:"div-media-item",key:e.rId,onMouseup:Yt((t=>async function(e){if(null==e)return"";if(1==e.isLoading)return;Bi.send(ki.media_selected_peview,null),await gt();let t=g(e),i=oa.getFileByMediaUrlPath(t);null==i&&(i=Tt(new ra)),u=e,c=i,u.isLoading=!0,i.type=Qi.Audio,i.thumbnail=e.rPicture,i.label=e.rName,i.setSourceUrl(t),i.parseLrc(e.rJrc||e.rLrc),i.parseSource(f,this),oa.addFile(i)}(e)),["stop"])},[Et("div",{class:"div-media-img",style:Xt({background:"url("+It(h)(e)+")"})},[Et("div",kd,Wt(It(m)(e)),1),Jt(Et("div",{class:Bt(It(p)(e)+" button"),onMouseup:Yt((t=>function(e){if(null==e)return;if(1==e.isLoading)return;let t=g(e),i=oa.getFileByMediaUrlPath(t);null==i&&(i=Tt(new ra)),u=e,c=i,u.isLoading=!0,i.type=Qi.Audio,i.thumbnail=e.rPicture,i.label=e.rName,i.setSourceUrl(t),i.parseLrc(e.rJrc||e.rLrc),oa.addFile(i),null==i.thumbnail?i.parseSource((()=>{e.rPicture=i.thumbnail,e.rDurationStr=i.durationStr,e.isLoading=!1}),this):(e.isLoading=!1,qs.addClipFromMediaFile(i))}(e)),["stop"])},null,42,Cd),[[Qt,1!=e.isLoading]]),Jt(Gt(Sn,{class:"div-loading"},null,512),[[Qt,1==e.isLoading]])],4),Et("div",Md,Wt(e.rName),1)],40,bd)))),128))])])]))}}),[["__scopeId","data-v-545b6bd9"]]);var Ad=(e=>(e.Files="Files",e.ResourceData="ResourceData",e))(Ad||{});class Id{static doDragOver(e,t){let i=e.dataTransfer.types;for(var a=0;a<i.length;++a)if(i[a].toLocaleLowerCase()===t.toLocaleLowerCase())return!0;return!1}static getBasePath(){var e=window.location,t=e.pathname.split("/")[1];return e.protocol+"//"+e.host+"/"+t}}const Sd={class:"container"},Rd={class:"text"},Ld=(e=>(Rt("data-v-87018c35"),e=e(),Lt(),e))((()=>Et("div",{class:"circle"},null,-1))),Ed=gi(wt({__name:"LoadingCircle",props:{progress:{type:Number,default:50},text:{type:String,default:""},alpha:{type:Number,default:.5}},setup(e){const t=e;let i=xt((()=>`--progress-width:${Math.min(100,Math.max(0,t.progress))}%;`)),a=xt((()=>`--progress-alpha:${Math.min(1,Math.max(0,t.alpha))};`)),s=xt((()=>{let e=Math.min(100,Math.max(0,t.progress));return t.progress<=0?"等待处理":t.text+`${e}%`}));return(e,t)=>(St(),At("div",Sd,[Et("div",{class:"progress",style:Xt([It(i),It(a)])},null,4),Et("div",Rd,[Ld,zt(" "+Wt(It(s)),1)])]))}}),[["__scopeId","data-v-87018c35"]]),Pd=e=>(Rt("data-v-2212585a"),e=e(),Lt(),e),_d={key:0,class:"import-content-empty"},Dd=[Pd((()=>Et("div",{class:"import-content-empty-btn"},[Et("div",{class:"import-content-empty-title"},[Et("i",{class:"gg-add"}),zt(" 拖入素材，开始创作 ")]),Et("div",null,"视频mp4，音频mp3，图片png，歌词lrc"),Et("div",null,"（ 支持多个文件直接拖入 ）")],-1)))],Fd=Pd((()=>Et("div",{class:"import-content-btn"},[Et("i",{class:"gg-add",style:{transform:"scale(0.75, 0.75)",margin:"auto 0px auto 5px"}}),zt("导入 ")],-1))),Nd={class:"import-content-header-fun"},Ud=Pd((()=>Et("i",{class:"gg-menu-grid-o",style:{transform:"scale(0.75, 0.75)",margin:"8px 3px auto 6px"}},null,-1))),Od=["onMouseup"],Vd=Pd((()=>Et("i",{class:"gg-feed",style:{transform:"scale(0.65, 0.65)",margin:"9px 13px auto 10px"}},null,-1))),Bd=["onMouseup"],Wd=Pd((()=>Et("i",{class:"gg-size",style:{transform:"scale(0.75, 0.75)",margin:"7px 2px auto 5px"}},null,-1))),zd=["onMouseup"],Gd={key:2,class:"import-content-line"},Zd=["onMouseout"],Hd=["onMousedown"],jd=["onContextmenu"],Yd={class:"import-media-item-time"},Xd=["onMousedown"],Jd={class:"import-media-item-title"},Qd=["onMouseup"],Kd=gi(wt({__name:"SubMediaLocalMedia",setup(e){let t=Bi.createEventID(),i=oa.getFileList(),a=xt((()=>e=>{let t=["import-media-item-img"];return 1==e.selected&&t.push("import-media-item-img-selected"),t})),s=Tt([{type:4,label:"删除",selected:!1,func:function(e){let t=0,a=A;for(let s=0;s<i.length;s++){const e=i[s];for(let i=0;i<a.length;i++){e==a[i]&&(t++,a.splice(i--,1),oa.removeByIndex(s--),e instanceof ra&&oa.removeFile(e),e instanceof ra&&e.release())}}t>0&&ia.showMessageRB({message:`成功从列表移除 ${t} 项内容！`,options:{duration:2,icon:Rn.okGreen}})}},{type:4,label:"打开文件所在位置",selected:!1},{type:4,label:"链接媒体",selected:!1}]);function l(e){Tl.stopEvent(e)}let n=Tt([{type:0,label:"格子布局",selected:!1,className:"import-media-grid"},{type:0,label:"列表布局",selected:!1,className:"media-list-column"}]),r=Ut({className:""}),o=Tt([{type:1,label:"导入时间",selected:!1,func:function(){i.sort(((e,t)=>e.importTime-t.importTime))}},{type:1,label:"创建时间",selected:!1,func:function(){i.sort(((e,t)=>e.creatTime-t.creatTime))}},{type:1,label:"名称",selected:!1,func:function(){i.sort(((e,t)=>e.label.localeCompare(t.label)))}},{type:1,label:"文件类型",selected:!1,func:function(){i.sort(((e,t)=>e.type.localeCompare(t.type)))}},{type:1,label:"时长",selected:!1,func:function(){i.sort(((e,t)=>e.duration-t.duration))}}]);let d=Tt([{type:2,label:"全部",selected:!1,func:c,funcArgs:[null]},{type:2,label:"视频",selected:!1,func:c,funcArgs:[Qi.Video]},{type:2,label:"音频",selected:!1,func:c,funcArgs:[Qi.Audio]},{type:2,label:"图片",selected:!1,func:c,funcArgs:[Qi.Image]}]);function c(e){for(let t=0;t<i.length;t++){const a=i[t];a.isShow=null==e||a.type==e}}let u=Ut({item:null,css:""}),h=Ut();function m(e,t){e&&e.stopPropagation(),null==e||0==e.ctrlKey?S(e,t):function(e){for(let t=0;t<A.length;t++){if(A[t]==e)return}A.push(e),e.selected=!0}(t);let i=h.value,a=i.getBoundingClientRect(),s=i.firstElementChild.getBoundingClientRect(),l=e.pageX-s.left,n=e.pageY-s.top;l>a.width-130&&(l=a.width-130);let r=a.top-s.top+a.height;n>r-105&&(n=r-105);let o=`left: ${l}px;top: ${n}px;`;u.value.item=t,u.value.css=o}function p(e){u.value.item=null}kt((()=>{Bi.on(ki.mouseup,t,k),w(n,0),w(o,0),w(d,0)})),Ct((()=>{Bi.clearAll(t)}));let g=Ut(null),f=Ut(null),v=Ut(null),y=null;function T(e,t){null!=y&&(y.display="none",y=null);let i=null;switch(t){case 0:i=g;break;case 1:i=f;break;case 2:i=v}if(null==i||null==i.value)return;let a=i.value.style;if(a){let t=!0;null!=e&&"block"!=a.display||(t=!1),1==t?(a.display="block",y=a):a.display="none"}}function w(e,t){let i=null;for(let a=0;a<e.length;a++){const s=e[a];a==t?(s.selected=!0,i=s):s.selected=!1}i&&(0==i.type?""!=i.className&&(r.value.className=i.className):1==i.type?null!=i.func&&i.func():2==i.type?null!=i.func&&i.func.apply(null,i.funcArgs):4==i.type&&null!=u.value.item&&(0==t?null!=i.func&&i.func(t):ia.showMessageRB({label:"了解",message:"备注：此能力需要nodejs支持！",options:{duration:2,icon:Rn.warning}}))),C()}let b=xt((()=>(e,t)=>"import-media-grid"==t||null==e.captureImage?e.thumbnail:e.captureImage));function k(e){C(),P()}function C(){M(g,"none"),M(f,"none"),M(v,"none"),u.value.item=null}function M(e,t){if(null==e||null==e.value)return;let i=e.value.style;null!=i&&i.display!=t&&(i.display=t)}let x=null,A=[];function I(e,t){let[i,a]=t.downArgs;null!=a&&S(e,a)}async function S(e,t){if(e&&(e.stopPropagation(),e.preventDefault(),u.value.item=null),null==e||0==e.ctrlKey){if(x==t)return;P(),x=t,A.push(t),t.selected=!0,null!=e&&Bi.send(ki.media_selected_peview,t)}else{for(let e=0;e<A.length;e++){const i=A[e];if(i==t)return void(i.selected=!i.selected)}A.push(t),t.selected=!0,null!=x&&(x=null,null!=e&&Bi.send(ki.media_selected_peview,null))}}function R(e,t){let i=t.sourceTarget;Js.dragProxy.startImage(i);let[a,s]=t.downArgs;if(s instanceof ra){let i=Bs.convertToTrackType(s.type);if(null==i)return;let a=zs.getTempClip();a.type=i,a.time.start=0,a.time.end=1e3*s.duration,a.mediaId=s.mediaId,Js.dragstart(e,t,a,null)}else Js.dragclear()}function L(e,t){Js.dragmove(e,t)}function E(e,t){return Js.dragend(e,t),!0}function P(){for(let e=0;e<A.length;e++){A[e].selected=!1}A.length=0,null!=x&&(x=null,Bi.send(ki.media_selected_peview,null))}Ut([]);const _=e=>{1==Id.doDragOver(e,Ad.Files)?(e.dataTransfer.dropEffect="copy",e.stopPropagation(),e.preventDefault()):e.dataTransfer.dropEffect="none"};return(e,t)=>(St(),At("div",{class:"import-content",onDragenter:t[3]||(t[3]=e=>{return(t=e).stopPropagation(),void t.preventDefault();var t}),onDrop:t[4]||(t[4]=e=>(e=>{e.stopPropagation(),e.preventDefault(),e.dataTransfer.getData("text/plain");let t=e.dataTransfer.files;e.dataTransfer.types;for(let a=0;a<t.length;a++){const e=t[a];if(null==sa.getFileType(e))continue;let s=!1;for(let t=0;t<i.length;t++){const a=i[t];if(a instanceof ra&&a.sourceFile&&a.sourceFile.name==e.name){s=!0;break}}if(s)continue;let l=Tt(new ra);l.sourceFile=e,l.parseSource((()=>{l.duration&&l.type==Qi.Audio&&Vi.formatMillisTime(1e3*l.duration,!0,!0)})),oa.addFile(l)}})(e)),onDragleave:t[5]||(t[5]=e=>{return(t=e).stopPropagation(),void t.preventDefault();var t}),onDragover:t[6]||(t[6]=e=>_(e))},[0==It(i).length?(St(),At("div",_d,Dd)):jt("",!0),It(i).length>0?(St(),At("div",{key:1,class:"import-content-header",onMouseup:l},[Fd,Et("div",Nd,[Et("div",null,[Et("div",{class:"import-content-header-btn",onMouseup:t[0]||(t[0]=e=>T(e,0))},[Ud,zt("排列 ")],32),Et("ul",{ref_key:"ref_menu_layout",ref:g,class:"import-media-menu"},[(St(!0),At(Ot,null,Vt(It(n),((e,t)=>(St(),At("li",{onMouseup:e=>w(It(n),t),key:e.label},[Et("i",{class:"gg-check-o",style:Xt({visibility:e.selected?"visible":"hidden"})},null,4),zt(" "+Wt(e.label),1)],40,Od)))),128))],512)]),Et("div",null,[Et("div",{class:"import-content-header-btn",onMouseup:t[1]||(t[1]=e=>T(e,1))},[Vd,zt("排序 ")],32),Et("ul",{ref_key:"ref_menu_sorts",ref:f,class:"import-media-menu"},[(St(!0),At(Ot,null,Vt(It(o),((e,t)=>(St(),At("li",{onMouseup:e=>w(It(o),t),key:e.label},[Et("i",{class:"gg-check-o",style:Xt({visibility:e.selected?"visible":"hidden"})},null,4),zt(" "+Wt(e.label),1)],40,Bd)))),128))],512)]),Et("div",null,[Et("div",{class:"import-content-header-btn",onMouseup:t[2]||(t[2]=e=>T(e,2))},[Wd,zt("全部 ")],32),Et("ul",{ref_key:"ref_menu_filter",ref:v,class:"import-media-menu"},[(St(!0),At(Ot,null,Vt(It(d),((e,t)=>(St(),At("li",{onMouseup:e=>w(It(d),t),key:e.label},[Et("i",{class:"gg-check-o",style:Xt({visibility:e.selected?"visible":"hidden"})},null,4),zt(" "+Wt(e.label),1)],40,zd)))),128))],512)])])],32)):jt("",!0),It(i).length>0?(St(),At("div",Gd,"全部")):jt("",!0),It(i).length>0?(St(),At("div",{key:3,ref_key:"mediaContainer",ref:h,class:"import-media-container",onMouseout:Yt(p,["self"])},[Et("div",{class:Bt(It(r).className)},[(St(!0),At(Ot,null,Vt(It(i),((e,t)=>Jt((St(),At("div",{class:"import-media-item",key:e.label,onMousedown:Yt((t=>function(e,t){Tl.downArguments(arguments),Tl.downEventProxy(e,null,null,null,I),Tl.dragEventProxy(R,L,E)}(t,e)),["stop"])},[Et("div",{class:Bt(It(a)(e)),onContextmenu:Yt((t=>m(t,e)),["prevent"]),style:Xt({background:"url("+It(b)(e,It(r).className)+")"})},[isNaN(e.progress)?jt("",!0):(St(),Zt(Ed,{key:0,progress:e.progress,text:"加载中 ",alpha:.8},null,8,["progress"])),Et("div",Yd,Wt(e.durationStr),1),Et("div",{class:"div-btn-add button",onMousedown:Yt((t=>function(e){qs.addClipFromMediaFile(e)}(e)),["stop"])},null,40,Xd)],46,jd),Et("div",Jd,Wt(e.label),1)],40,Hd)),[[Qt,e.isShow]]))),128))],2),null!=It(u).item?(St(),At("div",{key:0,class:"item-media-menu",style:Xt(It(u).css)},[(St(!0),At(Ot,null,Vt(It(s),((e,t)=>(St(),At("div",{onMouseup:e=>w(It(s),t),key:e.label},Wt(e.label),41,Qd)))),128))],4)):jt("",!0)],40,Zd)):jt("",!0)],32))}}),[["__scopeId","data-v-2212585a"]]),$d=e=>(Rt("data-v-86cb31c1"),e=e(),Lt(),e),qd={class:"div-container"},ec=$d((()=>Et("div",{class:"div-group"},"默认",-1))),tc={class:"div-item-default"},ic=$d((()=>Et("div",{class:"div-group"},"我的预设",-1))),ac=gi(wt({__name:"CreatText",setup:e=>(e,t)=>(St(),At("div",qd,[ec,Et("div",tc,[zt("默认文本 "),Et("div",{class:"div-btn-add button",onMouseup:t[0]||(t[0]=Yt((e=>{}),["stop"]))},null,32)]),ic]))}),[["__scopeId","data-v-86cb31c1"]]),sc={class:"div-container"},lc=[(e=>(Rt("data-v-e1354441"),e=e(),Lt(),e))((()=>Et("div",{class:"div-no-text"},[Et("div",{class:"div-icon"},[Et("div",{class:"icon-add button"}),Et("div",null,"导入")]),Et("div",{class:"div-desc"},"支持SRT，LRC，ASS等字幕")],-1)))],nc=gi(wt({__name:"LocalText",setup:e=>(e,t)=>(St(),At("div",sc,lc))}),[["__scopeId","data-v-e1354441"]]),rc={class:"div-component"},oc={class:"div-icon-title"},dc={class:"div-title"},cc={class:"div-desc"},uc={class:"div-btn-content"},hc={class:"div-checkbox"},mc=["id"],pc=["for"],gc=["onMouseup"],fc=gi(wt({__name:"SmartTextItem",props:{icon:{},title:{},desc:{},button:{},cheack:{}},emits:["onButtonClick"],setup(e,{emit:t}){const i=e;let a;function s(){let e=a.querySelector(`[id="${i.title}"]`);t("onButtonClick",{title:i.title,checked:e.checked})}return kt((()=>{a=ii().proxy.$el})),(e,t)=>(St(),At("div",rc,[Et("div",oc,[Et("div",{class:"div-icon",style:Xt(`background-image: url(${It(i).icon})`)},null,4),Et("div",dc,Wt(It(i).title),1)]),Et("div",cc,Wt(It(i).desc),1),Et("div",uc,[Et("div",hc,[Et("input",{type:"checkbox",id:It(i).title,checked:""},null,8,mc),Et("label",{for:It(i).title},Wt(It(i).cheack),9,pc)]),Et("div",{class:"div-button button",onMouseup:Yt(s,["stop"])},Wt(It(i).button),41,gc)])]))}}),[["__scopeId","data-v-e1ab922e"]]),vc={class:"div-container"},yc=gi(wt({__name:"SmartLyrics",setup(e){let t=Bi.createEventID();function i(e){!async function(e){if(1==a)return;a=!0;let t=await ua.executeTrackAudio();if(null==t||0==t.length)return ia.showMessageRB({title:"操作无效",message:"轨道上没有音频？请先添加音频到轨道再试",options:{duration:5,icon:Rn.error}}),void(a=!1);if(Ar.isOpen(xr.PopupAudioToLyrics))return;Ar.open(xr.PopupAudioToLyrics);let i=await _r.encodeWavBase64URL(t);Ar.isOpen(xr.PopupAudioToLyrics)&&Gi.sendIPC("AudioToLyrics",i);1==e.checked&&qs.removeAllClipByLRC()}(e)}$t((()=>{Wi.on("AudioToLyricsResult",t,s)})),qt((()=>{Wi.clearAll(t)}));let a=!1;function s(e){if(a=!1,Ar.close(xr.PopupAudioToLyrics),e&&1==e.code&&null!=e.lyric){let t="markpath=track:audio:lrc",i=oa.getFileByMediaUrlPath(t);null==i&&(i=Tt(new ra)),i.type=Qi.Vtt,i.thumbnail=ra.thumbLrc,i.label="轨道歌词识别",i.setSourceUrl(t),i.parseLrc(e.lyric),oa.addFile(i),qs.addClipFromMediaFile(i)}}return(e,t)=>(St(),At("div",vc,[Gt(fc,{icon:It(Gs).URL_zimu3,button:"开始识别",desc:"识别音频视中的人声，自动生成字幕，目前仅支持国语。",cheack:"同时清空已有歌词",title:"识别歌词",onOnButtonClick:i},null,8,["icon"])]))}}),[["__scopeId","data-v-cc1caa39"]]),Tc={class:"div-container"},wc=gi(wt({__name:"SmartText",setup(e){let t=Bi.createEventID();function i(e){!async function(e){if(1==s)return;s=!0;let t=await ua.executeTrackAudio();if(null==t||0==t.length)return ia.showMessageRB({title:"操作无效",message:"轨道上没有音频？请先添加音频到轨道再试",options:{duration:5,icon:Rn.error}}),void(s=!1);if(Ar.isOpen(xr.PopupAudioToLyrics))return;Ar.open(xr.PopupAudioToLyrics);let i=await _r.encodeWavBase64URL(t);Ar.isOpen(xr.PopupAudioToLyrics)&&Gi.sendIPC("AudioToLyrics",i);1==e.checked&&qs.removeAllClipByLRC()}(e)}function a(e){Ar.open(xr.PopupInputDocMatch)}$t((()=>{Wi.on("AudioToLyricsResult",t,l)})),qt((()=>{Wi.clearAll(t)}));let s=!1;function l(e){if(s=!1,Ar.close(xr.PopupAudioToLyrics),e&&1==e.code&&null!=e.lyric){let t="markpath=track:audio:lrc",i=oa.getFileByMediaUrlPath(t);null==i&&(i=Tt(new ra)),i.type=Qi.Vtt,i.thumbnail=ra.thumbLrc,i.label="轨道歌词识别",i.setSourceUrl(t),i.parseLrc(e.lyric),oa.addFile(i),qs.addClipFromMediaFile(i)}}return(e,t)=>(St(),At("div",Tc,[Gt(fc,{icon:It(Gs).URL_zimu1,button:"开始识别",desc:"识别音频视中的人声，自动生成字幕。",title:"识别字幕",cheack:"同时清空已有字幕",onOnButtonClick:i},null,8,["icon"]),Gt(fc,{icon:It(Gs).URL_zimu2,button:"开始匹配",desc:"插入音频视对应的文稿，自动匹配画面。",title:"文稿匹配",cheack:"同时清空已有字幕",onOnButtonClick:a},null,8,["icon"])]))}}),[["__scopeId","data-v-d647de20"]]),bc=e=>(Rt("data-v-ff049bcf"),e=e(),Lt(),e),kc={class:"divbody"},Cc=bc((()=>Et("div",{class:"header"},null,-1))),Mc=bc((()=>Et("div",{class:"line"},null,-1))),xc={class:"tabContainer"},Ac=["id","value","onClick"],Ic=["for"],Sc={class:"icon"},Rc={class:"content"},Lc={class:"tabContent"},Ec=gi(wt({__name:"Resources",setup(e){let t=Bi.createEventID(),i=Tt({selectedlabel:""}),a=Ut();const s=Tt({media:{label:"媒体",icon:"gg-play-button-r",enable:!0,menudata:[],comMenu:Pt(gd)},audio:{label:"音频",icon:"gg-music",enable:!0,menudata:[],comMenu:Pt(gd)},text:{label:"字幕",icon:"gg-format-text",enable:!0,menudata:[],comMenu:Pt(gd)},picture:{label:"贴纸",icon:"gg-smile-neutral",enable:!0,menudata:[],comMenu:Pt(gd)},effect:{label:"特效",icon:"gg-live-photo",enable:!0,menudata:[],comMenu:Pt(gd)},transition:{label:"转场",icon:"gg-community",enable:!0,menudata:[],comMenu:Pt(gd)},filter:{label:"滤镜",icon:"gg-controller",enable:!0,menudata:[],comMenu:Pt(gd)},adjust:{label:"调节",icon:"gg-edit-markup",enable:!0,menudata:[],comMenu:Pt(gd)}});s.media&&(s.media.menudata=Tt([{label:"本地素材",comName:Pt(Kd),childs:[]}])),s.audio&&(s.audio.menudata=Tt([{label:"音乐素材",comName:Pt(xd),childs:[]},{label:"音效素材",childs:[]},{label:"音频提取",childs:[]},{label:"抖音收藏",childs:[]},{label:"链接下载",childs:[]}])),s.text&&(s.text.menudata=Tt([{label:"新建文本",childs:[{label:"默认",comName:Pt(ac)}]},{label:"花字",childs:[]},{label:"文字模版",childs:[]},{label:"智能字幕",comName:Pt(wc),childs:[]},{label:"识别歌词",comName:Pt(yc),childs:[]},{label:"本地字幕",comName:Pt(nc),childs:[]}])),s.picture&&(s.picture.menudata=Tt([{label:"贴纸素材",childs:[]}])),s.effect&&(s.effect.menudata=Tt([{label:"画面特效",childs:[]},{label:"人物特效",childs:[]}])),s.transition&&(s.transition.menudata=Tt([{label:"转场效果",childs:[]}])),s.filter&&(s.filter.menudata=Tt([{label:"滤镜库",childs:[]}])),s.adjust&&(s.adjust.menudata=Tt([{label:"调节",childs:[{label:"自定义",comName:null},{label:"我的预设",comName:null}]},{label:"LUT",childs:[]}])),s.package&&(s.package.menudata=Tt([{label:"剪同款",childs:[]},{label:"素材包",childs:[]}]));let l=[],n=-1;function r(e){if(1==e.success&&Array.isArray(e.data)){let t=e.data;for(let e=0;e<t.length;e++){const i=t[e],a=s[i.tName];null!=a&&(a.tId=Number(i.tId),a.enable=i.enable)}}let t=null;if(-1==n)t=c(0);else{let e=n;n=-1,t=c(e)}let i=a.value;null!=t&&null!=i&&null!=i.sendGettabone&&i.sendGettabone(t.tId)}kt((()=>{l=Object.keys(s),td.on(Ko.gettabid,t,r),td.call(Ko.gettabid),c(0)}));let o=Tt({tId:-1,comMenu:null}),d=e=>{null!=e?(o.tId=e.tId,o.label=e.label,o.menudata=e.menudata,o.comMenu=e.comMenu):(o.tId=-1,o.label=null,o.menudata=null,o.comMenu=null)},c=e=>{if(n==e)return;n=e;let t=l[e],a=s[t];return i.selectedlabel=a?a.label:null,d(a),a};return(e,t)=>(St(),At("div",kc,[Cc,Mc,Et("div",xc,[(St(!0),At(Ot,null,Vt(s,((e,a)=>Jt((St(),At("li",{key:e.label},[Jt(Et("input",{id:"tab"+a,type:"radio",name:"tab",value:e.label,"onUpdate:modelValue":t[0]||(t[0]=e=>It(i).selectedlabel=e),onClick:t=>It(d)(e)},null,8,Ac),[[si,It(i).selectedlabel]]),Et("label",{for:"tab"+a},[Et("div",Sc,[Et("div",{class:Bt(e.icon)},null,2)]),zt(" "+Wt(e.label),1)],8,Ic)])),[[Qt,1==e.enable]]))),128))]),Et("div",Rc,[Et("div",Lc,[(St(),Zt(li,null,[(St(),Zt(Ht(It(o).comMenu),{ref_key:"refComponent",ref:a,data:It(o),key:It(o).label},null,8,["data"]))],1024))])])]))}}),[["__scopeId","data-v-ff049bcf"]]),Pc={class:"message-frame-title"},_c={class:"message-icon"},Dc={divname:"title",class:"message-frame-title-text"},Fc={divname:"content",class:"message-frame-content"},Nc={key:0,class:"message-frame-progress"},Uc={class:"message-frame-progress-bg"},Oc=gi(wt({__name:"MessageFrame",setup(e){let t=Ut(Rn.okNormal),i=Ut({progressStr:"",progress:50,progressData:null}),a=xt((()=>{let e=i.value.progress,t=i.value.progressData;return!(isNaN(e)&&(!t||isNaN(t.progress)))||(i.value.progressStr="",!1)})),s=xt((()=>{let e=0,a=i.value.progressData;if(null!=a){if(isNaN(a.progress)||(e=a.progress),isNaN(e))return}else e=i.value.progress;return e=Math.min(100,Math.max(e,0)),e>=100?(t.value=Rn.okGreen,l(),p(2)):i.value.progressStr=`${e}% `,`width:${e}%`}));function l(){i.value.progress=NaN,i.value.progressData=null,i.value.progressStr=""}let n={open:"message-frame open",close:"message-frame close",containerShow:"message-frame-container display-block",containerHide:"message-frame-container display-none",isShowing:!1},r=Ut({time:"--anim-time:0.3s",frame:n.open,container:n.containerHide}),o=null;function d(){r.value.frame=n.close,null!=o&&(clearTimeout(o),o=null),o=setTimeout((()=>{r.value.container=n.containerHide,clearInterval(m),m=null,n.isShowing=!1,l()}),300)}let c=Ut({title:"",message:""}),u=Ut("确认"),h=null,m=null;function p(e){null==h&&(h={duration:0}),h.duration=Math.min(e,10),h.duration>0&&(null==m&&(m=setInterval(f,1e3)),f())}let g=Ut("");function f(){if(null==h||null==h.duration)return clearInterval(m),void(m=null);let e=Math.floor(h.duration);e-=1,h.duration=e,e<-1&&(clearInterval(m),m=null,d())}let v=Bi.createEventID(),y=Ut();return kt((()=>{Bi.on(ia.AppMessageRb,v,(e=>{null!=e&&function(e){var a;if(0==n.isShowing?(r.value.container=n.containerShow,r.value.frame=n.open):null!=o&&(clearTimeout(o),o=null),null==e.title&&(e.title="提示"),null==e.label&&(e.label="确认"),n.isShowing=!0,u.value=e.label,c.value.title=e.title,c.value.message=e.message,i.value.progress=e.progress,i.value.progressData=e.progressData,(null==(a=null==e?void 0:e.options)?void 0:a.icon)==Rn.error&&null!=y.value){let e=y.value.querySelector('[divname="title"]');e&&(e.style.color="#FF0000")}if(h=e.options,null!=e.options){let i=Rn.okNormal;null!=e.options.icon&&(i=e.options.icon),t.value=i}else t.value=Rn.okNormal;null!=e.options&&e.options.duration>0&&p(e.options.duration)}(e)}))})),Ct((()=>{Bi.clearAll(v)})),(e,l)=>(St(),At("div",{ref_key:"divdom",ref:y,class:Bt(It(r).container)},[Et("div",{class:Bt(It(r).frame),style:Xt(It(r).time)},[Et("div",Pc,[Et("div",_c,[Et("i",{class:Bt(It(t))},null,2)]),Et("div",Dc,Wt(It(c).title),1),Et("div",{class:"message-frame-close-btn",onClick:d},Wt(It(u))+Wt(It(g)),1)]),Et("div",Fc,Wt(It(i).progressStr)+Wt(It(c).message),1),It(a)?(St(),At("div",Nc,[Et("div",Uc,[Et("div",{class:"message-frame-progress-bar",style:Xt(It(s))},null,4)])])):jt("",!0)],6)],2))}}),[["__scopeId","data-v-69358118"]]),Vc={class:"div-popup-container"},Bc={key:0,class:"div-popup-container-mask bgmask"},Wc={class:"div-child-content dailog"},zc=gi(wt({__name:"PopupLayer",setup(e){let t=Ar.current;return kt((()=>{})),(e,i)=>Jt((St(),At("div",Vc,[null!=It(t).component?(St(),At("div",Bc)):jt("",!0),Et("div",Wc,[Jt(Et("div",{class:"div-child-title"},Wt(It(t).title),513),[[Qt,null!=It(t).title]]),(St(),Zt(li,null,[null!=It(t).component?(St(),Zt(Ht(It(t).component),{key:It(t).title,value:It(t).data},null,8,["value"])):jt("",!0)],1024))])],512)),[[Qt,null!=It(t).component]])}}),[["__scopeId","data-v-7c95c16c"]]),Gc=["onMouseup"],Zc=["onMouseup"],Hc=["onMouseup"],jc=gi(wt({__name:"SlotFrame",setup(e){let t=Bi.createEventID();const i=Tt({middleHeight:60,middle_1_width:25,threeMaxWidth:20}),a=Ut(null),s=Ut(null),l=Ut(null),n=Ut(null),r=Ut(null),o=Ut(null),d=Ut(null);async function c(){let e=d.value;await gt();let t=e.getBoundingClientRect();t.width>0&&t.height>0&&(Gn.paneWidth=t.width-15,Gn.paneHeight=t.height-50)}async function u(){await c(),Bi.send(ki.SlotFrameResize)}kt((()=>{window.addEventListener("resize",u);let e=n.value;e.style.minWidth="30%",e.style.width="474px",Bi.send(ki.SlotFrameResize),c()})),Ct((()=>{window.removeEventListener("resize",u),Bi.clearAll(t)}));var h=null;const m=e=>{if(h==l.value){const t=s.value.getBoundingClientRect(),a=(e.pageY-t.top)/document.documentElement.clientHeight*100;i.middleHeight=a,Bi.send(ki.SlotFrameResize)}else if(h==r.value){const t=n.value.getBoundingClientRect(),a=(e.pageX-t.left)/document.documentElement.clientWidth*100;i.middle_1_width=a,Bi.send(ki.SlotFrameResize)}else if(h==o.value){o.value.getBoundingClientRect();let t=e.pageX/document.documentElement.clientWidth*100;t=Math.min(100-t,i.threeMaxWidth),i.threeWidth=t,Bi.send(ki.SlotFrameResize)}},p=e=>{h=e.target.parentNode,Tl.isMouseDrag=!0,Bi.on(ki.mousemove,t,m),Bi.on(ki.mouseup,t,g)},g=e=>{Tl.stopEvent(e),h=null,Tl.isMouseDrag=!1,Bi.off(ki.mousemove,t,m),Bi.off(ki.mouseup,t,g),setTimeout((()=>{Bi.send(ki.SlotFrameResize)}),100)};return(e,t)=>(St(),At("div",{ref_key:"refPane",ref:d,class:"split-pane"},[Et("div",{ref_key:"edheader",ref:a,class:"edit-header"},[ni(e.$slots,"SlotHeader",{},void 0,!0)],512),Et("div",{ref_key:"edmiddle",ref:s,style:Xt({height:i.middleHeight+"%"}),class:"edit-middle"},[Et("div",{ref_key:"middle_1",ref:n,style:Xt({width:i.middle_1_width+"%"}),class:"middle_1"},[ni(e.$slots,"SlotMiddleA",{},void 0,!0)],4),Et("div",{ref_key:"middle_2",ref:r,class:"middle_2"},[Et("div",{class:"middle-trigger",onMousedown:p,onMouseup:Yt(g,["stop"])},null,40,Gc),ni(e.$slots,"SlotMiddleB",{},void 0,!0)],512),Et("div",{ref_key:"middle_3",ref:o,style:Xt({maxWidth:i.threeWidth+"%"}),class:"middle_3"},[Et("div",{class:"middle-trigger",onMousedown:p,onMouseup:Yt(g,["stop"])},null,40,Zc),ni(e.$slots,"SlotMiddleC",{},void 0,!0)],4)],4),Et("div",{ref_key:"edbottom",ref:l,class:"edit-bottom"},[Et("div",{class:"bottom-trigger",onMousedown:p,onMouseup:Yt(g,["stop"])},null,40,Hc),ni(e.$slots,"SlotBottom",{},void 0,!0)],512)],512))}}),[["__scopeId","data-v-1092c5d7"]]),Yc={class:"app-container"},Xc=wt({__name:"App",setup:e=>(kt((()=>{ia.showMessageRB({title:"欢迎信息",message:"欢迎使用在线音视频剪辑神器《剪神》V1.0",options:{duration:5,icon:Rn.okGreen}})})),(e,t)=>(St(),At("div",Yc,[Gt(jc,{onContextmenu:t[0]||(t[0]=Yt((()=>{}),["prevent"])),onDragstart:t[1]||(t[1]=Yt((()=>{}),["prevent"])),onDragover:t[2]||(t[2]=e=>{return(t=e).stopPropagation(),t.preventDefault(),void(t.dataTransfer.dropEffect="none");var t})},{SlotHeader:ri((()=>[Gt(qr)])),SlotMiddleA:ri((()=>[Gt(Ec)])),SlotMiddleB:ri((()=>[Gt(Zo)])),SlotMiddleC:ri((()=>[Gt(fl)])),SlotBottom:ri((()=>[Gt(An)])),_:1}),Gt(Oc),Gt(Qo),Gt(yl),Gt(zc)])))});const Jc=oi({legacy:!1,locale:localStorage.getItem("lang")||"zh",fallbackLocale:"zh",globalInjection:!0,messages:{zh:{table:{date:"日期",name:"姓名",address:"地址"},menu:{},tabs:{},LangHeaderMain:{Menu:"菜单",File:"文件",NewDraft:"新建草稿",Import:"导入",Export:"导出",Edit:"编辑",Revocation:"撤销",Recovery:"恢复",LayoutStyle:"布局样式",DefaultLayout:"默认布局",MediaMaterialPriority:"媒体素材优先",PlayerPriority:"播放器优先",AttributeAdjustmentPriority:"属性调节优先",TimelinePriority:"时间线优先",More:"更多",Environmental:"使用环境检测",VersionNumber:"版本号",Help:"帮助",HelpCenter:"帮助中心",Feedback:"意见反馈",Shortcuts:"快捷键",About:"关于",GlobalSettings:"全局设置",BacktoHome:"返回首页",Exit:"退出"}},en:{table:{date:"Date",name:"Name",address:"Address"},menu:{},tabs:{},LangHeaderMain:{Menu:"Menu",File:"File",NewDraft:"NewDraft",Import:"Import",Export:"Export",Edit:"Edit",Revocation:"Revocation",Recovery:"Recovery",LayoutStyle:"LayoutStyle",DefaultLayout:"DefaultLayout",MediaMaterialPriority:"MediaMaterialPriority",PlayerPriority:"PlayerPriority",AttributeAdjustmentPriority:"AttributeAdjustmentPriority",TimelinePriority:"TimelinePriority",More:"More",Environmental:"Environmental",VersionNumber:"VersionNumber",Help:"Help",HelpCenter:"HelpCenter",Feedback:"Feedback",Shortcuts:"Shortcuts",About:"About",GlobalSettings:"GlobalSettings",BacktoHome:"BacktoHome",Exit:"Exit"}}}});Gi.sendIPCLog("你好，我是VUE！"),di.defaults.baseURL={}.VITE_API_URL,Rl.initial(),Ui.initial(),Ml.initial(),Gi.initial();const Qc=ci(Xc);Qc.config.globalProperties.$axios=di,Qc.use(Jc),Qc.mount("#app");
